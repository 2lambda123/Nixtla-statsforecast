<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Step-by-step guide on using the AutoCES Model with Statsforecast.">

<title>statsforecast - AutoCES Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon_png.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NXJNCVR18L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NXJNCVR18L', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="statsforecast - AutoCES Model">
<meta property="og:description" content="Step-by-step guide on using the AutoCES Model with Statsforecast.">
<meta property="og:image" content="https://github.com/Nixtla/styles/blob/2abf51612584169874c90cd7c4d347e3917eaf73/images/Banner%20Github.png">
<meta property="og:site-name" content="statsforecast">
<meta name="twitter:title" content="statsforecast - AutoCES Model">
<meta name="twitter:description" content="Step-by-step guide on using the AutoCES Model with Statsforecast.">
<meta name="twitter:image" content="https://farm6.staticflickr.com/5510/14338202952_93595258ff_z.jpg">
<meta name="twitter:site" content="@Nixtlainc">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">statsforecast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../docs/getting-started/getting_started_short.html" rel="" target="" aria-current="page">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nixtlaverse" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NixtlaVerse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nixtlaverse">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast" rel="" target="">
 <span class="dropdown-text">StatsForecast ‚ö°Ô∏è</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/mlforecast" rel="" target="">
 <span class="dropdown-text">MLForecast ü§ñ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/neuralforecast" rel="" target="">
 <span class="dropdown-text">NeuralForecast üß†</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/hierarchicalforecast" rel="" target="">
 <span class="dropdown-text">HierarchicalForecast üëë</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast/issues/new/choose" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://join.slack.com/t/nixtlaworkspace/shared_invite/zt-135dssye9-fWTzMpv2WBthq8NK0Yvu6A" rel="" target=""><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Join our Slack</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nixtla/statsforecast" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nixtlainc" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Nixtla Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/models/adida.html">Model References</a></li><li class="breadcrumb-item"><a href="../../docs/models/autoces.html">AutoCES Model</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ‚ö°Ô∏è</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_complete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/anomalydetection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anomaly Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/conformalprediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conformal Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/crossvalidation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricityloadforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Electricity Load Forecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricitypeakforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detect Demand Peaks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/garch_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Volatility forecasting (GARCH &amp; ARCH)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/intermittentdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent or Sparse Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/multipleseasonalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple seasonalities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/statisticalneuralmethods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical, Machine Learning and Neural Forecasting methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/uncertaintyintervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">How-To Guides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/automatic_forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Time Series Forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/amazonstatsforecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Amazon Forecast vs StatsForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/autoarima_vs_prophet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Comparison (Prophet and pmdarima)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ets_ray_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting at Scale using ETS and ray (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/exogenous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exogenous Regressors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/getting_started_complete_polars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough with Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/migrating_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Migrating from R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/mlflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLFlow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/numba_cache.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numba caching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/prophet_spark_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ETS and Facebook Prophet on Spark (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ray</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Model References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/adida.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADIDA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoarima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoces.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">AutoCES Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoETS Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoregressive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoRegressive Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autotheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoTheta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonclassic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonClassic Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonOptimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonsba.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonSBA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicoptimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicstandardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/garch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holtwinters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Winters Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/imapa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IMAPA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/multipleseasonaltrend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Seasonal Trend (MSTL)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/optimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothingoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/standardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/tsb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TSB Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">API Reference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/distributed.fugue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FugueBackend</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast‚Äôs Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/contribute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contribute to Nixtla</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/docs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nixtla Documentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issue-labels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding Issue Labels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submit an Issue üì¢</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/step-by-step.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step-by-step Contribution Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/techstack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing Code to Nixtla Development</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link active" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction </a><a class="anchor nav-link" id="introduction" data-scroll-target="undefined"></a></li>
  <li><a href="#complex-exponential-smoothing" id="toc-complex-exponential-smoothing" class="nav-link" data-scroll-target="#complex-exponential-smoothing">Complex Exponential Smoothing </a><a class="anchor nav-link" id="model" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#method-and-model" id="toc-method-and-model" class="nav-link" data-scroll-target="#method-and-model">Method and model</a></li>
  <li><a href="#stationarity-and-stability-conditions-for-ces" id="toc-stationarity-and-stability-conditions-for-ces" class="nav-link" data-scroll-target="#stationarity-and-stability-conditions-for-ces">Stationarity and stability conditions for CES</a></li>
  <li><a href="#conditional-mean-and-variance-of-ces" id="toc-conditional-mean-and-variance-of-ces" class="nav-link" data-scroll-target="#conditional-mean-and-variance-of-ces">Conditional mean and variance of CES</a></li>
  <li><a href="#loading-libraries-and-data" id="toc-loading-libraries-and-data" class="nav-link" data-scroll-target="#loading-libraries-and-data">Loading libraries and data </a><a class="anchor nav-link" id="loading" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read Data</a></li>
  </ul></li>
  <li><a href="#explore-data-with-the-plot-method" id="toc-explore-data-with-the-plot-method" class="nav-link" data-scroll-target="#explore-data-with-the-plot-method">Explore data with the plot method </a><a class="anchor nav-link" id="plotting" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#autocorrelation-plots" id="toc-autocorrelation-plots" class="nav-link" data-scroll-target="#autocorrelation-plots">Autocorrelation plots</a></li>
  <li><a href="#decomposition-of-the-time-series" id="toc-decomposition-of-the-time-series" class="nav-link" data-scroll-target="#decomposition-of-the-time-series">Decomposition of the time series</a></li>
  <li><a href="#additive-time-series" id="toc-additive-time-series" class="nav-link" data-scroll-target="#additive-time-series">Additive time series</a></li>
  <li><a href="#multiplicative-time-series" id="toc-multiplicative-time-series" class="nav-link" data-scroll-target="#multiplicative-time-series">Multiplicative time series</a></li>
  </ul></li>
  <li><a href="#split-the-data-into-training-and-testing" id="toc-split-the-data-into-training-and-testing" class="nav-link" data-scroll-target="#split-the-data-into-training-and-testing">Split the data into training and testing</a><a class="anchor nav-link" id="splitting" data-scroll-target="undefined"></a></li>
  <li><a href="#implementation-of-autoces-with-statsforecast" id="toc-implementation-of-autoces-with-statsforecast" class="nav-link" data-scroll-target="#implementation-of-autoces-with-statsforecast">Implementation of AutoCES with StatsForecast </a><a class="anchor nav-link" id="implementation" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li><a href="#instantiate-model" id="toc-instantiate-model" class="nav-link" data-scroll-target="#instantiate-model">Instantiate Model</a></li>
  <li><a href="#fit-the-model" id="toc-fit-the-model" class="nav-link" data-scroll-target="#fit-the-model">Fit the Model</a></li>
  <li><a href="#forecast-method" id="toc-forecast-method" class="nav-link" data-scroll-target="#forecast-method">Forecast Method</a></li>
  <li><a href="#predict-method-with-confidence-interval" id="toc-predict-method-with-confidence-interval" class="nav-link" data-scroll-target="#predict-method-with-confidence-interval">Predict method with confidence interval</a></li>
  </ul></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-validation </a><a class="anchor nav-link" id="cross_validate" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#perform-time-series-cross-validation" id="toc-perform-time-series-cross-validation" class="nav-link" data-scroll-target="#perform-time-series-cross-validation">Perform time series cross-validation</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation </a><a class="anchor nav-link" id="evaluate" data-scroll-target="undefined"></a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References </a><a class="anchor nav-link" id="references" data-scroll-target="undefined"></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Nixtla/statsforecast/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AutoCES Model</h1>
</div>

<div>
  <div class="description">
    Step-by-step guide on using the <code>AutoCES Model</code> with <code>Statsforecast</code>.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#model">Complex Exponential Smoothing</a></li>
<li><a href="#loading">Loading libraries and data</a></li>
<li><a href="#plotting">Explore data with the plot method</a></li>
<li><a href="#splitting">Split the data into training and testing</a></li>
<li><a href="#implementation">Implementation of AutoCES with StatsForecast</a></li>
<li><a href="#cross_validate">Cross-validation</a></li>
<li><a href="#evaluate">Model evaluation</a></li>
<li><a href="#references">References</a></li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction <a class="anchor" id="introduction"></a></h2>
<p>Exponential smoothing has been one of the most popular forecasting methods used to support various decisions in organizations, in activities such as inventory management, scheduling, revenue management, and other areas. Although its relative simplicity and transparency have made it very attractive for research and practice, identifying the underlying trend remains challenging with significant impact on the resulting accuracy. This has resulted in the development of various modifications of trend models, introducing a model selection problem. With the aim of addressing this problem, we propose the complex exponential smoothing (CES), based on the theory of functions of complex variables. The basic CES approach involves only two parameters and does not require a model selection procedure. Despite these simplifications, CES proves to be competitive with, or even superior to existing methods. We show that CES has several advantages over conventional exponential smoothing models: it can model and forecast both stationary and non-stationary processes, and CES can capture both level and trend cases, as defined in the conventional exponential smoothing classification. CES is evaluated on several forecasting competition datasets, demonstrating better performance than established benchmarks. We conclude that CES has desirable features for time series modeling and opens new promising avenues for research.</p>
</section>
<section id="complex-exponential-smoothing" class="level1">
<h1>Complex Exponential Smoothing <a class="anchor" id="model"></a></h1>
<section id="method-and-model" class="level3">
<h3 class="anchored" data-anchor-id="method-and-model">Method and model</h3>
<p>Using the complex valued representation of time series, we propose the CES in analogy to the conventional exponential smoothing methods. Consider the simple exponential smoothing method:</p>
<p><span class="math display">\[ {\hat{y}}_t=\alpha {y}_{t-1}+\left(1-\alpha \right){\hat{y}}_{t-1}, \tag 1\]</span></p>
<p>where <span class="math inline">\(\alpha\)</span> is the smoothing parameter and <span class="math inline">\({\hat{y}}_t\)</span> is the estimated value of series. The same method can be represented as a weighted average of previous actual observations if we substitute <span class="math inline">\({\hat{y}}_{t-1}\)</span> by the formula (1) with an index instead of (Brown, 1956):</p>
<p><span class="math display">\[ {\hat{y}}_t=\alpha \sum \limits_{j=1}^{t-1}{\left(1-\alpha \right)}^{j-1}{y}_{t-j} \tag 2 \]</span></p>
<p>The idea of this representation is to demonstrate how the weights $ ^{j-1} $ are distributed over time in our sample. If the smoothing parameter $ (0,1) $ then the weights decline exponentially with the increase of . If it lies in the so called ‚Äúadmissible bounds‚Äù (Brenner et al., 1968), that is $ (0,2) $ then the weights decline in oscillating manner. Both traditional and admissible bounds have been used efficiently in practice and in academic literature (for application of the latter see for example Gardner &amp; Diaz-Saiz, 2008; Snyder et al., 2017). However, in real life the distribution of weights can be more complex, with harmonic rather than exponential decline, meaning that some of the past observation might have more importance than the recent ones. In order to implement such distribution of weights, we build upon (2) and introduce complex dynamic interactions by substituting the real variables with the complex ones in (2). First, we substitute $ {y}<em>{t-j} $ by the complex variable $ {y}</em>{t-j}+{ie}<em>{t-j} $, where $ {e}<em>t $ is the error term of the model and <span class="math inline">\(i\)</span> is the imaginary unit (which satisfies the equation $ {i}^2=-1 $). The idea behind this is to have the impact of both actual values and the error on each observation in the past on the final forecast. Second, we substitute <span class="math inline">\(\alpha\)</span> with a complex variable ${}<em>0+i{}<em>1 $ and 1 by <span class="math inline">\(1+i\)</span> to introduce the harmonically declining weights. Depending on the values of the complex smoothing parameter, the weights distribution will exhibit a variety of trajectories over time, including exponential, oscillating, and harmonic. Finally, the result of multiplication of two complex numbers will be another complex number, so we substitute $ {}</em>{t-j} $ with ${}</em>{t-j}+i{}</em>{t-j} $, where $ {}</em>{t-j} $ is the proxy for the error term. The CES obtained as a result of this can be written as:</p>
<p><span class="math display">\[ {\hat{y}}_t+i{\hat{e}}_t=\left({\alpha}_0+i{\alpha}_1\right)\sum \limits_{j=1}^{t-1}{\left(1+i-\left({\alpha}_0+i{\alpha}_1\right)\right)}^{j-1}\left({y}_{t-j}+{ie}_{t-j}\right). \tag 3\]</span></p>
<p>Having arrived to the model with harmonically distributed weights, we can now move to the shorter form by substituting</p>
<p><span class="math display">\[ {\displaystyle \begin{array}{cc}&amp; {\hat{y}}_{t-1}+i{\hat{e}}_{t-1}\\ {}&amp; \kern1em =\left({\alpha}_0+i{\alpha}_1\right)\sum \limits_{j=2}^{t-1}{\left(1+i-\left({\alpha}_0+i{\alpha}_1\right)\right)}^{j-1}\left({y}_{t-j}+{ie}_{t-j}\right)\end{array}} \]</span></p>
<p>in (3) to get:</p>
<p><span class="math display">\[ {\displaystyle \begin{array}{cc}{\hat{y}}_t+i{\hat{e}}_t&amp; =\left({\alpha}_0+i{\alpha}_1\right)\left({y}_{t-1}+{ie}_{t-1}\right)\\ {}&amp; \kern1em +\left(1-{\alpha}_0+i-i{\alpha}_1\right)\left({\hat{y}}_{t-1}+i{\hat{e}}_{t-1}\right).\end{array}}  \tag 4\]</span></p>
<p>Note that $ {}_t $ is not interesting for the time series analysis and forecasting purposes, but is used as a vessel containing the information about the previous errors of the method. Having the complex variables instead of the real ones in (4), allows taking the exponentially weighted values of both actuals and the forecast errors. By changing the value of $ {}_0+i{}_1 $ , we can regulate what proportions of the actual and the forecast error should be carried out to the future in order to produce forecasts.</p>
<p>Representing the complex-valued function as a system of two real-valued functions leads to:</p>
<p><span class="math display">\[ {\displaystyle \begin{array}{ll}&amp; {\hat{y}}_t=\left({\alpha}_0{y}_{t-1}+\left(1-{\alpha}_0\right){\hat{y}}_{t-1}\right)-\left({\alpha}_1{e}_{t-1}+\left(1-{\alpha}_1\right){\hat{e}}_{t-1}\right)\\ {}&amp; {\hat{e}}_t=\left({\alpha}_1{y}_{t-1}+\left(1-{\alpha}_1\right){\hat{y}}_{t-1}\right)+\left({\alpha}_0{e}_{t-1}+\left(1-{\alpha}_0\right){\hat{e}}_{t-1}\right).\end{array}} \tag 5\]</span></p>
<p>CES introduces an interaction between the real and imaginary parts, and the equations in (6) are connected via the previous values of each other, causing interactions over time, defined by complex smoothing parameter value.</p>
<p>But the method itself is restrictive and does not allow easily producing prediction intervals and deriving the likelihood function. It is also important to understand what sort of statistical model underlies CES. This model can be written in the following state space form:</p>
<p><span class="math display">\[ {\displaystyle \begin{array}{ll}&amp; {y}_t={l}_{t-1}+{\epsilon}_t\\ {}&amp; {l}_t={l}_{t-1}-\left(1-{\alpha}_1\right){c}_{t-1}+\left({\alpha}_0-{\alpha}_1\right){\epsilon}_t\\ {}&amp; {c}_t={l}_{t-1}+\left(1-{\alpha}_0\right){c}_{t-1}+\left({\alpha}_0+{\alpha}_1\right){\epsilon}_t,\end{array}} \tag 6 \]</span></p>
<p>where $ {}_t $ is the white noise error term, $ {l}_t $ is the level component and $ {c}<em>t $ is the nonlinear trend component at observation . Observe that dependencies in time series have an interactive structure and no explicit trend component is present in the time series as this model does not need to artificially break the series into level and trend, as ETS does. Although we call the $ {c}<em>t $ component as ‚Äúnonlinear trend,‚Äù it does not correspond to the conventional trend component, because it contains the information of both previous $ {c}</em>{t-1} $ and the level $ {l}</em>{t-1}$. Also, note that we use $ {}_t $ instead of $ {e}_t $ in (6), which means that the CES has (6) as an underlying statistical model only when there is no misspecification error. In the case of the estimation of this model, the $ {}_t $ will be substituted by $ {e}_t $, which will then lead us to the original formulation (4).</p>
<p>This idea allows rewriting (6) in a shorter more generic way, resembling the general single source of error (SSOE) state space framework:</p>
<p><span class="math display">\[ {\displaystyle \begin{array}{ll}&amp; {y}_t={\mathbf{w}}^{\prime }{\mathbf{v}}_{t-1}+{\epsilon}_t\\ {}&amp; {\mathbf{v}}_t={\mathbf{Fv}}_{t-1}+\mathbf{g}{\epsilon}_t,\end{array}} \tag 7\]</span></p>
where $ {}_t=(
<span class="math display">\[\begin{array}{c}{l}_t\\ {}{c}_t\end{array}\]</span>
) $ is the state vector, $ =(
<span class="math display">\[\begin{array}{cc}1&amp; -\left(1-{\alpha}_1\right)\\ {}1&amp; 1-{\alpha}_0\end{array}\]</span>
) $ is the transition matrix, $ =(
<span class="math display">\[\begin{array}{c}{\alpha}_0-{\alpha}_1\\ {}{\alpha}_0+{\alpha}_1\end{array}\]</span>
) $ is the persistence vector and $ =(
<span class="math display">\[\begin{array}{c}1\\ {}0\end{array}\]</span>
<p>) $ is the measurement vector.</p>
<p>The state space form (7) permits extending CES in a similar ways to ETS to include additional states for seasonality or exogenous variables. The main difference between model (7) and the conventional ETS is that the transition matrix in (7) includes smoothing parameters which is not a standard feature of ETS models. Furthermore persistence vector includes the interaction of complex smoothing parameters, rather than smoothing parameters themselves.</p>
<p>The error term in (6) is additive, so the likelihood function for CES is trivial and is similar to the one in the additive exponential smoothing models (Hyndman et al., 2008, p.&nbsp;68):</p>
<p><span class="math display">\[ \mathrm{\mathcal{L}}\left(\mathbf{g},{\mathbf{v}}_0,{\sigma}^2\mid \mathbf{Y}\right)={\left(\frac{1}{\sigma \sqrt{2\pi }}\right)}^T\exp \left(-\frac{1}{2}\sum \limits_{t=1}^T{\left(\frac{\epsilon_t}{\sigma}\right)}^2\right), \tag 8\]</span></p>
<p>where $ {}_0 $ is the vector of initial states, $ {}^2 $ is the variance of the error term and $ $ is the vector of all the in-sample observations.</p>
</section>
<section id="stationarity-and-stability-conditions-for-ces" class="level3">
<h3 class="anchored" data-anchor-id="stationarity-and-stability-conditions-for-ces">Stationarity and stability conditions for CES</h3>
<p>In order to understand the properties of CES, we need to study its stationarity and stability conditions. The former holds for general exponential smoothing in the state space form (8) when all the eigenvalues of lie inside the unit circle (Hyndman et al., 2008, p.&nbsp;38). CES can be either stationary or not, depending on the complex smoothing parameter value, in contrast to ETS models that are always non-stationary. Calculating eigenvalues of for CES gives the following roots:</p>
<p><span class="math display">\[ \lambda =\frac{2-{\alpha}_0\pm \sqrt{\alpha_0^2+4{\alpha}_1-4}}{2}. \tag 9\]</span></p>
<p>If the absolute values of both roots are less than 1 then the estimated CES is stationary.</p>
<p>When $ {}_1&gt;1 $ one of the eigenvalues will always be greater than one. In this case both eigenvalues will be real numbers and CES produces a non-stationary trajectory. When $ {}_1=1 $ CES becomes equivalent to ETS(A,N,N). Finally, the model becomes stationary when:</p>
<p><span class="math display">\[ \left\{\begin{array}{l}{\alpha}_1&lt;5-2{\alpha}_0\\ {}{\alpha}_1&lt;1\\ {}{\alpha}_1&gt;1-{\alpha}_0\end{array}\right.  \tag {10}\]</span></p>
<p>Note that we are not restricting CES with the conditions (10), we merely show, how the model will behave depending on the value of the complex smoothing parameter. This property of CES means that it is able to model either stationary or non-stationary processes, without the need to switch between them. The property of CES for each separate time series depends on the value of the smoothing parameters.</p>
<p>The other important property that arises from (7) is the stability condition for CES. With $ {}_t={y}<em>t-{l}</em>{t-1} $ the following is obtained:</p>
<p><span class="math display">\[ {\displaystyle \begin{array}{ll}{y}_t&amp; ={l}_{t-1}+{\epsilon}_t\\ {}\left(\begin{array}{c}{l}_t\\ {}{c}_t\end{array}\right)&amp; =\left(\begin{array}{cc}1-{\alpha}_0+{\alpha}_1&amp; -\left(1-{\alpha}_1\right)\\ {}1-{\alpha}_0-{\alpha}_1&amp; 1-{\alpha}_0\end{array}\right)\left(\begin{array}{c}{l}_{t-1}\\ {}{c}_{t-1}\end{array}\right)\\ {}&amp; \kern1em +\left(\begin{array}{c}{\alpha}_0-{\alpha}_1\\ {}{\alpha}_1+{\alpha}_0\end{array}\right){y}_t.\end{array}} \tag {11}\]</span></p>
The matrix $ =(
<span class="math display">\[\begin{array}{cc}1-{\alpha}_0+{\alpha}_1&amp; -\left(1-{\alpha}_1\right)\\ {}1-{\alpha}_0-{\alpha}_1&amp; 1-{\alpha}_0\end{array}\]</span>
<p>) $ is called the discount matrix and can be written in the general form:</p>
<p><span class="math display">\[ \mathbf{D}=\mathbf{F}-\mathbf{g}{\mathbf{w}}^{\prime }. \tag {12}\]</span></p>
<p>The model is said to be stable if all the eigenvalues of (12) lie inside the unit circle. This is more important condition than the stationarity for the model, because it ensures that the complex weights decline over time and that the older observations have smaller weights than the new ones, which is one of the main features of the conventional ETS models. The eigenvalues are given by the following formula:</p>
<p><span class="math display">\[ \lambda =\frac{2-2{\alpha}_0+{\alpha}_1\pm \sqrt{8{\alpha}_1+4{\alpha}_0-4{\alpha}_0{\alpha}_1-4-3{\alpha}_1^2}}{2}. \tag {13}\]</span></p>
<p>CES will be stable when the following system of inequalities is satisfied:</p>
<p><span class="math display">\[ \left\{\begin{array}{l}{\left({\alpha}_0-2.5\right)}^2+{\alpha}_1^2&gt;1.25\\ {}{\left({\alpha}_0-0.5\right)}^2+{\left({\alpha}_1-1\right)}^2&gt;0.25\\ {}{\left({\alpha}_0-1.5\right)}^2+{\left({\alpha}_1-0.5\right)}^2&lt;1.5\end{array}.\right. \tag {14}\]</span></p>
<p>Both the stationarity and stability regions are shown in <a href="https://onlinelibrary.wiley.com/cms/asset/2a1bdd28-bbba-4ec3-aa4a-fbcf3823a209/nav22074-fig-0001-m.jpg">Figure 1</a>. The stationarity region (10) corresponds to the triangle. All the combinations of smoothing parameters lying below the curve in the triangle will produce the stationary harmonic trajectories, while the rest lead to the exponential trajectories. The stability condition (14) corresponds to the dark region. The stability region intersects the stationarity region, but in general stable CES can produce both stationary and non-stationary forecasts</p>
</section>
<section id="conditional-mean-and-variance-of-ces" class="level3">
<h3 class="anchored" data-anchor-id="conditional-mean-and-variance-of-ces">Conditional mean and variance of CES</h3>
<p>The conditional mean of CES for <span class="math inline">\(h\)</span> steps ahead with known $ {l}_t $ and $ {c}_t $ can be calculated using the state space model (6):</p>
<p><span class="math display">\[ \mathrm{E}\left({y}_{t+h}\mid {\mathbf{v}}_t\right)={\mathbf{w}}^{\prime }{\mathbf{F}}^{h-1}{\mathbf{v}}_t, \tag {15}\]</span></p>
<p>where $ ({y}_{t+h}<em>t)={}</em>{t+h} $ while $ $ and $ $ re the matrices from (7).</p>
<p>The forecasting trajectories of (15) will differ depending on the values of $ {l}_t, {c}_t $, and the complex smoothing parameter. The analysis of stationarity condition shows that there are several types of forecasting trajectories of CES depending on the particular value of the complex smoothing parameter:</p>
<ol type="1">
<li>When $ {}_1=1 $ all the values of forecast will be equal to the last obtained forecast, which corresponds to a flat line. This trajectory is shown in <a href="https://onlinelibrary.wiley.com/cms/asset/16feeb7e-adf2-48f6-9df9-cab3e34b6e67/nav22074-fig-0002-m.jpg">Figure 2A</a>.</li>
<li>When $ {}_1&gt;1 $ the model produces trajectory with exponential growth which is shown in <a href="https://onlinelibrary.wiley.com/cms/asset/16feeb7e-adf2-48f6-9df9-cab3e34b6e67/nav22074-fig-0002-m.jpg">Figure 2B</a>.</li>
<li>When $ &lt;{}_1&lt;1 $ trajectory becomes stationary and CES produces exponential decline shown in <a href="https://onlinelibrary.wiley.com/cms/asset/16feeb7e-adf2-48f6-9df9-cab3e34b6e67/nav22074-fig-0002-m.jpg">Figure 2C</a>.</li>
<li>When $ 1-{}_0&lt;{}_1&lt; $ trajectory becomes harmonic and will converge to zero <a href="https://onlinelibrary.wiley.com/cms/asset/16feeb7e-adf2-48f6-9df9-cab3e34b6e67/nav22074-fig-0002-m.jpg">Figure 2D</a>.</li>
<li>Finally, when $ 0&lt;{}_1&lt;1-{}_0 $ the diverging harmonic trajectory is produced, the model becomes non-stationary. This trajectory is of no use in forecasting, that is why we do not show it on graphs.</li>
</ol>
<p>Using (7) the conditional variance of CES for <span class="math inline">\(h\)</span> steps ahead with known $ {l}_t $ and $ {c}_t $ can be calculated similarly to the pure additive ETS models (Hyndman et al., 2008, p.&nbsp;96).</p>
</section>
<section id="loading-libraries-and-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-and-data">Loading libraries and data <a class="anchor" id="loading"></a></h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Statsforecast will be needed. To install, see <a href="../../docs/getting-started/installation.html">instructions</a>.</p>
</div>
</div>
<p>Next, we import plotting libraries and configure the plotting style.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_pacf</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'lines.linewidth'</span>] <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>dark_style <span class="op">=</span> {</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.facecolor'</span>: <span class="st">'#212946'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.facecolor'</span>: <span class="st">'#212946'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'savefig.facecolor'</span>:<span class="st">'#212946'</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.grid'</span>: <span class="va">True</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.grid.which'</span>: <span class="st">'both'</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.left'</span>: <span class="va">False</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.right'</span>: <span class="va">False</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.top'</span>: <span class="va">False</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.bottom'</span>: <span class="va">False</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.color'</span>: <span class="st">'#2A3459'</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.linewidth'</span>: <span class="st">'1'</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'text.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelcolor'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">12</span> }</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(dark_style)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pylab <span class="im">import</span> rcParams</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">18</span>,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/Naren8520/Serie-de-tiempo-con-Machine-Learning/main/Data/Esperanza_vida.csv"</span>, usecols<span class="op">=</span>[<span class="dv">1</span>,<span class="dv">2</span>])</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1960-01-01</td>
<td>69.123902</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1961-01-01</td>
<td>69.760244</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1962-01-01</td>
<td>69.149756</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1963-01-01</td>
<td>69.248049</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1964-01-01</td>
<td>70.311707</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The input to StatsForecast is always a data frame in long format with three columns: unique_id, ds and y:</p>
<ul>
<li><p>The <code>unique_id</code> (string, int or category) represents an identifier for the series.</p></li>
<li><p>The <code>ds</code> (datestamp) column should be of a format expected by Pandas, ideally YYYY-MM-DD for a date or YYYY-MM-DD HH:MM:SS for a timestamp.</p></li>
<li><p>The <code>y</code> (numeric) represents the measurement we wish to forecast.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"unique_id"</span>]<span class="op">=</span><span class="st">"1"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.columns<span class="op">=</span>[<span class="st">"ds"</span>, <span class="st">"y"</span>, <span class="st">"unique_id"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1960-01-01</td>
<td>69.123902</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1961-01-01</td>
<td>69.760244</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1962-01-01</td>
<td>69.149756</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1963-01-01</td>
<td>69.248049</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1964-01-01</td>
<td>70.311707</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now, let‚Äôs now check the last few rows of our time series using the <code>.tail()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ds            object
y            float64
unique_id     object
dtype: object</code></pre>
</div>
</div>
<p>We need to convert the <code>ds</code> from <code>object</code> type to datetime.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ds"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"ds"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="explore-data-with-the-plot-method" class="level2">
<h2 class="anchored" data-anchor-id="explore-data-with-the-plot-method">Explore data with the plot method <a class="anchor" id="plotting"></a></h2>
<p>Plot some series using the plot method from the StatsForecast class. This method prints a random series from the dataset and is useful for basic EDA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>StatsForecast.plot(df, engine<span class="op">=</span><span class="st">"matplotlib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="autocorrelation-plots" class="level3">
<h3 class="anchored" data-anchor-id="autocorrelation-plots">Autocorrelation plots</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plot_acf(df[<span class="st">"y"</span>],  lags<span class="op">=</span><span class="dv">20</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>],color<span class="op">=</span><span class="st">"fuchsia"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">"Autocorrelation"</span>)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Grafico</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>plot_pacf(df[<span class="st">"y"</span>],  lags<span class="op">=</span><span class="dv">20</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>],color<span class="op">=</span><span class="st">"lime"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Partial Autocorrelation'</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.savefig("Gr√°fico de Densidad y qq")</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="decomposition-of-the-time-series" class="level3">
<h3 class="anchored" data-anchor-id="decomposition-of-the-time-series">Decomposition of the time series</h3>
<p>How to decompose a time series and why?</p>
<p>In time series analysis to forecast new values, it is very important to know past data. More formally, we can say that it is very important to know the patterns that values follow over time. There can be many reasons that cause our forecast values to fall in the wrong direction. Basically, a time series consists of four components. The variation of those components causes the change in the pattern of the time series. These components are:</p>
<ul>
<li><strong>Level:</strong> This is the primary value that averages over time.</li>
<li><strong>Trend:</strong> The trend is the value that causes increasing or decreasing patterns in a time series.</li>
<li><strong>Seasonality:</strong> This is a cyclical event that occurs in a time series for a short time and causes short-term increasing or decreasing patterns in a time series.</li>
<li><strong>Residual/Noise:</strong> These are the random variations in the time series.</li>
</ul>
<p>Combining these components over time leads to the formation of a time series. Most time series consist of level and noise/residual and trend or seasonality are optional values.</p>
<p>If seasonality and trend are part of the time series, then there will be effects on the forecast value. As the pattern of the forecasted time series may be different from the previous time series.</p>
<p>The combination of the components in time series can be of two types: * Additive * Multiplicative</p>
</section>
<section id="additive-time-series" class="level3">
<h3 class="anchored" data-anchor-id="additive-time-series">Additive time series</h3>
<p>If the components of the time series are added to make the time series. Then the time series is called the additive time series. By visualization, we can say that the time series is additive if the increasing or decreasing pattern of the time series is similar throughout the series. The mathematical function of any additive time series can be represented by: <span class="math display">\[y(t) = level + Trend + seasonality + noise\]</span></p>
</section>
<section id="multiplicative-time-series" class="level3">
<h3 class="anchored" data-anchor-id="multiplicative-time-series">Multiplicative time series</h3>
<p>If the components of the time series are multiplicative together, then the time series is called a multiplicative time series. For visualization, if the time series is having exponential growth or decline with time, then the time series can be considered as the multiplicative time series. The mathematical function of the multiplicative time series can be represented as.</p>
<p><span class="math display">\[y(t) = Level * Trend * seasonality * Noise\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.seasonal <span class="im">import</span> seasonal_decompose </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> seasonal_decompose(df[<span class="st">"y"</span>], model <span class="op">=</span> <span class="st">"add"</span>, period<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>a.plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="split-the-data-into-training-and-testing" class="level2">
<h2 class="anchored" data-anchor-id="split-the-data-into-training-and-testing">Split the data into training and testing<a class="anchor" id="splitting"></a></h2>
<p>Let‚Äôs divide our data into sets</p>
<ol type="1">
<li>Data to train our model.</li>
<li>Data to test our model.</li>
</ol>
<p>For the test data we will use the last 12 months to test and evaluate the performance of our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> df[df.ds<span class="op">&lt;=</span><span class="st">'2013-01-01'</span>] </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> df[df.ds<span class="op">&gt;</span><span class="st">'2013-01-01'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>train.shape, test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((54, 3), (6, 3))</code></pre>
</div>
</div>
<p>Now let‚Äôs plot the training data and the test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(train,x<span class="op">=</span><span class="st">"ds"</span>, y<span class="op">=</span><span class="st">"y"</span>, label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(test, x<span class="op">=</span><span class="st">"ds"</span>, y<span class="op">=</span><span class="st">"y"</span>, label<span class="op">=</span><span class="st">"Test"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="implementation-of-autoces-with-statsforecast" class="level2">
<h2 class="anchored" data-anchor-id="implementation-of-autoces-with-statsforecast">Implementation of AutoCES with StatsForecast <a class="anchor" id="implementation"></a></h2>
<p>To also know more about the parameters of the functions of the <code>AutoCES Model</code>, they are listed below. For more information, visit the <a href="https://nixtla.github.io/statsforecast/src/core/models.html#autoces">documentation</a></p>
<pre><code>model : str
    Controlling state-space-equations.
season_length : int
    Number of observations per unit of time. Ex: 24 Hourly data.
alias : str
    Custom name of the model.
prediction_intervals : Optional[ConformalIntervals]
    Information to compute conformal prediction intervals.
    By default, the model will compute the native prediction
    intervals.</code></pre>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">Load libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> AutoCES</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.arima <span class="im">import</span> arima_string</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="instantiate-model" class="level3">
<h3 class="anchored" data-anchor-id="instantiate-model">Instantiate Model</h3>
<p>Import and instantiate the models. Setting the argument is sometimes tricky. This article on <a href="https://robjhyndman.com/hyndsight/seasonal-periods/">Seasonal periods</a>) by the master, Rob Hyndmann, can be useful <code>season_length</code></p>
<p><strong>Note</strong></p>
<p>Automatically selects the best <code>Complex Exponential Smoothing model</code> using an information criterion. Default is Akaike Information Criterion (AICc), while particular models are estimated using maximum likelihood. The state-space equations can be determined based on their <span class="math inline">\(S\)</span> simple, <span class="math inline">\(P\)</span> parial, <span class="math inline">\(Z\)</span> optimized or <span class="math inline">\(N\)</span> ommited components. The model string parameter defines the kind of CES model: <span class="math inline">\(N\)</span> for simple CES (withous seasonality), <span class="math inline">\(S\)</span> for simple seasonality (lagged CES), <span class="math inline">\(P\)</span> for partial seasonality (without complex part), <span class="math inline">\(F\)</span> for full seasonality (lagged CES with real and complex seasonal parts).</p>
<p>If the component is selected as <span class="math inline">\(Z\)</span>, it operates as a placeholder to ask the AutoCES model to figure out the best parameter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>season_length <span class="op">=</span> <span class="dv">1</span> <span class="co"># year data </span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="op">=</span> <span class="bu">len</span>(test) <span class="co"># number of predictions</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We call the model that we are going to use</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [AutoCES(season_length<span class="op">=</span>season_length)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit the models by instantiating a new StatsForecast object with the following parameters:</p>
<p>models: a list of models. Select the models you want from models and import them.</p>
<ul>
<li><p><code>freq:</code> a string indicating the frequency of the data. (See <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">pandas‚Äô available frequencies</a>.)</p></li>
<li><p><code>n_jobs:</code> n_jobs: int, number of jobs used in the parallel processing, use -1 for all cores.</p></li>
<li><p><code>fallback_model:</code> a model to be used if a model fails.</p></li>
</ul>
<p>Any settings are passed into the constructor. Then you call its fit method and pass in the historical data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sf <span class="op">=</span> StatsForecast(df<span class="op">=</span>train,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                   models<span class="op">=</span>models,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                   freq<span class="op">=</span><span class="st">'YS'</span>, </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                   n_jobs<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-the-model">Fit the Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>sf.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>StatsForecast(models=[CES])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>sf.fitted_[<span class="dv">0</span>,<span class="dv">0</span>].model_</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.keys())</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result[<span class="st">'fit'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys(['loglik', 'aic', 'bic', 'aicc', 'mse', 'amse', 'fit', 'fitted', 'residuals', 'm', 'states', 'par', 'n', 'seasontype', 'sigma2', 'actual_residuals'])
results(x=array([1.63706552, 1.00511519]), fn=76.78049826760919, nit=27, simplex=array([[1.63400329, 1.00510199],
       [1.63706552, 1.00511519],
       [1.63638944, 1.00512037]]))</code></pre>
</div>
</div>
<p>Let us now visualize the residuals of our models.</p>
<p>As we can see, the result obtained above has an output in a dictionary, to extract each element from the dictionary we are going to use the <code>.get()</code> function to extract the element and then we are going to save it in a <code>pd.DataFrame()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>residual<span class="op">=</span>pd.DataFrame(result.get(<span class="st">"residuals"</span>), columns<span class="op">=</span>[<span class="st">"residual Model"</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">residual Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-0.727729</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.144552</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-0.762086</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51</td>
<td>-0.073258</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">52</td>
<td>-0.234578</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">53</td>
<td>0.109990</td>
</tr>
</tbody>
</table>

<p>54 rows √ó 1 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot[1,1]</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>residual.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"Residuals"</span>)<span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>sns.distplot(residual, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">"Density plot - Residual"</span>)<span class="op">;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>stats.probplot(residual[<span class="st">"residual Model"</span>], dist<span class="op">=</span><span class="st">"norm"</span>, plot<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Plot Q-Q'</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>plot_acf(residual,  lags<span class="op">=</span><span class="dv">35</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>],color<span class="op">=</span><span class="st">"fuchsia"</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">"Autocorrelation"</span>)<span class="op">;</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="forecast-method" class="level3">
<h3 class="anchored" data-anchor-id="forecast-method">Forecast Method</h3>
<p>If you want to gain speed in productive settings where you have multiple series or models we recommend using the <a href="https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast"><code>StatsForecast.forecast</code></a> method instead of <code>.fit</code> and <code>.predict</code>.</p>
<p>The main difference is that the <code>.forecast</code> doest not store the fitted values and is highly scalable in distributed environments.</p>
<p>The forecast method takes two arguments: forecasts next <code>h</code> (horizon) and <code>level</code>.</p>
<ul>
<li><p><code>h (int):</code> represents the forecast h steps into the future. In this case, 12 months ahead.</p></li>
<li><p><code>level (list of floats):</code> this optional parameter is used for probabilistic forecasting. Set the level (or confidence percentile) of your prediction interval. For example, <code>level=[90]</code> means that the model expects the real value to be inside that interval 90% of the times.</p></li>
</ul>
<p>The forecast object here is a new data frame that includes a column with the name of the model and the y hat values, as well as columns for the uncertainty intervals. Depending on your computer, this step should take around 1min. (If you want to speed things up to a couple of seconds, remove the AutoModels like <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#arima"><code>ARIMA</code></a> and <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#theta"><code>Theta</code></a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>Y_hat <span class="op">=</span> sf.forecast(horizon, fitted<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">CES</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2014-01-01</td>
<td>82.906075</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-01</td>
<td>83.166687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>83.424744</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-01-01</td>
<td>83.685760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01</td>
<td>83.946213</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>84.208359</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>values<span class="op">=</span>sf.forecast_fitted_values()</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>values.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">CES</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1960-01-01</td>
<td>69.123901</td>
<td>69.851631</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1961-01-01</td>
<td>69.760246</td>
<td>69.615692</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1962-01-01</td>
<td>69.149757</td>
<td>69.911842</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1963-01-01</td>
<td>69.248047</td>
<td>69.657822</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1964-01-01</td>
<td>70.311707</td>
<td>69.601196</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>StatsForecast.plot(values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Adding 95% confidence interval with the forecast method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>sf.forecast(h<span class="op">=</span>horizon, level<span class="op">=</span>[<span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">CES</th>
<th data-quarto-table-cell-role="th">CES-lo-95</th>
<th data-quarto-table-cell-role="th">CES-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2014-01-01</td>
<td>82.906075</td>
<td>82.342484</td>
<td>83.454018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-01</td>
<td>83.166687</td>
<td>82.604027</td>
<td>83.717270</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>83.424744</td>
<td>82.858574</td>
<td>83.975868</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-01-01</td>
<td>83.685760</td>
<td>83.118942</td>
<td>84.239578</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01</td>
<td>83.946213</td>
<td>83.376907</td>
<td>84.501137</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>84.208359</td>
<td>83.637741</td>
<td>84.765411</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Y_hat<span class="op">=</span>Y_hat.reset_index()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">CES</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2014-01-01</td>
<td>82.906075</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2015-01-01</td>
<td>83.166687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2016-01-01</td>
<td>83.424744</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>2017-01-01</td>
<td>83.685760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>2018-01-01</td>
<td>83.946213</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>1</td>
<td>2019-01-01</td>
<td>84.208359</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the forecasts with the true values</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>test[<span class="st">'unique_id'</span>] <span class="op">=</span> test[<span class="st">'unique_id'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>Y_hat <span class="op">=</span> test.merge(Y_hat, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">CES</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2014-01-01</td>
<td>83.090244</td>
<td>1</td>
<td>82.906075</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-01</td>
<td>82.543902</td>
<td>1</td>
<td>83.166687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-01-01</td>
<td>83.243902</td>
<td>1</td>
<td>83.424744</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2017-01-01</td>
<td>82.946341</td>
<td>1</td>
<td>83.685760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2018-01-01</td>
<td>83.346341</td>
<td>1</td>
<td>83.946213</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2019-01-01</td>
<td>83.197561</td>
<td>1</td>
<td>84.208359</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>plot_df <span class="op">=</span> pd.concat([train, Y_hat]).set_index(<span class="st">'ds'</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>plot_df[[<span class="st">'y'</span>, <span class="st">"CES"</span>]].plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">' Forecast'</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Year '</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Timestamp [t]'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>ax.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="predict-method-with-confidence-interval" class="level3">
<h3 class="anchored" data-anchor-id="predict-method-with-confidence-interval">Predict method with confidence interval</h3>
<p>To generate forecasts use the predict method.</p>
<p>The predict method takes two arguments: forecasts the next <code>h</code> (for horizon) and <code>level</code>.</p>
<ul>
<li><p><code>h (int):</code> represents the forecast h steps into the future. In this case, 12 months ahead.</p></li>
<li><p><code>level (list of floats):</code> this optional parameter is used for probabilistic forecasting. Set the level (or confidence percentile) of your prediction interval. For example, <code>level=[95]</code> means that the model expects the real value to be inside that interval 95% of the times.</p></li>
</ul>
<p>The forecast object here is a new data frame that includes a column with the name of the model and the y hat values, as well as columns for the uncertainty intervals.</p>
<p>This step should take less than 1 second.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sf.predict(h<span class="op">=</span>horizon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">CES</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2014-01-01</td>
<td>82.906075</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-01</td>
<td>83.166687</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>83.424744</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-01-01</td>
<td>83.685760</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01</td>
<td>83.946213</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>84.208359</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> sf.predict(h<span class="op">=</span>horizon, level<span class="op">=</span>[<span class="dv">95</span>]) </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>forecast_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">CES</th>
<th data-quarto-table-cell-role="th">CES-lo-95</th>
<th data-quarto-table-cell-role="th">CES-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2014-01-01</td>
<td>82.906075</td>
<td>82.342484</td>
<td>83.454018</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2015-01-01</td>
<td>83.166687</td>
<td>82.604027</td>
<td>83.717270</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-01-01</td>
<td>83.424744</td>
<td>82.858574</td>
<td>83.975868</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-01-01</td>
<td>83.685760</td>
<td>83.118942</td>
<td>84.239578</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2018-01-01</td>
<td>83.946213</td>
<td>83.376907</td>
<td>84.501137</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2019-01-01</td>
<td>84.208359</td>
<td>83.637741</td>
<td>84.765411</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can join the forecast result with the historical data using the pandas function <code>pd.concat()</code>, and then be able to use this result for graphing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df, forecast_df]).set_index(<span class="st">'ds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">CES</th>
<th data-quarto-table-cell-role="th">CES-lo-95</th>
<th data-quarto-table-cell-role="th">CES-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1960-01-01</td>
<td>69.123902</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1961-01-01</td>
<td>69.760244</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1962-01-01</td>
<td>69.149756</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>83.685760</td>
<td>83.118942</td>
<td>84.239578</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2018-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>83.946213</td>
<td>83.376907</td>
<td>84.501137</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2019-01-01</td>
<td>NaN</td>
<td>NaN</td>
<td>84.208359</td>
<td>83.637741</td>
<td>84.765411</td>
</tr>
</tbody>
</table>

<p>66 rows √ó 5 columns</p>
</div>
</div>
</div>
<p>Now let‚Äôs visualize the result of our forecast and the historical data of our time series, also let‚Äôs draw the confidence interval that we have obtained when making the prediction with 95% confidence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_forecasts(y_hist, y_true, y_pred, models):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    _, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">7</span>))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_true.merge(y_pred, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> pd.concat([y_hist, y_true]).set_index(<span class="st">'ds'</span>).tail(<span class="dv">12</span><span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    df_plot[[<span class="st">'y'</span>] <span class="op">+</span> models].plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'orange'</span>, <span class="st">'black'</span>, <span class="st">'green'</span>]</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model, color <span class="kw">in</span> <span class="bu">zip</span>(models, colors):</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>        ax.fill_between(df_plot.index, </span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>                        df_plot[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-lo-95'</span>], </span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>                        df_plot[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-hi-95'</span>],</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">.35</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span>color,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-level-90'</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">''</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">''</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Timestamp [t]'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    ax.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>plot_forecasts(train, test, forecast_df, models<span class="op">=</span>[<span class="st">'CES'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Let‚Äôs plot the same graph using the plot function that comes in <code>Statsforecast</code>, as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>sf.plot(df, forecast_df, level<span class="op">=</span>[<span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoCES_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-validation <a class="anchor" id="cross_validate"></a></h2>
<p>In previous steps, we‚Äôve taken our historical data to predict the future. However, to asses its accuracy we would also like to know how the model would have performed in the past. To assess the accuracy and robustness of your models on your data perform Cross-Validation.</p>
<p>With time series data, Cross Validation is done by defining a sliding window across the historical data and predicting the period following it. This form of cross-validation allows us to arrive at a better estimation of our model‚Äôs predictive abilities across a wider range of temporal instances while also keeping the data in the training set contiguous as is required by our models.</p>
<p>The following graph depicts such a Cross Validation Strategy:</p>
<p><img src="https://raw.githubusercontent.com/Nixtla/statsforecast/main/nbs/imgs/ChainedWindows.gif" class="img-fluid"></p>
<section id="perform-time-series-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="perform-time-series-cross-validation">Perform time series cross-validation</h3>
<p>Cross-validation of time series models is considered a best practice but most implementations are very slow. The statsforecast library implements cross-validation as a distributed operation, making the process less time-consuming to perform. If you have big datasets you can also perform Cross Validation in a distributed cluster using Ray, Dask or Spark.</p>
<p>In this case, we want to evaluate the performance of each model for the last 5 months <code>(n_windows=5)</code>, forecasting every second months <code>(step_size=12)</code>. Depending on your computer, this step should take around 1 min.</p>
<p>The cross_validation method from the StatsForecast class takes the following arguments.</p>
<ul>
<li><p><code>df:</code> training data frame</p></li>
<li><p><code>h (int):</code> represents h steps into the future that are being forecasted. In this case, 12 months ahead.</p></li>
<li><p><code>step_size (int):</code> step size between each window. In other words: how often do you want to run the forecasting processes.</p></li>
<li><p><code>n_windows(int):</code> number of windows used for cross validation. In other words: what number of forecasting processes in the past do you want to evaluate.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df <span class="op">=</span> sf.cross_validation(df<span class="op">=</span>train,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                                         h<span class="op">=</span>horizon,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                         step_size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                                         n_windows<span class="op">=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The crossvaldation_df object is a new data frame that includes the following columns:</p>
<ul>
<li><code>unique_id:</code> index. If you dont like working with index just run crossvalidation_df.resetindex()</li>
<li><code>ds:</code> datestamp or temporal index</li>
<li><code>cutoff:</code> the last datestamp or temporal index for the n_windows.</li>
<li><code>y:</code> true value</li>
<li><code>"model":</code> columns with the model‚Äôs name and fitted value.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">cutoff</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">CES</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1984-01-01</td>
<td>1983-01-01</td>
<td>75.389511</td>
<td>74.952705</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1985-01-01</td>
<td>1983-01-01</td>
<td>75.470734</td>
<td>75.161736</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-01-01</td>
<td>1983-01-01</td>
<td>75.770729</td>
<td>75.377945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1987-01-01</td>
<td>1983-01-01</td>
<td>76.219513</td>
<td>75.590378</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1988-01-01</td>
<td>1983-01-01</td>
<td>76.370735</td>
<td>75.806343</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation <a class="anchor" id="evaluate"></a></h2>
<p>We can now compute the accuracy of the forecast using an appropiate accuracy metric. Here we‚Äôll use the Root Mean Squared Error (RMSE). To do this, we first need to <code>install datasetsforecast</code>, a Python library developed <strong>by Nixtla</strong> that includes a function to compute the RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasetsforecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.losses <span class="im">import</span> rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function to compute the RMSE takes two arguments:</p>
<ol type="1">
<li>The actual values.</li>
<li>The forecasts, in this case, AutoCES.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> rmse(crossvalidation_df[<span class="st">'y'</span>], crossvalidation_df[<span class="st">"CES"</span>])</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RMSE using cross-validation: "</span>, rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE using cross-validation:  0.40604722</code></pre>
</div>
</div>
<p>As you have noticed, we have used the cross validation results to perform the evaluation of our model.</p>
<p>Now we are going to evaluate our model with the results of the predictions, we will use different types of metrics MAE, MAPE, MASE, RMSE, SMAPE to evaluate the accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.losses <span class="im">import</span> (mae, mape, mase, rmse, smape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_performace(y_hist, y_hat, model):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    evaluation <span class="op">=</span> {}</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    evaluation[model] <span class="op">=</span> {}</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> metric <span class="kw">in</span> [mase, mae, mape, rmse, smape]:</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        metric_name <span class="op">=</span> metric.<span class="va">__name__</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> metric_name <span class="op">==</span> <span class="st">'mase'</span>:</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>            evaluation[model][metric_name] <span class="op">=</span> metric(y_hat[<span class="st">'y'</span>].values, </span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>                                                y_hat[model].values, </span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>                                                y_hist[<span class="st">'y'</span>].values, seasonality<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>            evaluation[model][metric_name] <span class="op">=</span> metric(y_hat[<span class="st">'y'</span>].values, y_hat[model].values)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(evaluation).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>evaluate_performace(train, Y_hat, model<span class="op">=</span><span class="st">"CES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mae</th>
<th data-quarto-table-cell-role="th">mape</th>
<th data-quarto-table-cell-role="th">mase</th>
<th data-quarto-table-cell-role="th">rmse</th>
<th data-quarto-table-cell-role="th">smape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">CES</td>
<td>0.556314</td>
<td>0.669916</td>
<td>0.087037</td>
<td>0.630183</td>
<td>0.667133</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>We would like to thank <a href="https://www.linkedin.com/in/naren-castellon-1541b8101/?originalSubdomain=pa">Naren Castellon</a> for writing this tutorial.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References <a class="anchor" id="references"></a></h2>
<ol type="1">
<li><p><a href="https://nixtla.github.io/statsforecast/src/core/models.html#autoces">Nixtla-AutoCES</a></p></li>
<li><p><a href="https://otexts.com/fpp3/tscv.html">Rob J. Hyndman and George Athanasopoulos (2018). ‚ÄúForecasting principles and practice, Time series cross-validation‚Äù.</a></p></li>
<li><p><a href="https://onlinelibrary.wiley.com/doi/full/10.1002/nav.22074">Complex exponential smoothing</a></p></li>
</ol>


</section>
</section>

<p>Give us a ‚≠ê&nbsp;on <a href="https://github.com/nixtla/statsforecast">Github</a></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>