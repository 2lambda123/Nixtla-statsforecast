<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Step-by-step guide on using the AutoRegressive Model with Statsforecast.">

<title>statsforecast - AutoRegressive Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon_png.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NXJNCVR18L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NXJNCVR18L', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="statsforecast - AutoRegressive Model">
<meta property="og:description" content="Step-by-step guide on using the AutoRegressive Model with Statsforecast.">
<meta property="og:image" content="https://github.com/Nixtla/styles/blob/2abf51612584169874c90cd7c4d347e3917eaf73/images/Banner%20Github.png">
<meta property="og:site-name" content="statsforecast">
<meta name="twitter:title" content="statsforecast - AutoRegressive Model">
<meta name="twitter:description" content="Step-by-step guide on using the AutoRegressive Model with Statsforecast.">
<meta name="twitter:image" content="https://farm6.staticflickr.com/5510/14338202952_93595258ff_z.jpg">
<meta name="twitter:site" content="@Nixtlainc">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">statsforecast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../docs/getting-started/getting_started_short.html" rel="" target="" aria-current="page">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nixtlaverse" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NixtlaVerse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nixtlaverse">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast" rel="" target="">
 <span class="dropdown-text">StatsForecast ‚ö°Ô∏è</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/mlforecast" rel="" target="">
 <span class="dropdown-text">MLForecast ü§ñ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/neuralforecast" rel="" target="">
 <span class="dropdown-text">NeuralForecast üß†</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/hierarchicalforecast" rel="" target="">
 <span class="dropdown-text">HierarchicalForecast üëë</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast/issues/new/choose" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://join.slack.com/t/nixtlaworkspace/shared_invite/zt-135dssye9-fWTzMpv2WBthq8NK0Yvu6A" rel="" target=""><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Join our Slack</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nixtla/statsforecast" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nixtlainc" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Nixtla Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/models/adida.html">Model References</a></li><li class="breadcrumb-item"><a href="../../docs/models/autoregressive.html">AutoRegressive Model</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ‚ö°Ô∏è</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_complete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/anomalydetection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anomaly Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/conformalprediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conformal Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/crossvalidation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricityloadforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Electricity Load Forecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricitypeakforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detect Demand Peaks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/garch_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Volatility forecasting (GARCH &amp; ARCH)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/intermittentdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent or Sparse Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/multipleseasonalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple seasonalities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/statisticalneuralmethods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical, Machine Learning and Neural Forecasting methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/uncertaintyintervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">How-To Guides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/automatic_forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Time Series Forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/amazonstatsforecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Amazon Forecast vs StatsForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/autoarima_vs_prophet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Comparison (Prophet and pmdarima)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ets_ray_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting at Scale using ETS and ray (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/exogenous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exogenous Regressors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/getting_started_complete_polars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough with Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/migrating_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Migrating from R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/mlflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLFlow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/numba_cache.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numba caching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/prophet_spark_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ETS and Facebook Prophet on Spark (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ray</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Model References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/adida.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADIDA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoarima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoCES Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoETS Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoregressive.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">AutoRegressive Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autotheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoTheta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonclassic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonClassic Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonOptimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonsba.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonSBA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicoptimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicstandardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/garch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holtwinters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Winters Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/imapa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IMAPA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/multipleseasonaltrend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Seasonal Trend (MSTL)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/optimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothingoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/standardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/tsb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TSB Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">API Reference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/distributed.fugue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FugueBackend</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast‚Äôs Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/contribute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contribute to Nixtla</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/docs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nixtla Documentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issue-labels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding Issue Labels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submit an Issue üì¢</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/step-by-step.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step-by-step Contribution Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/techstack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing Code to Nixtla Development</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link active" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction** </a><a class="anchor nav-link" id="introduction" data-scroll-target="undefined"></a></li>
  <li><a href="#definition-of-autoregressive-models" id="toc-definition-of-autoregressive-models" class="nav-link" data-scroll-target="#definition-of-autoregressive-models">Definition of Autoregressive Models </a><a class="anchor nav-link" id="model" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#definition-of-pacf" id="toc-definition-of-pacf" class="nav-link" data-scroll-target="#definition-of-pacf">Definition of PACF</a></li>
  <li><a href="#properties-of-autoregressive-models" id="toc-properties-of-autoregressive-models" class="nav-link" data-scroll-target="#properties-of-autoregressive-models">Properties of Autoregressive Models</a></li>
  <li><a href="#stationarity-and-causality-of-ar-models" id="toc-stationarity-and-causality-of-ar-models" class="nav-link" data-scroll-target="#stationarity-and-causality-of-ar-models">Stationarity and Causality of AR Models</a></li>
  <li><a href="#autocorrelation-the-past-influences-the-present" id="toc-autocorrelation-the-past-influences-the-present" class="nav-link" data-scroll-target="#autocorrelation-the-past-influences-the-present">Autocorrelation: the past influences the present</a></li>
  <li><a href="#positive-and-negative-autocorrelation" id="toc-positive-and-negative-autocorrelation" class="nav-link" data-scroll-target="#positive-and-negative-autocorrelation">Positive and negative autocorrelation</a></li>
  <li><a href="#stationarity-and-the-adf-test" id="toc-stationarity-and-the-adf-test" class="nav-link" data-scroll-target="#stationarity-and-the-adf-test">Stationarity and the ADF test</a></li>
  </ul></li>
  <li><a href="#loading-libraries-and-data" id="toc-loading-libraries-and-data" class="nav-link" data-scroll-target="#loading-libraries-and-data">Loading libraries and data </a><a class="anchor nav-link" id="loading" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read Data</a></li>
  </ul></li>
  <li><a href="#explore-data-with-the-plot-method" id="toc-explore-data-with-the-plot-method" class="nav-link" data-scroll-target="#explore-data-with-the-plot-method">Explore data with the plot method </a><a class="anchor nav-link" id="plotting" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#the-augmented-dickey-fuller-test" id="toc-the-augmented-dickey-fuller-test" class="nav-link" data-scroll-target="#the-augmented-dickey-fuller-test">The Augmented Dickey-Fuller Test</a></li>
  <li><a href="#how-many-lags-should-we-include" id="toc-how-many-lags-should-we-include" class="nav-link" data-scroll-target="#how-many-lags-should-we-include">How many lags should we include?</a></li>
  </ul></li>
  <li><a href="#split-the-data-into-training-and-testing" id="toc-split-the-data-into-training-and-testing" class="nav-link" data-scroll-target="#split-the-data-into-training-and-testing">Split the data into training and testing</a><a class="anchor nav-link" id="splitting" data-scroll-target="undefined"></a></li>
  <li><a href="#implementation-of-autoregressive-with-statsforecast" id="toc-implementation-of-autoregressive-with-statsforecast" class="nav-link" data-scroll-target="#implementation-of-autoregressive-with-statsforecast">Implementation of AutoRegressive with StatsForecast </a><a class="anchor nav-link" id="implementation" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li><a href="#instantiating-model" id="toc-instantiating-model" class="nav-link" data-scroll-target="#instantiating-model">Instantiating Model</a></li>
  <li><a href="#fit-model" id="toc-fit-model" class="nav-link" data-scroll-target="#fit-model">Fit Model</a></li>
  <li><a href="#forecast-method" id="toc-forecast-method" class="nav-link" data-scroll-target="#forecast-method">Forecast Method</a></li>
  <li><a href="#predict-method-with-confidence-interval" id="toc-predict-method-with-confidence-interval" class="nav-link" data-scroll-target="#predict-method-with-confidence-interval">Predict method with confidence interval</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-validation </a><a class="anchor nav-link" id="cross_validate" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#perform-time-series-cross-validation" id="toc-perform-time-series-cross-validation" class="nav-link" data-scroll-target="#perform-time-series-cross-validation">Perform time series cross-validation</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation </a><a class="anchor nav-link" id="evaluate" data-scroll-target="undefined"></a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References </a><a class="anchor nav-link" id="references" data-scroll-target="undefined"></a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Nixtla/statsforecast/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AutoRegressive Model</h1>
</div>

<div>
  <div class="description">
    Step-by-step guide on using the <code>AutoRegressive Model</code> with <code>Statsforecast</code>.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#model">Autoregressive Models</a></li>
<li><a href="#loading">Loading libraries and data</a></li>
<li><a href="#plotting">Explore data with the plot method</a></li>
<li><a href="#splitting">Split the data into training and testing</a></li>
<li><a href="#implementation">Implementation of AutoRegressive with StatsForecast</a></li>
<li><a href="#cross_validate">Cross-validation</a></li>
<li><a href="#evaluate">Model evaluation</a></li>
<li><a href="#references">References</a></li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction** <a class="anchor" id="introduction"></a></h2>
<p>The <code>autoregressive</code> time series model <code>(AutoRegressive)</code> is a <code>statistical</code> technique used to analyze and predict univariate time series. In essence, the <code>autoregressive model</code> is based on the idea that previous values of the time series can be used to predict future values.</p>
<p>In this model, the dependent variable (the time series) returns to itself at different moments in time, creating a dependency relationship between past and present values. The idea is that past values can help us understand and predict future values of the series.</p>
<p>The <code>autoregressive model</code> can be fitted to different orders, which indicate how many past values are used to predict the present value. For example, an <code>autoregressive model</code> of order 1 <span class="math inline">\((AR(1))\)</span> uses only the immediately previous value to predict the current value, while an <code>autoregressive model</code> of order <span class="math inline">\(p (AR(p))\)</span> uses the <span class="math inline">\(p\)</span> previous values.</p>
<p>The <code>autoregressive model</code> is one of the basic models of time series analysis and is widely used in a variety of fields, from finance and economics to meteorology and social sciences. The model‚Äôs ability to capture nonlinear dependencies in time series data makes it especially useful for forecasting and long-term trend analysis.</p>
<p>In a <code>multiple regression model</code>, we forecast the variable of interest using a linear combination of predictors. In an <code>autoregression model</code>, we forecast the variable of interest using a <code>linear combination</code> of past values of the variable. The term <code>autoregression</code> indicates that it is a regression of the variable against itself.</p>
</section>
<section id="definition-of-autoregressive-models" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-autoregressive-models">Definition of Autoregressive Models <a class="anchor" id="model"></a></h2>
<p>Before giving a formal definition of the ARCH model, let‚Äôs define the components of an ARCH model in a general way: * Autoregressive, a concept that we have already known, is the construction of a univariate time series model using statistical methods, which means that the current value of a variable is influenced by past values of itself in different periods. * Heteroscedasticity means that the model can have different magnitudes or variability at different time points (variance changes over time). * Conditional, since volatility is not fixed, the reference here is the constant that we put in the model to limit heteroscedasticity and make it conditionally dependent on the previous value or values of the variable.</p>
<p>The AR model is the most basic building block of univariate time series. As you have seen before, univariate time series are a family of models that use only information about the target variable‚Äôs past to forecast its future, and do not rely on other explanatory variables.</p>
<p><strong>Definition 1.</strong> (1) The following equation is called the autoregressive model of order <span class="math inline">\(p\)</span> and denoted by <span class="math inline">\(\text{AR(p)}\)</span>:</p>
<p><span class="math display">\[ Xt =\varphi_0 +\varphi_1X_{t‚àí1}+\varphi_2X_{t‚àí2}+\cdots+\varphi_p X_{t‚àíp}+\varepsilon_t  \tag 1\]</span></p>
<p>where <span class="math inline">\(\{\varepsilon_t \} \sim WN(0,\sigma_{\epsilon}^2)\)</span>, <span class="math inline">\(E(X_s \varepsilon_t) = 0\)</span> if <span class="math inline">\(s &lt; t\)</span> and <span class="math inline">\(\varphi_0,\varphi_1,\cdots ,\varphi_p\)</span> are real-valued parameters (coefficients) with <span class="math inline">\(\varphi_p \neq 0\)</span>.</p>
<ol start="2" type="1">
<li>If a time series <span class="math inline">\(\{X_t \}\)</span> is stationary and satisfies such an equation as (1), then we call it an <span class="math inline">\(\text{AR(p)}\)</span> process.</li>
</ol>
<p>Note the following remarks about this definition:</p>
<ul>
<li><p>For simplicity, we often assume that the intercept (const term) <span class="math inline">\(\varphi_0 = 0\)</span>; otherwise, we can consider <span class="math inline">\(\{X_t ‚àí\mu \}\)</span> where <span class="math inline">\(\mu =\varphi_0 /(1‚àí\varphi_1 ‚àí \cdots ‚àí\varphi_p)\)</span>.</p></li>
<li><p>We distinguish the concept of <span class="math inline">\(\text{AR}\)</span> models from the concept of <span class="math inline">\(\text{AR}\)</span> processes. <span class="math inline">\(\text{AR}\)</span> models may or may not be stationary and <span class="math inline">\(\text{AR}\)</span> processes must be stationary.</p></li>
<li><p><span class="math inline">\(E(X_s \varepsilon_t) = 0(s &lt; t)\)</span> means that <span class="math inline">\(X_s\)</span> in the past has nothing to do with <span class="math inline">\(\varepsilon_t\)</span> at the current time <span class="math inline">\(t\)</span>.</p></li>
<li><p>Like the definition of MA models, sometimes Œµt in Eq.(1) is called the innovation or shock term.</p></li>
</ul>
<p>In addition, using the backshift(<a href="https://otexts.com/fpp3/backshift.html">see</a>) operator <span class="math inline">\(B\)</span>, the <span class="math inline">\(\text{AR(p)}\)</span> model can be rewritten as</p>
<p><span class="math display">\[ \varphi(B)X_t = \varepsilon_t \]</span></p>
<p>where <span class="math inline">\(\varphi(z) = 1 ‚àí \varphi_1z ‚àí \cdots ‚àí \varphi_p z^p\)</span> is called the (corresponding) <span class="math inline">\(\text{AR}\)</span> polynomial. Besides, in the Python package |StatsModels|, <span class="math inline">\(\varphi(B)\)</span> is called the <span class="math inline">\(\text{AR}\)</span> lag polynomial.</p>
<section id="definition-of-pacf" class="level3">
<h3 class="anchored" data-anchor-id="definition-of-pacf">Definition of PACF</h3>
<p>Let <span class="math inline">\(\{X_t \}\)</span> be a stationary time series with <span class="math inline">\(E(X_t) = 0\)</span>. Here the assumption <span class="math inline">\(E(X_t ) = 0\)</span> is for conciseness only. If <span class="math inline">\(E(X_t) = \mu \neq 0\)</span>, it is okay to replace <span class="math inline">\(\{X_t \}\)</span> by <span class="math inline">\(\{X_t ‚àí \mu \}\)</span>. Now consider the linear regression (prediction) of <span class="math inline">\(X_t\)</span> on <span class="math inline">\(\{X_{t‚àík+1:t‚àí1} \}\)</span> for any integer <span class="math inline">\(k ‚â• 2\)</span>. We use <span class="math inline">\(\hat X_t\)</span> to denote this regression (prediction):</p>
<p><span class="math display">\[\hat X_t =\alpha_1 X_{t‚àí1}+ \cdots +\alpha_{k‚àí1} X_{t‚àík+1}\]</span></p>
<p>where <span class="math inline">\(\{\alpha_1, \cdots , \alpha_{k‚àí1} \}\)</span> satisfy</p>
<p><span class="math display">\[\{\alpha_1, \cdots , \alpha_{k‚àí1} \}=\argmin_{Œ≤1,¬∑¬∑¬∑,Œ≤k‚àí1} E[X_t ‚àí(\beta_1 X_{t‚àí1} +\cdots +\beta_{k‚àí1}X_{t‚àík+1})]^2 \]</span></p>
<p>That is, <span class="math inline">\(\{\alpha_1, \cdots , \alpha_{k‚àí1} \}\)</span> are chosen by minimizing the mean squared error of prediction. Similarly, let <span class="math inline">\(\hat X_{t ‚àík}\)</span> denote the regression (prediction) of <span class="math inline">\(X_{t ‚àík}\)</span> on <span class="math inline">\(\{X_{t ‚àík+1:t ‚àí1} \}\)</span>:</p>
<p><span class="math display">\[\hat X_{t‚àík} =\eta_1 X_{t‚àí1}+ \cdots +\eta_{k‚àí1} X_{t‚àík+1}\]</span></p>
<p>Note that if <span class="math inline">\(\{X_t \}\)</span> is stationary, then <span class="math inline">\(\{ \alpha_{1:k‚àí1}\} = \{\eta_{1:k‚àí1} \}\)</span>. Now let <span class="math inline">\(\hat Z_{t‚àík} = X_{t‚àík} ‚àí \hat X_{t‚àík}\)</span> and <span class="math inline">\(\hat Z_t = X_t ‚àí \hat X_t\)</span>. Then <span class="math inline">\(\hat Z_{t‚àík}\)</span> is the residual of removing the effect of the intervening variables <span class="math inline">\(\{X_{t‚àík+1:t‚àí1} \}\)</span> from <span class="math inline">\(X_{t‚àík}\)</span>, and <span class="math inline">\(\hat Z_t\)</span> is the residual of removing the effect of <span class="math inline">\(\{X_{t ‚àík+1:t ‚àí1} \}\)</span> from <span class="math inline">\(X_t\)</span>.</p>
<p><strong>Definition 2.</strong> The partial autocorrelation function(PACF) at lag <span class="math inline">\(k\)</span> of astationary time series <span class="math inline">\(\{X_t \}\)</span> with <span class="math inline">\(E(X_t ) = 0\)</span> is</p>
<p><span class="math display">\[\phi_{11} = Corr(X_{t‚àí1}, X_t ) = \frac{Cov(X_{t‚àí1}, X_t )} {[Var(X_{t‚àí1})Var(X_t)]^1/2}=\rho_1 \]</span></p>
<p>and</p>
<p><span class="math display">\[\phi_{kk} = Corr(\hat Z_{t‚àík},\hat Z_t)=\frac{Cov(\hat Z_{t‚àík},\hat Z_t)} {[Var(\hat Z_{t‚àík})Var(\hat Z_t)]^{1/2}}\]</span></p>
<p>According to the property of correlation coefficient (see, e.g., P172, Casella and Berger 2002), |œÜkk| ‚â§ 1. On the other hand, the following theorem paves the way to estimate the PACF of a stationary time series, and its proof can be seen in Fan and Yao (2003).</p>
<p>On the other hand, the following theorem paves the way to estimate the PACF of a stationary time series, and its proof can be seen in Fan and Yao (2003).</p>
<p><strong>Theorem 1.</strong> Let <span class="math inline">\(\{X_t \}\)</span> be a stationary time series with <span class="math inline">\(E(X_t) = 0\)</span>, and <span class="math inline">\(\{a_{1k},\cdots ,a_{kk} \}\)</span> satisfy</p>
<p><span class="math display">\[\{a_{1k},\cdots,a_{kk} \}=\argmin_{a_1 ,\cdots ,a_k} E(X_{t ‚àía1}X_{t‚àí1}‚àí\cdots ‚àía_k X_{t‚àík})^2 \]</span></p>
<p>Then <span class="math inline">\(\phi_{kk}=a_{kk}\)</span> for <span class="math inline">\(k‚â•1\)</span>.</p>
</section>
<section id="properties-of-autoregressive-models" class="level3">
<h3 class="anchored" data-anchor-id="properties-of-autoregressive-models">Properties of Autoregressive Models</h3>
<p>From the <span class="math inline">\(\text{AR(p)}\)</span> model, namely, Eq. (1), we can see that it is in the same form as the multiple linear regression model. However, it explains current itself with its own past. Given the past</p>
<p><span class="math display">\[\{X_{(t‚àíp):(t‚àí1)} \} = \{x_{(t‚àíp):(t‚àí1)} \} \]</span></p>
<p>we have <span class="math display">\[E(X_t |X_{(t‚àíp):(t‚àí1)}) = \varphi_0 + \varphi_1x_{t‚àí1} + \varphi_2 x_{t‚àí2} + \cdots + \varphi_p x_{t‚àíp} \]</span></p>
<p>This suggests that given the past, the right-hand side of this equation is a good estimate of <span class="math inline">\(X_t\)</span> . Besides</p>
<p><span class="math display">\[Var(X_t |X_{(t ‚àíp):(t ‚àí1)}) = Var(\varepsilon_t ) = \sigma_{\varepsilon}^2 \]</span></p>
<p>Now we suppose that the AR(p) model, namely, Eq. (1), is stationary; then we have</p>
<ol type="1">
<li><p>The model mean <span class="math inline">\(E(_Xt)=\mu =\varphi_0 / (1‚àí\varphi_1‚àí¬∑¬∑¬∑‚àí\varphi_p)\)</span> .Thus,themodelmean <span class="math inline">\(\mu=0\)</span> if and only if <span class="math inline">\(\varphi_0 =0\)</span>.</p></li>
<li><p>If the mean is zero or <span class="math inline">\(\varphi_0 = 0\)</span> ((3) and (4) below have the same assumption), noting that <span class="math inline">\(E(X_t \varepsilon_t ) = \sigma_{\varepsilon}^2\)</span> , we multiply Eq. (1) by <span class="math inline">\(X_t\)</span> , take expectations, and then get</p></li>
</ol>
<p><span class="math display">\[\text {Var} (X_t) = \gamma_0 = \varphi_1 \gamma_1 + \varphi_2 \gamma2 + \cdots + \varphi_p \gamma_p + \sigma_{\varepsilon}^2\]</span></p>
<p>Furthermore</p>
<p><span class="math display">\[\gamma_0 = \sigma_{\varepsilon}^2 / ( 1 ‚àí \varphi_1 \rho_1 ‚àí \varphi_2 \rho_2 ‚àí \cdots ‚àí \varphi_p \rho_p )  \]</span></p>
<ol start="3" type="1">
<li>For all <span class="math inline">\(k &gt; p\)</span>, the partial autocorrelation <span class="math inline">\(\phi_{kk} = 0\)</span>, that is, the PACF of <span class="math inline">\(\text{AR(p)}\)</span> models cuts off after lag <span class="math inline">\(p\)</span>, which is very helpful in identifying an <span class="math inline">\(\text{AR}\)</span> model. In fact, at this point, the predictor or regression of <span class="math inline">\(X_t\)</span> on <span class="math inline">\(\{X_{t‚àík+1:t‚àí1} \}\)</span> is</li>
</ol>
<p><span class="math display">\[\hat X_t =\varphi_1 X_{t‚àí1}+\cdots +\varphi_{k‚àí1} X_{t‚àík+1}\]</span></p>
<p>Thus, <span class="math inline">\(X_t ‚àí \hat X_t = \varepsilon_t\)</span>. Moreover, <span class="math inline">\(X_{t‚àík} ‚àí \hat X_{t‚àík}\)</span> is a function of <span class="math inline">\(\{ X_{t‚àík:t‚àí1} \}\)</span>, and <span class="math inline">\(\varepsilon_t\)</span> is uncorrelated to everyone in <span class="math inline">\(\{X_{t‚àík:t‚àí1} \}\)</span>. Therefore</p>
<p><span class="math display">\[Cov(X_{t‚àík} ‚àí\hat X_{t‚àík},X_t ‚àí\hat X_t)=Cov(X_{t‚àík} ‚àí\hat X_{t‚àík},\varepsilon_t)=0.\]</span></p>
<p>By Definition 2, <span class="math inline">\(\phi_{kk} = 0\)</span>.</p>
<ol start="4" type="1">
<li>We multiply Eq.(1)by <span class="math inline">\(X_{t‚àík}\)</span>,take expectations,divide by <span class="math inline">\(\gamma_0\)</span>,and then obtain the recursive relationship between the autocorrelations: <span class="math display">\[for \ k ‚â• 1, \rho_k = \varphi_1 \rho_{k‚àí1} + \varphi_2 \rho_{k‚àí2} + \cdots + \varphi_p \rho_{k‚àíp} \tag 2\]</span></li>
</ol>
<p>For Eq.(2), let <span class="math inline">\(k = 1,2,¬∑¬∑¬∑ ,p\)</span>. Then we arrive at a set of difference equations, which is known as the Yule-Walker equations. If the <span class="math inline">\(\text{ACF} \{\rho_{1:p} \}\)</span> are given, then we can solve the Yule-Walker equations to obtain the estimates for <span class="math inline">\(\{\varphi_{1:p} \}\)</span>, and the solutions are called the Yule-Walker estimates.</p>
<ol start="5" type="1">
<li>Since the model is a stationary <span class="math inline">\(\text{AR(p)}\)</span> now, naturally it satisfies <span class="math inline">\(X_t =\varphi_1 X_{t‚àí1}+ \varphi_2 X_{t‚àí2} + \cdots + \varphi_p X_{t‚àíp} + \varepsilon_t\)</span>. Hence <span class="math inline">\(\phi_{pp} = \varphi_p\)</span>. If the <span class="math inline">\(\text{AR(p)}\)</span> model is further Gaussian and a sample of size <span class="math inline">\(\text{T}\)</span> is given, then (a) <span class="math inline">\(\hat \phi_{pp} ‚Üí \varphi_p\)</span> as <span class="math inline">\(T ‚Üí ‚àû\)</span>; (b) according to Quenouille (1949), for <span class="math inline">\(k &gt; p, \sqrt{T} \hat \phi_{kk}\)</span> asymptotically follows the standard normal(Gaussian) distribution <span class="math inline">\(\text{N(0,1)}\)</span>, or <span class="math inline">\(\phi_{kk}\)</span> is asymptotically distributed as <span class="math inline">\(\text{N(0, 1/T )}\)</span>.</li>
</ol>
</section>
<section id="stationarity-and-causality-of-ar-models" class="level3">
<h3 class="anchored" data-anchor-id="stationarity-and-causality-of-ar-models">Stationarity and Causality of AR Models</h3>
<p>Consider the AR(1) model: <span class="math display">\[X_t = \varphi X_{t ‚àí 1} + \varepsilon_t , \varepsilon_t \sim W N( 0 , \sigma_{\varepsilon}^2 ) \tag 3\]</span></p>
<p>For <span class="math inline">\(|\varphi|&lt;1\)</span>,let <span class="math inline">\(X_{1t} =\sum_{j=0}^{\infty} \varphi^j \varepsilon_{t‚àíj}\)</span> and for <span class="math inline">\(|\varphi|&gt;1\)</span>,let <span class="math inline">\(X_{2t} =‚àí \sum_{j=1}^{\infty} \varphi^{-j} \varepsilon_{t+j}\)</span>. It is easy to show that both <span class="math inline">\(\{X_{1t } \}\)</span> and <span class="math inline">\(\{X_{2t } \}\)</span> are stationary and satisfy Eq. (3). That is, both are the stationary solution of Eq. (3). This gives rise to a question: which one of both is preferable? Obviously, <span class="math inline">\(\{X_{2t } \}\)</span> depends on future values of unobservable <span class="math inline">\(\{\varepsilon_t \}\)</span>, and so it is unnatural. Hence we take <span class="math inline">\(\{X_{1t } \}\)</span> and abandon <span class="math inline">\(\{X_{2t } \}\)</span>. In other words, we require that the coefficient <span class="math inline">\(\varphi\)</span> in Eq. (3) is less 1 in absolute value. At this point, the <span class="math inline">\(\text{AR}(1)\)</span> model is said to be causal and its causal expression is <span class="math inline">\(X_t = \sum_{j=0}^{\infty} \varphi^j \varepsilon_{t‚àíj}\)</span>. In general, the definition of causality is given below.</p>
<p><strong>Definition 3</strong> (1) A time series <span class="math inline">\(\{X_t \}\)</span> is causal if there exist coefficients <span class="math inline">\(\psi_j\)</span> such that</p>
<p><span class="math display">\[X_t =\sum_{j=0}^{\infty} \psi_j \varepsilon_{t-j}, \ \ \sum_{j=0}^{\infty} |\psi_j |&lt; \infty \]</span></p>
<p>where <span class="math inline">\(\psi_0 = 1, \{\varepsilon_t \} \sim WN(0, \sigma_{\varepsilon}^2 )\)</span>. At this point, we say that the time series <span class="math inline">\(\{X_t \}\)</span> has an <span class="math inline">\(\text{MA}(\infty)\)</span> representation.</p>
<ol start="2" type="1">
<li>We say that a model is causal if the time series generated by it is causal.</li>
</ol>
<p>Causality suggests that the time series <span class="math inline">\(\{X_t\}\)</span> is caused by the white noise (or innovations) from the past up to time t . Besides, the time series <span class="math inline">\(\{X_{2t } \}\)</span> is an example that is stationary but not causal. In order to determine whether an <span class="math inline">\(\text{AR}\)</span> model is causal, similar to the invertibility for the <span class="math inline">\(\text{MA}\)</span> model, we have the following theorem.</p>
<p><strong>Theorem 2(CausalityTheorem)</strong> An <span class="math inline">\(\text{AR}\)</span> model defined by Eq.(1) is causal if and only if the roots of its <span class="math inline">\(\text{AR}\)</span> polynomial <span class="math inline">\(\varphi(z)=1‚àí\varphi_1 z‚àí \cdots ‚àí \varphi_p z^p\)</span> exceed 1 in modulus or lie outside the unit circle on the complex plane.</p>
<p>Note the following remarks: * In the light of the existence and uniqueness on page 75 of Brockwell and Davis (2016), an <span class="math inline">\(\text{AR}\)</span> model defined by Eq.(1) is stationary if and only if its <span class="math inline">\(\text{AR}\)</span> polynomial <span class="math inline">\(\varphi(z)=1‚àí\varphi_1 z‚àí \cdots ‚àí \varphi_p z^p \neq 0\)</span> for all <span class="math inline">\(|z|=1\)</span> or all the roots of the <span class="math inline">\(\text{AR}\)</span> polynomial do not lie on the unit circle. Hence for the AR model defined by Eq. (1), its stationarity condition is weaker than its causality condition.</p>
<ul>
<li><p>A causal time series is surely a stationary one. So an <span class="math inline">\(\text{AR}\)</span> model that satisfies the causal condition is naturally stationary. But a stationary <span class="math inline">\(\text{AR}\)</span> model is not necessarily causal.</p></li>
<li><p>If the time series <span class="math inline">\(\{X_t \}\)</span> generated by Eq. (1) is not from the remote past, namely, <span class="math display">\[t \in T = {\cdots ,‚àín,\cdots ,‚àí1,0,1,\cdots ,n,\cdots}\]</span></p></li>
</ul>
<p>but starts from an initial value <span class="math inline">\(X_0\)</span>, then it may be nonstationary, not to mention causality.</p>
<ul>
<li>According to the relationship between the roots and the coefficients of the degree 2 polynomial <span class="math inline">\(\varphi(z) = 1 ‚àí \varphi_1 z ‚àí \varphi_2 z^2\)</span>, it may be proved that both of the roots of the polynomial exceed 1 in modulus if and only if</li>
</ul>
<p><span class="math display">\[\begin{equation}
    \left\{
        \begin{array}{ll}
         |\varphi_2| &lt; 1,      \\
         \varphi_2 + \varphi_1 &lt; 1, \\
         \varphi_2 - \varphi_1 &lt; 1,\\
        \end{array}
    \right.
\end{equation}\]</span></p>
<p>Thus, we can conveniently use the three inequations to decide whether a <span class="math inline">\(\text{AR(2)}\)</span> model is causal or not.</p>
<ul>
<li>It may be shown that for an <span class="math inline">\(\text{AR(p)}\)</span> model defined by Eq. (1), the coefficients <span class="math inline">\(\{\psi_j \}\)</span> in Definition 3 satisfy <span class="math inline">\(\psi_0=1\)</span> and</li>
</ul>
<p><span class="math display">\[\psi_j=\sum_{k=1}^{j} \varphi '_k \psi_{j-k}, \ \ j \geq 1 \ where \ \ \varphi '_k =\varphi_k  \ \ if \ \ k \leq p \ \ and \ \ \varphi '_k =0 \ \ if \ \ k&gt;p \]</span></p>
</section>
<section id="autocorrelation-the-past-influences-the-present" class="level3">
<h3 class="anchored" data-anchor-id="autocorrelation-the-past-influences-the-present">Autocorrelation: the past influences the present</h3>
<p>The autoregressive model describes a relationship between the present of a variable and its past. Therefore, it is suitable for variables in which the past and present values are correlated.</p>
<p>As an intuitive example, consider the waiting line at the doctor. Imagine that the doctor has a plan in which each patient has 20 minutes with him. If each patient takes exactly 20 minutes, this works well. But what if a patient takes a little longer? An autocorrelation could be present if the duration of one query has an impact on the duration of the next query. So if the doctor needs to speed up an appointment because the previous appointment took too long, look at a correlation between the past and the present. Past values influence future values.</p>
</section>
<section id="positive-and-negative-autocorrelation" class="level3">
<h3 class="anchored" data-anchor-id="positive-and-negative-autocorrelation">Positive and negative autocorrelation</h3>
<p>Like ‚Äúregular‚Äù correlation, autocorrelation can be positive or negative. Positive autocorrelation means that a high value now is likely to give a high value in the next period. This can be observed, for example, in stock trading: as soon as a lot of people want to buy a stock, its price goes up. This positive trend makes people want to buy this stock even more as it has positive returns. The more people buy the stock, the higher it goes and the more people will want to buy it.</p>
<p>A positive correlation also works in downtrends. If today‚Äôs stock value is low, tomorrow‚Äôs value is likely to be even lower as people start selling. When many people sell, the value falls, and even more people will want to sell. This is also a case of positive autocorrelation since the past and the present go in the same direction. If the past is low, the present is low; and if the past is high, the present is high.</p>
<p>There is negative autocorrelation if two trends are opposite. This is the case in the example of the duration of the doctor‚Äôs visit. If one query takes longer, the next one will be shorter. If one visit takes less time, the doctor may take a little longer for the next one.</p>
</section>
<section id="stationarity-and-the-adf-test" class="level3">
<h3 class="anchored" data-anchor-id="stationarity-and-the-adf-test">Stationarity and the ADF test</h3>
<p>The problem of having a trend in our data is general in univariate time series modeling. The stationarity of a time series means that a time series does not have a (long-term) trend: it is stable around the same average. Otherwise, a time series is said to be non-stationary.</p>
<p>In theory, AR models can have a trend coefficient in the model, but since stationarity is an important concept in general time series theory, it‚Äôs best to learn to deal with it right away. Many models can only work on stationary time series.</p>
<p>A time series that is growing or falling strongly over time is obvious to spot. But sometimes it‚Äôs hard to tell if a time series is stationary. This is where the Augmented Dickey Fuller (ADF) test comes in handy.</p>
</section>
</section>
<section id="loading-libraries-and-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-and-data">Loading libraries and data <a class="anchor" id="loading"></a></h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Statsforecast will be needed. To install, see <a href="../../docs/getting-started/installation.html">instructions</a>.</p>
</div>
</div>
<p>Next, we import plotting libraries and configure the plotting style.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.tsa.api <span class="im">as</span> smt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'lines.linewidth'</span>] <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dark_style <span class="op">=</span> {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.facecolor'</span>: <span class="st">'#212946'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.facecolor'</span>: <span class="st">'#212946'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'savefig.facecolor'</span>:<span class="st">'#212946'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.grid'</span>: <span class="va">True</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.grid.which'</span>: <span class="st">'both'</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.left'</span>: <span class="va">False</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.right'</span>: <span class="va">False</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.top'</span>: <span class="va">False</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.bottom'</span>: <span class="va">False</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.color'</span>: <span class="st">'#2A3459'</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.linewidth'</span>: <span class="st">'1'</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'text.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelcolor'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">12</span> }</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(dark_style)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pylab <span class="im">import</span> rcParams</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">18</span>,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/Naren8520/Serie-de-tiempo-con-Machine-Learning/main/Data/catfish.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1986-1-01</td>
<td>9034</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-2-01</td>
<td>9596</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1986-3-01</td>
<td>10558</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1986-4-01</td>
<td>9002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1986-5-01</td>
<td>9239</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The input to StatsForecast is always a data frame in long format with three columns: unique_id, ds and y:</p>
<ul>
<li><p>The <code>unique_id</code> (string, int or category) represents an identifier for the series.</p></li>
<li><p>The <code>ds</code> (datestamp) column should be of a format expected by Pandas, ideally YYYY-MM-DD for a date or YYYY-MM-DD HH:MM:SS for a timestamp.</p></li>
<li><p>The <code>y</code> (numeric) represents the measurement we wish to forecast.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"unique_id"</span>]<span class="op">=</span><span class="st">"1"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.columns<span class="op">=</span>[<span class="st">"ds"</span>, <span class="st">"y"</span>, <span class="st">"unique_id"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1986-1-01</td>
<td>9034</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-2-01</td>
<td>9596</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1986-3-01</td>
<td>10558</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1986-4-01</td>
<td>9002</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1986-5-01</td>
<td>9239</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ds           object
y             int64
unique_id    object
dtype: object</code></pre>
</div>
</div>
<p>We can see that our time variable <code>ds</code> is in an object format, we need to convert to a date format</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ds"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"ds"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="explore-data-with-the-plot-method" class="level2">
<h2 class="anchored" data-anchor-id="explore-data-with-the-plot-method">Explore data with the plot method <a class="anchor" id="plotting"></a></h2>
<p>Plot some series using the plot method from the StatsForecast class. This method prints 8 random series from the dataset and is useful for basic EDA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>StatsForecast.plot(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoRegressive_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="the-augmented-dickey-fuller-test" class="level3">
<h3 class="anchored" data-anchor-id="the-augmented-dickey-fuller-test">The Augmented Dickey-Fuller Test</h3>
<p>An Augmented Dickey-Fuller (ADF) test is a type of statistical test that determines whether a unit root is present in time series data. Unit roots can cause unpredictable results in time series analysis. A null hypothesis is formed in the unit root test to determine how strongly time series data is affected by a trend. By accepting the null hypothesis, we accept the evidence that the time series data is not stationary. By rejecting the null hypothesis or accepting the alternative hypothesis, we accept the evidence that the time series data is generated by a stationary process. This process is also known as stationary trend. The values of the ADF test statistic are negative. Lower ADF values indicate a stronger rejection of the null hypothesis.</p>
<p>Augmented Dickey-Fuller Test is a common statistical test used to test whether a given time series is stationary or not. We can achieve this by defining the null and alternate hypothesis.</p>
<p>Null Hypothesis: Time Series is non-stationary. It gives a time-dependent trend. Alternate Hypothesis: Time Series is stationary. In another term, the series doesn‚Äôt depend on time.</p>
<p>ADF or t Statistic &lt; critical values: Reject the null hypothesis, time series is stationary. ADF or t Statistic &gt; critical values: Failed to reject the null hypothesis, time series is non-stationary.</p>
<p>Let‚Äôs check if our series that we are analyzing is a stationary series. Let‚Äôs create a function to check, using the <code>Dickey Fuller</code> test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Augmented_Dickey_Fuller_Test_func(series , column_name):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (<span class="ss">f'Dickey-Fuller test results for columns: </span><span class="sc">{</span>column_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    dftest <span class="op">=</span> adfuller(series, autolag<span class="op">=</span><span class="st">'AIC'</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    dfoutput <span class="op">=</span> pd.Series(dftest[<span class="dv">0</span>:<span class="dv">4</span>], index<span class="op">=</span>[<span class="st">'Test Statistic'</span>,<span class="st">'p-value'</span>,<span class="st">'No Lags Used'</span>,<span class="st">'Number of observations used'</span>])</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key,value <span class="kw">in</span> dftest[<span class="dv">4</span>].items():</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>       dfoutput[<span class="st">'Critical Value (</span><span class="sc">%s</span><span class="st">)'</span><span class="op">%</span>key] <span class="op">=</span> value</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span> (dfoutput)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> dftest[<span class="dv">1</span>] <span class="op">&lt;=</span> <span class="fl">0.05</span>:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Conclusion:====&gt;"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Reject the null hypothesis"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"The data is stationary"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Conclusion:====&gt;"</span>)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"The null hypothesis cannot be rejected"</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"The data is not stationary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>Augmented_Dickey_Fuller_Test_func(df[<span class="st">"y"</span>],<span class="st">'Sales'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dickey-Fuller test results for columns: Sales
Test Statistic          -1.589903
p-value                  0.488664
No Lags Used            14.000000
                          ...    
Critical Value (1%)     -3.451691
Critical Value (5%)     -2.870939
Critical Value (10%)    -2.571778
Length: 7, dtype: float64
Conclusion:====&gt;
The null hypothesis cannot be rejected
The data is not stationary</code></pre>
</div>
</div>
<p>In the previous result we can see that the <code>Augmented_Dickey_Fuller</code> test gives us a <code>p-value</code> of 0.488664, which tells us that the null hypothesis cannot be rejected, and on the other hand the data of our series are not stationary.</p>
<p>We need to differentiate our time series, in order to convert the data to stationary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>Augmented_Dickey_Fuller_Test_func(df[<span class="st">"y"</span>].diff().dropna(),<span class="st">"Sales"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dickey-Fuller test results for columns: Sales
Test Statistic          -4.310935
p-value                  0.000425
No Lags Used            17.000000
                          ...    
Critical Value (1%)     -3.451974
Critical Value (5%)     -2.871063
Critical Value (10%)    -2.571844
Length: 7, dtype: float64
Conclusion:====&gt;
Reject the null hypothesis
The data is stationary</code></pre>
</div>
</div>
<p>By applying a differential, our time series now is stationary.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> tsplot(y, lags<span class="op">=</span><span class="va">None</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">7</span>), style<span class="op">=</span><span class="st">'bmh'</span>): <span class="co"># [3]</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> <span class="bu">isinstance</span>(y, pd.Series):</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> pd.Series(y)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> plt.style.context(style):    </span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>        fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>figsize)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>        layout <span class="op">=</span> (<span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        ts_ax <span class="op">=</span> plt.subplot2grid(layout, (<span class="dv">0</span>, <span class="dv">0</span>), colspan<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        acf_ax <span class="op">=</span> plt.subplot2grid(layout, (<span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        pacf_ax <span class="op">=</span> plt.subplot2grid(layout, (<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        y.plot(ax<span class="op">=</span>ts_ax)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>        p_value <span class="op">=</span> sm.tsa.stattools.adfuller(y)[<span class="dv">1</span>]</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>        ts_ax.set_title(<span class="st">'Time Series Analysis plot</span><span class="ch">\n</span><span class="st"> Dickey-Fuller: p=</span><span class="sc">{0:.5f}</span><span class="st">'</span>.<span class="bu">format</span>(p_value))</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>        smt.graphics.plot_acf(y, lags<span class="op">=</span>lags, ax<span class="op">=</span>acf_ax)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>        smt.graphics.plot_pacf(y, lags<span class="op">=</span>lags, ax<span class="op">=</span>pacf_ax)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tsplot(df[<span class="st">"y"</span>].diff().dropna(), lags<span class="op">=</span><span class="dv">20</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoRegressive_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>As you can see, based on the blue background shaded area of the graph, the PACF shows the first, second, third, fourth, sixth, seventh, ninth, and tenth etc. delay outside the shaded area. This means that it would be interesting to also include these lags in the AR model.</p>
</section>
<section id="how-many-lags-should-we-include" class="level3">
<h3 class="anchored" data-anchor-id="how-many-lags-should-we-include">How many lags should we include?</h3>
<p>Now, the <strong>big question in time series analysis is always how many lags to include</strong>. This is called the order of the time series. The notation is AR(1) for order 1 and AR(p) for order p.</p>
<p>The order is up to you. Theoretically speaking, you can base your order on the PACF chart. Theory tells you to take the number of lags before you get an autocorrelation of 0. All other lags should be 0.</p>
<p>In theory, you often see great charts where the first peak is very high and the rest equal zero. In those cases, the choice is easy: you are working with a very ‚Äúpure‚Äù example of AR(1). Another common case is when your autocorrelation starts high and slowly decreases to zero. In this case, you should use all delays where the PACF is not yet zero.</p>
<p>However, in practice, it is not always that simple. Remember the famous saying <em>‚Äúall models are wrong, but some are useful‚Äù</em>. It is very rare to find cases that fit an AR model perfectly. In general, the autoregression process can help explain part of the variation of a variable, but not all.</p>
<p>In practice, you will try to select the number of lags that gives your model the best predictive performance. The best predictive performance is often not defined by looking at autocorrelation plots: those plots give you a theoretical estimate. However, predictive performance is best defined by model evaluation and benchmarking, using the techniques you have seen in Module 2. Later in this module, we will see how to use model evaluation to choose a performance order for the AR model. But before we get into that, it‚Äôs time to dig into the exact definition of the AR model.</p>
</section>
</section>
<section id="split-the-data-into-training-and-testing" class="level2">
<h2 class="anchored" data-anchor-id="split-the-data-into-training-and-testing">Split the data into training and testing<a class="anchor" id="splitting"></a></h2>
<p>Let‚Äôs divide our data into sets 1. Data to train our <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#autoregressive"><code>AutoRegressive</code></a> model 2. Data to test our model</p>
<p>For the test data we will use the last 12 months to test and evaluate the performance of our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> df[df.ds<span class="op">&lt;=</span><span class="st">'2011-12-01'</span>] </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> df[df.ds<span class="op">&gt;</span><span class="st">'2011-12-01'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train.shape, test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((312, 3), (12, 3))</code></pre>
</div>
</div>
<p>Now let‚Äôs plot the training data and the test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(train,x<span class="op">=</span><span class="st">"ds"</span>, y<span class="op">=</span><span class="st">"y"</span>, label<span class="op">=</span><span class="st">"Train"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(test, x<span class="op">=</span><span class="st">"ds"</span>, y<span class="op">=</span><span class="st">"y"</span>, label<span class="op">=</span><span class="st">"Test"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoRegressive_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="implementation-of-autoregressive-with-statsforecast" class="level1">
<h1>Implementation of AutoRegressive with StatsForecast <a class="anchor" id="implementation"></a></h1>
<p>To also know more about the parameters of the functions of the <code>AutoRegressive Model</code>, they are listed below. For more information, visit the <a href="https://nixtla.github.io/statsforecast/src/core/models.html#autoregressive">documentation</a></p>
<pre><code>lags : int or list
    Number of lags to include in the model.
    If an int is passed then all lags up to `lags` are considered.
    If a list, only the elements of the list are considered as lags.
include_mean : bool (default=True)
    Should the AutoRegressive model include a mean term?
    The default is True for undifferenced series, False for differenced ones (where a mean would not affect the fit nor predictions).
include_drift : bool (default=False)
    Should the AutoRegressive model include a linear drift term?
    (i.e., a linear regression with AutoRegressive errors is fitted.)
blambda : float, optional (default=None)
    Box-Cox transformation parameter.
biasadj : bool (default=False)
    Use adjusted back-transformed mean Box-Cox.
method : str (default='CSS-ML')
    Fitting method: maximum likelihood or minimize conditional sum-of-squares.
    The default (unless there are missing values) is to use conditional-sum-of-squares to find starting values, then maximum likelihood.
fixed : dict, optional (default=None)
    Dictionary containing fixed coefficients for the AutoRegressive model. Example: `{'ar1': 0.5, 'ar5': 0.75}`.
    For autoregressive terms use the `ar{i}` keys.
alias : str
    Custom name of the model.
prediction_intervals : Optional[ConformalIntervals]
    Information to compute conformal prediction intervals.
    By default, the model will compute the native prediction
    intervals.</code></pre>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">Load libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> AutoRegressive</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="instantiating-model" class="level3">
<h3 class="anchored" data-anchor-id="instantiating-model">Instantiating Model</h3>
<p>Import and instantiate the models. Setting the argument is sometimes tricky. This article on <a href="https://robjhyndman.com/hyndsight/seasonal-periods/">Seasonal periods</a> by the master, Rob Hyndmann, can be useful.season_length.</p>
<p><strong>Method 1:</strong> We use the lags parameter in an integer format, that is, we put the lags we want to evaluate in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>season_length <span class="op">=</span> <span class="dv">12</span> <span class="co"># Monthly data </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="op">=</span> <span class="bu">len</span>(test) <span class="co"># number of predictions biasadj=True, include_drift=True,</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>models2 <span class="op">=</span> [AutoRegressive(lags<span class="op">=</span>[<span class="dv">14</span>], include_mean<span class="op">=</span><span class="va">True</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Method 2:</strong> We use the lags parameter in a list format, that is, we put the lags that we want to evaluate in the model in the form of a list as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>season_length <span class="op">=</span> <span class="dv">12</span> <span class="co"># Monthly data </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="op">=</span> <span class="bu">len</span>(test) <span class="co"># number of predictions</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [AutoRegressive(lags<span class="op">=</span>[<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">14</span>], include_mean<span class="op">=</span><span class="va">True</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit the models by instantiating a new StatsForecast object with the following parameters:</p>
<p>models: a list of models. Select the models you want from models and import them.</p>
<ul>
<li><p><code>freq:</code> a string indicating the frequency of the data. (See <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">pandas‚Äôs available frequencies</a>.)</p></li>
<li><p><code>n_jobs:</code> n_jobs: int, number of jobs used in the parallel processing, use -1 for all cores.</p></li>
<li><p><code>fallback_model:</code> a model to be used if a model fails.</p></li>
</ul>
<p>Any settings are passed into the constructor. Then you call its fit method and pass in the historical data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>sf <span class="op">=</span> StatsForecast(df<span class="op">=</span>train,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                   models<span class="op">=</span>models,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>                   freq<span class="op">=</span><span class="st">'MS'</span>, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                   n_jobs<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-model">Fit Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>sf.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>StatsForecast(models=[AutoRegressive])</code></pre>
</div>
</div>
<p>Let‚Äôs see the results of our Theta model. We can observe it with the following instruction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>sf.fitted_[<span class="dv">0</span>,<span class="dv">0</span>].model_</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(result.keys())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dict_keys(['coef', 'sigma2', 'var_coef', 'mask', 'loglik', 'aic', 'arma', 'residuals', 'code', 'n_cond', 'nobs', 'model', 'aicc', 'bic', 'xreg', 'lambda', 'x'])</code></pre>
</div>
</div>
<p>Let us now visualize the residuals of our models.</p>
<p>As we can see, the result obtained above has an output in a dictionary, to extract each element from the dictionary we are going to use the <code>.get()</code> function to extract the element and then we are going to save it in a <code>pd.DataFrame()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>residual<span class="op">=</span>pd.DataFrame(result.get(<span class="st">"residuals"</span>), columns<span class="op">=</span>[<span class="st">"residual Model"</span>])</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">residual Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>-11990.435671</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">309</td>
<td>-2717.643794</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">310</td>
<td>-1306.165240</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">311</td>
<td>-2712.663024</td>
</tr>
</tbody>
</table>

<p>312 rows √ó 1 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot[1,1]</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>residual.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"Residuals"</span>)<span class="op">;</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>sns.distplot(residual, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">"Density plot - Residual"</span>)<span class="op">;</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>stats.probplot(residual[<span class="st">"residual Model"</span>], dist<span class="op">=</span><span class="st">"norm"</span>, plot<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Plot Q-Q'</span>)</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>plot_acf(residual,  lags<span class="op">=</span><span class="dv">35</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>],color<span class="op">=</span><span class="st">"fuchsia"</span>)</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">"Autocorrelation"</span>)<span class="op">;</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoRegressive_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="forecast-method" class="level3">
<h3 class="anchored" data-anchor-id="forecast-method">Forecast Method</h3>
<p>If you want to gain speed in productive settings where you have multiple series or models we recommend using the <a href="https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast"><code>StatsForecast.forecast</code></a> method instead of <code>.fit</code> and <code>.predict</code>.</p>
<p>The main difference is that the <code>.forecast</code> doest not store the fitted values and is highly scalable in distributed environments.</p>
<p>The forecast method takes two arguments: forecasts next <code>h</code> (horizon) and <code>level</code>.</p>
<ul>
<li><p><code>h (int):</code> represents the forecast h steps into the future. In this case, 12 months ahead.</p></li>
<li><p><code>level (list of floats):</code> this optional parameter is used for probabilistic forecasting. Set the level (or confidence percentile) of your prediction interval. For example, <code>level=[90]</code> means that the model expects the real value to be inside that interval 90% of the times.</p></li>
</ul>
<p>The forecast object here is a new data frame that includes a column with the name of the model and the y hat values, as well as columns for the uncertainty intervals. Depending on your computer, this step should take around 1min. (If you want to speed things up to a couple of seconds, remove the AutoModels like <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#arima"><code>ARIMA</code></a> and <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#theta"><code>Theta</code></a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>Y_hat <span class="op">=</span> sf.forecast(horizon, fitted<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-01-01</td>
<td>15904.990234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-02-01</td>
<td>13597.334961</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-03-01</td>
<td>15488.281250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-10-01</td>
<td>14086.938477</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-11-01</td>
<td>13273.106445</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-12-01</td>
<td>12497.278320</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 2 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>values<span class="op">=</span>sf.forecast_fitted_values()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>values.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-01-01</td>
<td>9034.0</td>
<td>21024.435547</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-02-01</td>
<td>9596.0</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-03-01</td>
<td>10558.0</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-04-01</td>
<td>9002.0</td>
<td>129223.968750</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1986-05-01</td>
<td>9239.0</td>
<td>10019.207031</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Adding 95% confidence interval with the forecast method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sf.forecast(h<span class="op">=</span>horizon, level<span class="op">=</span>[<span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
<th data-quarto-table-cell-role="th">AutoRegressive-lo-95</th>
<th data-quarto-table-cell-role="th">AutoRegressive-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-01-01</td>
<td>15904.990234</td>
<td>1759.574219</td>
<td>30050.406250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-02-01</td>
<td>13597.334961</td>
<td>-548.080872</td>
<td>27742.751953</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-03-01</td>
<td>15488.281250</td>
<td>1342.864990</td>
<td>29633.697266</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-10-01</td>
<td>14086.938477</td>
<td>-1445.719727</td>
<td>29619.597656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-11-01</td>
<td>13273.106445</td>
<td>-2283.256104</td>
<td>28829.470703</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-12-01</td>
<td>12497.278320</td>
<td>-3072.115234</td>
<td>28066.671875</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 4 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Y_hat<span class="op">=</span>Y_hat.reset_index()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2012-01-01</td>
<td>15904.990234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2012-02-01</td>
<td>13597.334961</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2012-03-01</td>
<td>15488.281250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>2012-10-01</td>
<td>14086.938477</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>1</td>
<td>2012-11-01</td>
<td>13273.106445</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>1</td>
<td>2012-12-01</td>
<td>12497.278320</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 3 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the forecasts with the true values</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>test[<span class="st">'unique_id'</span>] <span class="op">=</span> test[<span class="st">'unique_id'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Y_hat1 <span class="op">=</span> test.merge(Y_hat, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>Y_hat1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2012-01-01</td>
<td>13427</td>
<td>1</td>
<td>15904.990234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-02-01</td>
<td>14447</td>
<td>1</td>
<td>13597.334961</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2012-03-01</td>
<td>14717</td>
<td>1</td>
<td>15488.281250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>2012-10-01</td>
<td>13795</td>
<td>1</td>
<td>14086.938477</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>2012-11-01</td>
<td>13352</td>
<td>1</td>
<td>13273.106445</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>2012-12-01</td>
<td>12716</td>
<td>1</td>
<td>12497.278320</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 4 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the forecasts with the true values</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>plot_df <span class="op">=</span> pd.concat([train, Y_hat1]).set_index(<span class="st">'ds'</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>plot_df[[<span class="st">'y'</span>, <span class="st">"AutoRegressive"</span>]].plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">' Forecast'</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Year '</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Timestamp [t]'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>ax.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoRegressive_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="predict-method-with-confidence-interval" class="level3">
<h3 class="anchored" data-anchor-id="predict-method-with-confidence-interval">Predict method with confidence interval</h3>
<p>To generate forecasts use the predict method.</p>
<p>The predict method takes two arguments: forecasts the next <code>h</code> (for horizon) and <code>level</code>.</p>
<ul>
<li><p><code>h (int):</code> represents the forecast h steps into the future. In this case, 12 months ahead.</p></li>
<li><p><code>level (list of floats):</code> this optional parameter is used for probabilistic forecasting. Set the level (or confidence percentile) of your prediction interval. For example, <code>level=[95]</code> means that the model expects the real value to be inside that interval 95% of the times.</p></li>
</ul>
<p>The forecast object here is a new data frame that includes a column with the name of the model and the y hat values, as well as columns for the uncertainty intervals.</p>
<p>This step should take less than 1 second.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>sf.predict(h<span class="op">=</span>horizon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-01-01</td>
<td>15904.990234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-02-01</td>
<td>13597.334961</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-03-01</td>
<td>15488.281250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-10-01</td>
<td>14086.938477</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-11-01</td>
<td>13273.106445</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-12-01</td>
<td>12497.278320</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 2 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> sf.predict(h<span class="op">=</span>horizon, level<span class="op">=</span>[<span class="dv">95</span>]) </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>forecast_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
<th data-quarto-table-cell-role="th">AutoRegressive-lo-95</th>
<th data-quarto-table-cell-role="th">AutoRegressive-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-01-01</td>
<td>15904.990234</td>
<td>1759.574219</td>
<td>30050.406250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-02-01</td>
<td>13597.334961</td>
<td>-548.080872</td>
<td>27742.751953</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-03-01</td>
<td>15488.281250</td>
<td>1342.864990</td>
<td>29633.697266</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-10-01</td>
<td>14086.938477</td>
<td>-1445.719727</td>
<td>29619.597656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-11-01</td>
<td>13273.106445</td>
<td>-2283.256104</td>
<td>28829.470703</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2012-12-01</td>
<td>12497.278320</td>
<td>-3072.115234</td>
<td>28066.671875</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 4 columns</p>
</div>
</div>
</div>
<p>We can join the forecast result with the historical data using the pandas function <code>pd.concat()</code>, and then be able to use this result for graphing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df, forecast_df]).set_index(<span class="st">'ds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
<th data-quarto-table-cell-role="th">AutoRegressive-lo-95</th>
<th data-quarto-table-cell-role="th">AutoRegressive-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1986-01-01</td>
<td>9034.0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1986-02-01</td>
<td>9596.0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1986-03-01</td>
<td>10558.0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012-10-01</td>
<td>NaN</td>
<td>NaN</td>
<td>14086.938477</td>
<td>-1445.719727</td>
<td>29619.597656</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2012-11-01</td>
<td>NaN</td>
<td>NaN</td>
<td>13273.106445</td>
<td>-2283.256104</td>
<td>28829.470703</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2012-12-01</td>
<td>NaN</td>
<td>NaN</td>
<td>12497.278320</td>
<td>-3072.115234</td>
<td>28066.671875</td>
</tr>
</tbody>
</table>

<p>336 rows √ó 5 columns</p>
</div>
</div>
</div>
<p>Now let‚Äôs visualize the result of our forecast and the historical data of our time series, also let‚Äôs draw the confidence interval that we have obtained when making the prediction with 95% confidence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_forecasts(y_hist, y_true, y_pred, models):</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    _, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">7</span>))</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_true.merge(y_pred, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> pd.concat([y_hist, y_true]).set_index(<span class="st">'ds'</span>).tail(<span class="dv">12</span><span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    df_plot[[<span class="st">'y'</span>] <span class="op">+</span> models].plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'orange'</span>, <span class="st">'black'</span>, <span class="st">'green'</span>]</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model, color <span class="kw">in</span> <span class="bu">zip</span>(models, colors):</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>        ax.fill_between(df_plot.index, </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                        df_plot[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-lo-95'</span>], </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>                        df_plot[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-hi-95'</span>],</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">.35</span>,</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span>color,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-level-90'</span>)</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">''</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">''</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Timestamp [t]'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>    ax.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plot_forecasts(train, test, forecast_df, models<span class="op">=</span>[<span class="st">"AutoRegressive"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoRegressive_files/figure-html/cell-36-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Let‚Äôs plot the same graph using the plot function that comes in <code>Statsforecast</code>, as shown below.</p>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-validation <a class="anchor" id="cross_validate"></a></h2>
<p>In previous steps, we‚Äôve taken our historical data to predict the future. However, to asses its accuracy we would also like to know how the model would have performed in the past. To assess the accuracy and robustness of your models on your data perform Cross-Validation.</p>
<p>With time series data, Cross Validation is done by defining a sliding window across the historical data and predicting the period following it. This form of cross-validation allows us to arrive at a better estimation of our model‚Äôs predictive abilities across a wider range of temporal instances while also keeping the data in the training set contiguous as is required by our models.</p>
<p>The following graph depicts such a Cross Validation Strategy:</p>
<p><img src="https://raw.githubusercontent.com/Nixtla/statsforecast/main/nbs/imgs/ChainedWindows.gif" class="img-fluid"></p>
<section id="perform-time-series-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="perform-time-series-cross-validation">Perform time series cross-validation</h3>
<p>Cross-validation of time series models is considered a best practice but most implementations are very slow. The statsforecast library implements cross-validation as a distributed operation, making the process less time-consuming to perform. If you have big datasets you can also perform Cross Validation in a distributed cluster using Ray, Dask or Spark.</p>
<p>In this case, we want to evaluate the performance of each model for the last 5 months <code>(n_windows=5)</code>, forecasting every second months <code>(step_size=12)</code>. Depending on your computer, this step should take around 1 min.</p>
<p>The cross_validation method from the StatsForecast class takes the following arguments.</p>
<ul>
<li><p><code>df:</code> training data frame</p></li>
<li><p><code>h (int):</code> represents h steps into the future that are being forecasted. In this case, 12 months ahead.</p></li>
<li><p><code>step_size (int):</code> step size between each window. In other words: how often do you want to run the forecasting processes.</p></li>
<li><p><code>n_windows(int):</code> number of windows used for cross validation. In other words: what number of forecasting processes in the past do you want to evaluate.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df <span class="op">=</span> sf.cross_validation(df<span class="op">=</span>train,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>                                         h<span class="op">=</span>horizon,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                                         step_size<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                                         n_windows<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The crossvaldation_df object is a new data frame that includes the following columns:</p>
<ul>
<li><code>unique_id:</code> index. If you dont like working with index just run crossvalidation_df.resetindex()</li>
<li><code>ds:</code> datestamp or temporal index</li>
<li><code>cutoff:</code> the last datestamp or temporal index for the n_windows.</li>
<li><code>y:</code> true value</li>
<li><code>"model":</code> columns with the model‚Äôs name and fitted value.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">cutoff</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">AutoRegressive</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2009-01-01</td>
<td>2008-12-01</td>
<td>19262.0</td>
<td>24295.751953</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2009-02-01</td>
<td>2008-12-01</td>
<td>20658.0</td>
<td>23993.804688</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2009-03-01</td>
<td>2008-12-01</td>
<td>22660.0</td>
<td>21200.978516</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2011-10-01</td>
<td>2010-12-01</td>
<td>12893.0</td>
<td>19350.546875</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2011-11-01</td>
<td>2010-12-01</td>
<td>11843.0</td>
<td>16900.646484</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2011-12-01</td>
<td>2010-12-01</td>
<td>11321.0</td>
<td>18160.392578</td>
</tr>
</tbody>
</table>

<p>60 rows √ó 4 columns</p>
</div>
</div>
</div>
<p>We‚Äôll now plot the forecast for each cutoff period. To make the plots clearer, we‚Äôll rename the actual values in each period.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df.rename(columns <span class="op">=</span> {<span class="st">'y'</span> : <span class="st">'actual'</span>}, inplace <span class="op">=</span> <span class="va">True</span>) <span class="co"># rename actual values </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>cutoff <span class="op">=</span> crossvalidation_df[<span class="st">'cutoff'</span>].unique()</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cutoff)): </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> crossvalidation_df[crossvalidation_df[<span class="st">'cutoff'</span>] <span class="op">==</span> cutoff[k]]</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    StatsForecast.plot(df, cv.loc[:, cv.columns <span class="op">!=</span> <span class="st">'cutoff'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation <a class="anchor" id="evaluate"></a></h2>
<p>We can now compute the accuracy of the forecast using an appropiate accuracy metric. Here we‚Äôll use the Root Mean Squared Error (RMSE). To do this, we first need to <code>install datasetsforecast</code>, a Python library developed <strong>by Nixtla</strong> that includes a function to compute the RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasetsforecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.losses <span class="im">import</span> rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function to compute the RMSE takes two arguments:</p>
<ol type="1">
<li>The actual values.</li>
<li>The forecasts, in this case, <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#autoregressive"><code>AutoRegressive</code></a>.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> rmse(crossvalidation_df[<span class="st">'actual'</span>], crossvalidation_df[<span class="st">"AutoRegressive"</span>])</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RMSE using cross-validation: "</span>, rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE using cross-validation:  3566.5479</code></pre>
</div>
</div>
<p>As you have noticed, we have used the cross validation results to perform the evaluation of our model.</p>
<p>Now we are going to evaluate our model with the results of the predictions, we will use different types of metrics MAE, MAPE, MASE, RMSE, SMAPE to evaluate the accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.losses <span class="im">import</span> (mae, mape, mase, rmse, smape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_performace(y_hist, y_true, y_pred, model):</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_true.merge(y_pred, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    evaluation <span class="op">=</span> {}</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    evaluation[model] <span class="op">=</span> {}</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> metric <span class="kw">in</span> [mase, mae, mape, rmse, smape]:</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>        metric_name <span class="op">=</span> metric.<span class="va">__name__</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> metric_name <span class="op">==</span> <span class="st">'mase'</span>:</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>            evaluation[model][metric_name] <span class="op">=</span> metric(y_true[<span class="st">'y'</span>].values, </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                                                y_true[model].values, </span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>                                                y_hist[<span class="st">'y'</span>].values, seasonality<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>            evaluation[model][metric_name] <span class="op">=</span> metric(y_true[<span class="st">'y'</span>].values, y_true[model].values)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(evaluation).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>evaluate_performace(train, test, Y_hat, model<span class="op">=</span><span class="st">"AutoRegressive"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mae</th>
<th data-quarto-table-cell-role="th">mape</th>
<th data-quarto-table-cell-role="th">mase</th>
<th data-quarto-table-cell-role="th">rmse</th>
<th data-quarto-table-cell-role="th">smape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AutoRegressive</td>
<td>961.773193</td>
<td>7.271437</td>
<td>0.601651</td>
<td>1194.660588</td>
<td>6.970027</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>We would like to thank <a href="https://www.linkedin.com/in/naren-castellon-1541b8101/?originalSubdomain=pa">Naren Castellon</a> for writing this tutorial.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References <a class="anchor" id="references"></a></h2>
<ol type="1">
<li>Changquan Huang ‚Ä¢ Alla Petukhina. Springer series (2022). Applied Time Series Analysis and Forecasting with Python.</li>
<li><a href="https://www.sciencedirect.com/science/article/pii/S0169207016300243">Jose A. Fiorucci, Tiago R. Pellegrini, Francisco Louzada, Fotios Petropoulos, Anne B. Koehler (2016). ‚ÄúModels for optimising the theta method and their relationship to state space models‚Äù. International Journal of Forecasting</a>.</li>
<li><a href="https://nixtla.github.io/statsforecast/src/core/models.html#autoregressive">Nixtla Parameters</a>.</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">Pandas available frequencies</a>.</li>
<li><a href="https://otexts.com/fpp3/tscv.html">Rob J. Hyndman and George Athanasopoulos (2018). ‚ÄúForecasting principles and practice, Time series cross-validation‚Äù.</a>.</li>
<li><a href="https://robjhyndman.com/hyndsight/seasonal-periods/">Seasonal periods- Rob J Hyndman</a>.</li>
</ol>


</section>
</section>

<p>Give us a ‚≠ê&nbsp;on <a href="https://github.com/nixtla/statsforecast">Github</a></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>