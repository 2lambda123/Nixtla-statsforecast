<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Step-by-step guide on using the AutoTheta Model with Statsforecast.">

<title>statsforecast - AutoTheta Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon_png.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NXJNCVR18L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NXJNCVR18L', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="statsforecast - AutoTheta Model">
<meta property="og:description" content="Step-by-step guide on using the AutoTheta Model with Statsforecast.">
<meta property="og:image" content="https://github.com/Nixtla/styles/blob/2abf51612584169874c90cd7c4d347e3917eaf73/images/Banner%20Github.png">
<meta property="og:site-name" content="statsforecast">
<meta name="twitter:title" content="statsforecast - AutoTheta Model">
<meta name="twitter:description" content="Step-by-step guide on using the AutoTheta Model with Statsforecast.">
<meta name="twitter:image" content="https://farm6.staticflickr.com/5510/14338202952_93595258ff_z.jpg">
<meta name="twitter:site" content="@Nixtlainc">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">statsforecast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../docs/getting-started/getting_started_short.html" rel="" target="" aria-current="page">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nixtlaverse" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NixtlaVerse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nixtlaverse">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast" rel="" target="">
 <span class="dropdown-text">StatsForecast ‚ö°Ô∏è</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/mlforecast" rel="" target="">
 <span class="dropdown-text">MLForecast ü§ñ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/neuralforecast" rel="" target="">
 <span class="dropdown-text">NeuralForecast üß†</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/hierarchicalforecast" rel="" target="">
 <span class="dropdown-text">HierarchicalForecast üëë</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast/issues/new/choose" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://join.slack.com/t/nixtlaworkspace/shared_invite/zt-135dssye9-fWTzMpv2WBthq8NK0Yvu6A" rel="" target=""><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Join our Slack</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nixtla/statsforecast" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nixtlainc" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Nixtla Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/models/adida.html">Model References</a></li><li class="breadcrumb-item"><a href="../../docs/models/autotheta.html">AutoTheta Model</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ‚ö°Ô∏è</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_complete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/anomalydetection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anomaly Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/conformalprediction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conformal Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/crossvalidation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricityloadforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Electricity Load Forecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricitypeakforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detect Demand Peaks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/garch_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Volatility forecasting (GARCH &amp; ARCH)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/intermittentdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent or Sparse Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/multipleseasonalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple seasonalities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/statisticalneuralmethods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical, Machine Learning and Neural Forecasting methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/uncertaintyintervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">How-To Guides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/automatic_forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Time Series Forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/amazonstatsforecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Amazon Forecast vs StatsForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/autoarima_vs_prophet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Comparison (Prophet and pmdarima)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ets_ray_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting at Scale using ETS and ray (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/exogenous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exogenous Regressors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/getting_started_complete_polars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough with Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/migrating_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Migrating from R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/mlflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLFlow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/numba_cache.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numba caching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/prophet_spark_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ETS and Facebook Prophet on Spark (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ray</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">Model References</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/adida.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADIDA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoarima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoCES Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoETS Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoregressive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoRegressive Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autotheta.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">AutoTheta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonclassic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonClassic Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonOptimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonsba.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonSBA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicoptimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicstandardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/garch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holtwinters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Winters Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/imapa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IMAPA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/multipleseasonaltrend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Seasonal Trend (MSTL)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/optimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothingoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/standardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/tsb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TSB Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">API Reference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/distributed.fugue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FugueBackend</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast‚Äôs Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/contribute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contribute to Nixtla</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/docs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nixtla Documentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issue-labels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding Issue Labels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submit an Issue üì¢</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/step-by-step.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step-by-step Contribution Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/techstack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing Code to Nixtla Development</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#table-of-contents" id="toc-table-of-contents" class="nav-link active" data-scroll-target="#table-of-contents">Table of Contents</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a><a class="anchor nav-link" id="introduction" data-scroll-target="undefined"></a></li>
  <li><a href="#theta-method" id="toc-theta-method" class="nav-link" data-scroll-target="#theta-method">Theta method </a><a class="anchor nav-link" id="model" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#the-original-theta-method" id="toc-the-original-theta-method" class="nav-link" data-scroll-target="#the-original-theta-method">The original Theta method</a></li>
  <li><a href="#models-for-optimising-the-theta-method" id="toc-models-for-optimising-the-theta-method" class="nav-link" data-scroll-target="#models-for-optimising-the-theta-method">Models for optimising the Theta method</a></li>
  <li><a href="#optimised-and-standard-theta-models" id="toc-optimised-and-standard-theta-models" class="nav-link" data-scroll-target="#optimised-and-standard-theta-models">Optimised and standard Theta models</a></li>
  </ul></li>
  <li><a href="#loading-libraries-and-data" id="toc-loading-libraries-and-data" class="nav-link" data-scroll-target="#loading-libraries-and-data">Loading libraries and data </a><a class="anchor nav-link" id="loading" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">Read Data</a></li>
  </ul></li>
  <li><a href="#explore-data-with-the-plot-method" id="toc-explore-data-with-the-plot-method" class="nav-link" data-scroll-target="#explore-data-with-the-plot-method">Explore Data with the plot method </a><a class="anchor nav-link" id="plotting" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#autocorrelation-plots" id="toc-autocorrelation-plots" class="nav-link" data-scroll-target="#autocorrelation-plots">Autocorrelation plots</a></li>
  </ul></li>
  <li><a href="#split-the-data-into-training-and-testing" id="toc-split-the-data-into-training-and-testing" class="nav-link" data-scroll-target="#split-the-data-into-training-and-testing">Split the data into training and testing</a><a class="anchor nav-link" id="splitting" data-scroll-target="undefined"></a></li>
  <li><a href="#implementation-of-autotheta-with-statsforecast" id="toc-implementation-of-autotheta-with-statsforecast" class="nav-link" data-scroll-target="#implementation-of-autotheta-with-statsforecast">Implementation of AutoTheta with StatsForecast </a><a class="anchor nav-link" id="implementation" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#load-libraries" id="toc-load-libraries" class="nav-link" data-scroll-target="#load-libraries">Load libraries</a></li>
  <li><a href="#instantiate-model" id="toc-instantiate-model" class="nav-link" data-scroll-target="#instantiate-model">Instantiate Model</a></li>
  <li><a href="#fit-model" id="toc-fit-model" class="nav-link" data-scroll-target="#fit-model">Fit Model</a></li>
  <li><a href="#forecast-method" id="toc-forecast-method" class="nav-link" data-scroll-target="#forecast-method">Forecast Method</a></li>
  <li><a href="#predict-method-with-confidence-interval" id="toc-predict-method-with-confidence-interval" class="nav-link" data-scroll-target="#predict-method-with-confidence-interval">Predict method with confidence interval</a></li>
  </ul></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-validation </a><a class="anchor nav-link" id="cross_validate" data-scroll-target="undefined"></a>
  <ul class="collapse">
  <li><a href="#perform-time-series-cross-validation" id="toc-perform-time-series-cross-validation" class="nav-link" data-scroll-target="#perform-time-series-cross-validation">Perform time series cross-validation</a></li>
  </ul></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model Evaluation </a><a class="anchor nav-link" id="evaluate" data-scroll-target="undefined"></a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References </a><a class="anchor nav-link" id="references" data-scroll-target="undefined"></a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Nixtla/statsforecast/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">AutoTheta Model</h1>
</div>

<div>
  <div class="description">
    Step-by-step guide on using the <code>AutoTheta Model</code> with <code>Statsforecast</code>.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="table-of-contents" class="level2">
<h2 class="anchored" data-anchor-id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#model">Theta Models</a></li>
<li><a href="#loading">Loading libraries and data</a></li>
<li><a href="#plotting">Explore data with the plot method</a></li>
<li><a href="#splitting">Split the data into training and testing</a></li>
<li><a href="#implementation">Implementation of AutoTheta with StatsForecast</a></li>
<li><a href="#cross_validate">Cross-validation</a></li>
<li><a href="#evaluate">Model evaluation</a></li>
<li><a href="#references">References</a></li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction<a class="anchor" id="introduction"></a></h2>
<p>The development of accurate, robust and reliable forecasting methods for univariate time series is very important when large numbers of time series are involved in the modelling and forecasting process. In industrial settings, it is very common to work with large lines of products; thus, efficient sales and operational planning (S&amp;OP) depend heavily on accurate forecasting methods.</p>
<p>The Theta method <a href="https://www.sciencedirect.com/science/article/abs/pii/S0169207000000662">(Assimakopoulos &amp; Nikolopoulos, 2000, hereafter A&amp;N)</a> is applied to non-seasonal or deseasonalised time series, where the deseasonalisation is usually performed via the multiplicative classical decomposition. The method decomposes the original time series into two new lines through the so-called theta coefficients, denoted by <span class="math inline">\({\theta}_1\)</span> and <span class="math inline">\({\theta}_2\)</span> for <span class="math inline">\({\theta}_1, {\theta}_2 \in \mathbb{R}\)</span>, which are applied to the second difference of the data. The second differences are reduced when <span class="math inline">\({\theta}&lt;1\)</span>, resulting in a better approximation of the long-term behaviour of the series (Assimakopoulos, 1995). If <span class="math inline">\({\theta}\)</span> is equal to zero, the new line is a straight line. When <span class="math inline">\({\theta}&gt;1\)</span> the local curvatures are increased, magnifying the short-term movements of the time series (A&amp;N). The new lines produced are called theta lines, denoted here by <span class="math inline">\(\text{Z}(\theta_1)\)</span> and <span class="math inline">\(\text{Z}(\theta_2)\)</span>. These lines have the same mean value and slope as the original data, but the local curvatures are either filtered out or enhanced, depending on the value of the <span class="math inline">\(\theta\)</span> coefficient.</p>
<p>In other words, the decomposition process has the advantage of exploiting information in the data that usually cannot be captured and modelled completely through the extrapolation of the original time series. The theta lines can be regarded as new time series and are extrapolated separately using an appropriate forecasting method. Once the extrapolation of each theta line has been completed, recomposition takes place through a combination scheme in order to calculate the point forecasts of the original time series. Combining has long been considered as a useful practice in the forecasting literature (for example, <a href="">Clemen, 1989, Makridakis and Winkler, 1983, Petropoulos et al., 2014</a>), and therefore its application to the Theta method is expected to result in more accurate and robust forecasts.</p>
<p>The Theta method is quite versatile in terms of choosing the number of theta lines, the theta coefficients and the extrapolation methods, and combining these to obtain robust forecasts. However, A&amp;N proposed a simplified version involving the use of only two theta lines with prefixed <span class="math inline">\(\theta\)</span> coefficients that are extrapolated over time using a linear regression (LR) model for the theta line with <span class="math inline">\({\theta}_1 =0\)</span> and simple exponential smoothing (SES) for the theta line with <span class="math inline">\({\theta}_2 =2\)</span>. The final forecasts are produced by combining the forecasts of the two theta lines with equal weights.</p>
<p>The performance of the Theta method has also been confirmed by other empirical studies (for example Nikolopoulos et al., 2012, Petropoulos and Nikolopoulos, 2013). Moreover, Hyndman and Billah (2003), hereafter H&amp;B, showed that the simple exponential smoothing with drift model (SES-d) is a statistical model for the simplified version of the Theta method. More recently, Thomakos and Nikolopoulos (2014) provided additional theoretical insights, while Thomakos and Nikolopoulos (2015) derived new theoretical formulations for the application of the method to multivariate time series, and investigated the conditions under which the bivariate Theta method is expected to forecast better than the univariate one. Despite these advances, we believe that the Theta method deserves more attention from the forecasting community, given its simplicity and superior forecasting performance.</p>
<p>One key aspect of the Theta method is that, by definition, it is dynamic. One can choose different theta lines and combine the produced forecasts using either equal or unequal weights. However, AN limit this important property by fixing the theta coefficients to have predefined values.</p>
<p>The contributions of this work are fourfold. First, we extend the A&amp;N method by the optimal selection of the theta line that describes the short-term movements of the series best, maintaining the long-term component. The forecasts derived from the two theta lines are combined using appropriate weights, which ensures the recomposition of the original time series. Second, we provide theoretical and practical links between the newly proposed model, the original Theta method and the SES-d model. Third, we also perform a further extension of the model that allows the regression line (the long term component) to be revised at every time period.</p>
</section>
<section id="theta-method" class="level2">
<h2 class="anchored" data-anchor-id="theta-method">Theta method <a class="anchor" id="model"></a></h2>
<section id="the-original-theta-method" class="level3">
<h3 class="anchored" data-anchor-id="the-original-theta-method">The original Theta method</h3>
<p>Originally, AN proposed the theta line as the solution of the equation</p>
<p><span class="math display">\[\nabla^2 \text{Z}_t (\theta) =\theta \nabla^2 Y_t, \ \ t=3, \cdots, n \tag 1\]</span></p>
<p>where <span class="math inline">\(Y_1, \cdots Y_n\)</span> is the original time series (non-seasonal or deseasonalised) and <span class="math inline">\(\nabla\)</span> is the difference operator (i.e., <span class="math inline">\(\nabla X_t = X_t - X_{t-1}\)</span>). The initial values of <span class="math inline">\(\text{Z}_1\)</span> and <span class="math inline">\(\text{Z}_2\)</span> are obtained by minimising $_{t=1}^n [Y_t -_t()]^2 $. However, an analytical solution to compute the <span class="math inline">\(\text{Z}(\theta)\)</span> was obtained by H&amp;B, which is given by</p>
<p><span class="math display">\[\text{Z}_t(\theta)=\theta Y_t +(1-\theta)(A_n +B_n t) \ \ t=1, \cdots n \tag 2 \]</span></p>
<p>where <span class="math inline">\(\text{A}_n\)</span> and <span class="math inline">\(\text{B}_n\)</span> are the minimum square coefficients of a simple linear regression over <span class="math inline">\(Y_1, \cdots Y_n\)</span> against <span class="math inline">\(1, \cdots n \ \)</span>, given by</p>
<p><span class="math display">\[\text{A}_n =\frac{1}{n} \sum_{t=1}^{n} Y_t -\frac{n+1}{2} \text{B}_n ; \ \ \text{B}_n= \frac{6}{n^2 -1} (\frac{2}{n} \sum_{t=1}^{n} tY_t -\frac{1+n}{n} \sum_{t=1}^{n} Y_t ) \tag 3\]</span></p>
<p>From this point of view, the theta lines can be interpreted as functions of the linear regression model applied to the data directly. However, note that <span class="math inline">\(\text{A}_n\)</span> and <span class="math inline">\(\text{B}_n\)</span> are only functions of the original data, not parameters of the Theta method.</p>
<p>Finally, the forecasts produced by the Theta method for <span class="math inline">\(h\)</span> steps ahead of are an ad-hoc combination (50%‚Äì50%) of the extrapolations of $(0) $ and <span class="math inline">\(\text{Z}(2)\)</span> by the linear regression model and the simple exponential smoothing model respectively. We will refer to the above setup as the standard Theta method (STheta).</p>
<p>The steps for building the STheta method of AN are as follows: 1. Deseasonalisation: The time series is tested for statistically significant seasonal behaviour. A time series is seasonal if <span class="math display">\[|r_m|&gt;q_{1-\alpha/2} \sqrt{\frac{1+2 \sum_{i=1}^{m-1} r_{i}^2}{n} } \]</span></p>
<p>where <span class="math inline">\(r_k\)</span> denotes the lag <span class="math inline">\(k\)</span> autocorrelation function, <span class="math inline">\(m\)</span> is the number of the periods within a seasonal cycle (for example, 12 for monthly data), <span class="math inline">\(n\)</span> is the sample size, <span class="math inline">\(q\)</span> is the quantile function of the standard normal distribution, and <span class="math inline">\((1-\alpha)\%\)</span> is the confidence level. A&amp;N opted for a 90% confidence level. If the time series is identified as seasonal, then it is deseasonalised via the classical decomposition method, assuming the seasonal component to have a multiplicative relationship.</p>
<ol start="2" type="1">
<li><p>Decomposition: The seasonally adjusted time series is decomposed into two theta lines, the linear regression line <span class="math inline">\(\text{Z}(0)\)</span> and the theta line <span class="math inline">\(\text{Z}(2)\)</span>.</p></li>
<li><p>Extrapolation: <span class="math inline">\(\text{Z}(0)\)</span> is extrapolated as a normal linear regression line, while <span class="math inline">\(\text{Z}(2)\)</span> is extrapolated using SES.</p></li>
<li><p>Combination: The final forecast is a combination of the forecasts of the two theta lines using equal weights.</p></li>
<li><p>Reseasonalisation: If the series was identified as seasonal in step 1, then the final forecasts are multiplied by the respective seasonal indices.</p></li>
</ol>
</section>
<section id="models-for-optimising-the-theta-method" class="level3">
<h3 class="anchored" data-anchor-id="models-for-optimising-the-theta-method">Models for optimising the Theta method</h3>
<p>Assume that either the time series <span class="math inline">\(Y_1, \cdots Y_n\)</span> is non-seasonal or it has been seasonally adjusted using the multiplicative classical decomposition approach.</p>
<p>Let <span class="math inline">\(X_t\)</span> be the linear combination of two theta lines, <span class="math display">\[X_t=\omega \text{Z}_t (\theta_1) +(1-\omega) \text{Z}_t (\theta_2) \tag 4\]</span></p>
<p>where <span class="math inline">\(\omega \in [0,1]\)</span> is the weight parameter. Assuming that <span class="math inline">\(\theta_1 &lt;1\)</span> and <span class="math inline">\(\theta_2 \geq 1\)</span>, the weight <span class="math inline">\(\omega\)</span> can be derived as <span class="math display">\[\omega:=\omega(\theta_1, \theta_2)=\frac{\theta_2 -1}{\theta_2 -\theta_1} \tag 5\]</span></p>
<p>It is straightforward to see from Eqs. (4), (5) that <span class="math inline">\(X_t=Y_t, \ t=1, \cdots n\)</span> i.e., the weights are calculated properly in such a way that Eq. (4) reproduces the original series. In Theorem 1 of <a href="https://www.sciencedirect.com/science/article/pii/S0169207016300243#s000075">Appendix A</a> , we prove that the solution is unique and that the error from not choosing the optimal weights (<span class="math inline">\(\omega\)</span> and <span class="math inline">\(1-\omega\)</span>) s proportional to the error of a linear regression model. As a consequence, the STheta method is given simply by setting <span class="math inline">\(\theta_1=0\)</span> and <span class="math inline">\(\theta_2=2\)</span> while from Eq. (5) we get <span class="math inline">\(\omega=0.5\)</span>. Thus, Eqs. (4), (5) allow us to construct a generalisation of the Theta model that maintains the re-composition propriety of the original time series for any theta lines <span class="math inline">\(\text{Z}_t (\theta_1)\)</span> and <span class="math inline">\(\text{Z}_t (\theta_2)\)</span>.</p>
<p>In order to maintain the modelling of the long-term component and retain a fair comparison with the STheta method, in this work we fix <span class="math inline">\(\theta_1=0\)</span> and focus on the optimisation of the short-term component, <span class="math inline">\(\theta_2=0\)</span> with <span class="math inline">\(\theta \geq 1\)</span>. Thus, <span class="math inline">\(\theta\)</span> is the only parameter that requires estimation so far. The theta decomposition is now given by</p>
<p><span class="math display">\[Y_t=(1-\frac{1}{\theta}) (\text{A}_n+\text{B}_n t)+ \frac{1}{\theta} \text{Z}_t (\theta), \ t=1, \cdots , n \]</span></p>
<p>The <span class="math inline">\(h\)</span> -step-ahead forecasts calculated at origin are given by</p>
<p><span class="math display">\[\hat Y_{n+h|n} = (1-\frac{1}{\theta}) [\text{A}_n+\text{B}_n (n+h)]+ \frac{1}{\theta} \tilde {\text{Z}}_{n+h|n} (\theta) \tag 6\]</span></p>
<p>where <span class="math inline">\(\tilde {\text{Z}}_{n+h|n} (\theta)=\tilde {\text{Z}}_{n+1|n} (\theta)=\alpha \sum_{i=0}^{n-1}(1-\alpha)^i \text{Z}_{n-i}(\theta)+(1-\alpha)^n \ell_{0}^{*}\)</span> is the extrapolation of <span class="math inline">\(\text{Z}_t(\theta)\)</span> by an SES model with <span class="math inline">\(\ell_{0}^{*} \in \mathbb{R}\)</span> as the initial level parameter and <span class="math inline">\(\alpha \in (0,1)\)</span> as the smoothing parameter. Note that for <span class="math inline">\(\theta=2\)</span> Eq. (6) corresponds to Step 4 of the STheta algorithm. After some algebra, we can write</p>
<p><span class="math display">\[\tilde {\text{Z}}_{n+1|n} (\theta)=\theta \ell{n}+(1-\theta) \{ \text{A}_n [1-(1-\alpha)^n] + \text{B}_n [n+(1-\frac{1}{\alpha}) [1-(1-\alpha)^n] ]  \}   \tag 7\]</span></p>
<p>where <span class="math inline">\(\ell_{t}=\alpha Y_t +(1-\alpha) \ell_{t-1}\)</span> for <span class="math inline">\(t=1, \cdots, n\)</span> and <span class="math inline">\(\ell_{0}=\ell_{0}^{*}/\theta\)</span>.</p>
<p>In the light of Eqs. (6), (7), we suggest four stochastic approaches. These approaches differ due to the parameter <span class="math inline">\(\theta\)</span> which may be either fixed at two or optimised, and the coefficients <span class="math inline">\(\text{A}_n\)</span> and <span class="math inline">\(\text{B}_n\)</span>, which can be either fixed or dynamic functions. To formulate the state space models, it is helpful to adopt <span class="math inline">\(\mu_{t}\)</span> as the one-step-ahead forecast at origin <span class="math inline">\(t-1\)</span> and <span class="math inline">\(\varepsilon_{t}\)</span> as the respective additive error, i.e., <span class="math inline">\(\varepsilon_{t}=Y_t - \mu_{t}\)</span> if <span class="math inline">\(\mu_{t}= \hat Y_{t|t-1}\)</span>. We assume <span class="math inline">\(\{ \varepsilon_{t} \}\)</span> to be a Gaussian white noise process with mean zero and variance <span class="math inline">\(\sigma^2\)</span>.</p>
</section>
<section id="optimised-and-standard-theta-models" class="level3">
<h3 class="anchored" data-anchor-id="optimised-and-standard-theta-models">Optimised and standard Theta models</h3>
<p>Let <span class="math inline">\(\text{A}_n\)</span> and <span class="math inline">\(\text{B}_n\)</span> be fixed coefficients for all <span class="math inline">\(t=1, \cdots, n\)</span> so that Eqs. (6), (7) configure the state space model given by</p>
<p><span class="math display">\[Y_t=\mu_{t}+\varepsilon_{t} \tag 8\]</span></p>
<p><span class="math display">\[\mu_{t}=\ell_{t-1}+(1-\frac{1}{\theta}) \{(1-\alpha)^{t-1} \text{A}_n +[\frac{1-(1-\alpha)^t}{\alpha} \text{B}_n]  \tag 9   \}\]</span></p>
<p><span class="math display">\[\ell_{t}=\alpha Y_t +(1-\alpha)\ell_{t-1} \tag{10} \]</span></p>
<p>with parameters <span class="math inline">\(\ell_{0} \in \mathbb{R}\)</span>, <span class="math inline">\(\alpha \in (0,1)\)</span> and <span class="math inline">\(\theta \in [1,\infty)\)</span> . The parameter <span class="math inline">\(\theta\)</span> is to be estimated along with <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\ell_{0}\)</span> We call this the optimised Theta model (OTM).</p>
<p>The <span class="math inline">\(h\)</span>-step-ahead forecast at origin <span class="math inline">\(n\)</span> is given by</p>
<p><span class="math display">\[\hat Y_{n+h|n}=E[Y_{n+h}|Y_1,\cdots, Y_n]=\ell_{n}+(1-\frac{1}{\theta}) \{(1-\alpha)^n \text{A}_n +[(h-1) + \frac{1-(1-\alpha)^{n+1}}{\alpha}] \text{B}_n \}   \]</span></p>
<p>which is equivalent to Eq. (6). The conditional variance $[Y_{n+h}|Y_1, , Y_n]=[1+(h-1)^2]^2 $ can be computed easily from the state space model. Thus, the <span class="math inline">\((1-\alpha)\%\)</span> prediction interval for <span class="math inline">\(Y_{n+h}\)</span> is given by <span class="math display">\[\hat Y_{n+h|n} \ \pm  \ q_{1-\alpha/2} \sqrt{[1+(h-1)\alpha^2 ]\sigma^2 } \]</span></p>
<p>For <span class="math inline">\(\theta=2\)</span> OTM reproduces the forecasts of the STheta method; hereafter, we will refer to this particular case as the standard Theta model (STM). In Theorem 2 of <a href="https://www.sciencedirect.com/science/article/pii/S0169207016300243#s000075">Appendix A</a>, we show that OTM is mathematically equivalent to the SES-d model. As a corollary of Theorem 2, STM is mathematically equivalent to SES-d with <span class="math inline">\(b=\frac{1}{2} \text{B}_n\)</span>. Therefore, for <span class="math inline">\(\theta=2\)</span> the corollary also re-confirms the H&amp;B result on the relationship between STheta and the SES-d model.</p>
</section>
</section>
<section id="loading-libraries-and-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-and-data">Loading libraries and data <a class="anchor" id="loading"></a></h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Statsforecast will be needed. To install, see <a href="../../docs/getting-started/installation.html">instructions</a>.</p>
</div>
</div>
<p>Next, we import plotting libraries and configure the plotting style.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">'fivethirtyeight'</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'lines.linewidth'</span>] <span class="op">=</span> <span class="fl">1.5</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>dark_style <span class="op">=</span> {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'figure.facecolor'</span>: <span class="st">'#212946'</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.facecolor'</span>: <span class="st">'#212946'</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'savefig.facecolor'</span>:<span class="st">'#212946'</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.grid'</span>: <span class="va">True</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.grid.which'</span>: <span class="st">'both'</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.left'</span>: <span class="va">False</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.right'</span>: <span class="va">False</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.top'</span>: <span class="va">False</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.spines.bottom'</span>: <span class="va">False</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.color'</span>: <span class="st">'#2A3459'</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'grid.linewidth'</span>: <span class="st">'1'</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'text.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'axes.labelcolor'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'xtick.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ytick.color'</span>: <span class="st">'0.9'</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'font.size'</span>: <span class="dv">12</span> }</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>plt.rcParams.update(dark_style)</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pylab <span class="im">import</span> rcParams</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="dv">18</span>,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="read-data" class="level3">
<h3 class="anchored" data-anchor-id="read-data">Read Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"https://raw.githubusercontent.com/Naren8520/Serie-de-tiempo-con-Machine-Learning/main/Data/candy_production.csv"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">observation_date</th>
<th data-quarto-table-cell-role="th">IPG3113N</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1972-01-01</td>
<td>85.6945</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-02-01</td>
<td>71.8200</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1972-03-01</td>
<td>66.0229</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1972-04-01</td>
<td>64.5645</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1972-05-01</td>
<td>65.0100</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>The input to StatsForecast is always a data frame in long format with three columns: unique_id, ds and y:</p>
<ul>
<li><p>The <code>unique_id</code> (string, int or category) represents an identifier for the series.</p></li>
<li><p>The <code>ds</code> (datestamp) column should be of a format expected by Pandas, ideally YYYY-MM-DD for a date or YYYY-MM-DD HH:MM:SS for a timestamp.</p></li>
<li><p>The <code>y</code> (numeric) represents the measurement we wish to forecast.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"unique_id"</span>]<span class="op">=</span><span class="st">"1"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df.columns<span class="op">=</span>[<span class="st">"ds"</span>, <span class="st">"y"</span>, <span class="st">"unique_id"</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1972-01-01</td>
<td>85.6945</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-02-01</td>
<td>71.8200</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1972-03-01</td>
<td>66.0229</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1972-04-01</td>
<td>64.5645</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1972-05-01</td>
<td>65.0100</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ds            object
y            float64
unique_id     object
dtype: object</code></pre>
</div>
</div>
<p>We can see that our time variable <code>(ds)</code> is in an object format, we need to convert to a date format</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"ds"</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">"ds"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="explore-data-with-the-plot-method" class="level2">
<h2 class="anchored" data-anchor-id="explore-data-with-the-plot-method">Explore Data with the plot method <a class="anchor" id="plotting"></a></h2>
<p>Plot some series using the plot method from the StatsForecast class. This method prints aa random series from the dataset and is useful for basic EDA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>StatsForecast.plot(df, engine<span class="op">=</span><span class="st">"matplotlib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<section id="autocorrelation-plots" class="level3">
<h3 class="anchored" data-anchor-id="autocorrelation-plots">Autocorrelation plots</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>plot_acf(df[<span class="st">"y"</span>],  lags<span class="op">=</span><span class="dv">60</span>, ax<span class="op">=</span>axs[<span class="dv">0</span>],color<span class="op">=</span><span class="st">"fuchsia"</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">"Autocorrelation"</span>)<span class="op">;</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>plot_pacf(df[<span class="st">"y"</span>],  lags<span class="op">=</span><span class="dv">60</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>],color<span class="op">=</span><span class="st">"lime"</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Partial Autocorrelation'</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-9-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="split-the-data-into-training-and-testing" class="level2">
<h2 class="anchored" data-anchor-id="split-the-data-into-training-and-testing">Split the data into training and testing<a class="anchor" id="splitting"></a></h2>
<p>Let‚Äôs divide our data into sets 1. Data to train our <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#autotheta"><code>AutoTheta</code></a> model 2. Data to test our model</p>
<p>For the test data we will use the last 12 months to test and evaluate the performance of our model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> df[df.ds<span class="op">&lt;=</span><span class="st">'2016-08-01'</span>] </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> df[df.ds<span class="op">&gt;</span><span class="st">'2016-08-01'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>train.shape, test.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>((536, 3), (12, 3))</code></pre>
</div>
</div>
<p>Now let‚Äôs plot the training data and the test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sns.lineplot(train,x<span class="op">=</span><span class="st">"ds"</span>, y<span class="op">=</span><span class="st">"y"</span>, label<span class="op">=</span><span class="st">"Train"</span>, linewidth<span class="op">=</span><span class="dv">3</span>, linestyle<span class="op">=</span><span class="st">":"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>sns.lineplot(test, x<span class="op">=</span><span class="st">"ds"</span>, y<span class="op">=</span><span class="st">"y"</span>, label<span class="op">=</span><span class="st">"Test"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Candy Production"</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Month"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="implementation-of-autotheta-with-statsforecast" class="level2">
<h2 class="anchored" data-anchor-id="implementation-of-autotheta-with-statsforecast">Implementation of AutoTheta with StatsForecast <a class="anchor" id="implementation"></a></h2>
<p>To also know more about the parameters of the functions of the <code>AutoTheta Model</code>, they are listed below. For more information, visit the <a href="https://nixtla.github.io/statsforecast/src/core/models.html#automatic-forecasting">documentation</a></p>
<pre><code>season_length : int
    Number of observations per unit of time. Ex: 24 Hourly data.
decomposition_type : str
    Sesonal decomposition type, 'multiplicative' (default) or 'additive'.
model : str
    Controlling Theta Model. By default searchs the best model.
alias : str
    Custom name of the model.</code></pre>
<section id="load-libraries" class="level3">
<h3 class="anchored" data-anchor-id="load-libraries">Load libraries</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> AutoTheta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="instantiate-model" class="level3">
<h3 class="anchored" data-anchor-id="instantiate-model">Instantiate Model</h3>
<p>Import and instantiate the models. Setting the argument is sometimes tricky. This article on <a href="https://robjhyndman.com/hyndsight/seasonal-periods/">Seasonal periods</a> by the master, Rob Hyndmann, can be useful.season_length.</p>
<p>Automatically selects the best Theta (Standard Theta Model <code>(‚ÄòSTM‚Äô)</code>, Optimized Theta Model <code>(‚ÄòOTM‚Äô)</code>, Dynamic Standard Theta Model <code>(‚ÄòDSTM‚Äô)</code>, Dynamic Optimized Theta Model <code>(‚ÄòDOTM‚Äô))</code> model using mse.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>season_length <span class="op">=</span> <span class="dv">12</span> <span class="co"># Monthly data </span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>horizon <span class="op">=</span> <span class="bu">len</span>(test) <span class="co"># number of predictions</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We call the model that we are going to use</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [AutoTheta(season_length<span class="op">=</span>season_length,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>                     decomposition_type<span class="op">=</span><span class="st">"additive"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>                     model<span class="op">=</span><span class="st">"STM"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We fit the models by instantiating a new StatsForecast object with the following parameters:</p>
<p>models: a list of models. Select the models you want from models and import them.</p>
<ul>
<li><p><code>freq:</code> a string indicating the frequency of the data. (See <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">panda‚Äôs available frequencies</a>.)</p></li>
<li><p><code>n_jobs:</code> n_jobs: int, number of jobs used in the parallel processing, use -1 for all cores.</p></li>
<li><p><code>fallback_model:</code> a model to be used if a model fails.</p></li>
</ul>
<p>Any settings are passed into the constructor. Then you call its fit method and pass in the historical data frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>sf <span class="op">=</span> StatsForecast(df<span class="op">=</span>train,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                   models<span class="op">=</span>models,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                   freq<span class="op">=</span><span class="st">'MS'</span>, </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                   n_jobs<span class="op">=-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fit-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-model">Fit Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sf.fit()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>StatsForecast(models=[AutoTheta])</code></pre>
</div>
</div>
<p>Let‚Äôs see the results of our Theta model. We can observe it with the following instruction:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>result<span class="op">=</span>sf.fitted_[<span class="dv">0</span>,<span class="dv">0</span>].model_</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'mse': 100.64880011735451,
 'amse': array([19.1126859 , 31.8559999 , 38.50771628]),
 'fit': results(x=array([258.45065328,   0.7664297 ]), fn=100.57831804495909, nit=32, simplex=array([[250.37338839,   0.76970741],
        [232.0391584 ,   0.76429422],
        [258.45065328,   0.7664297 ]])),
 'residuals': array([ 2.10810474e+00, -1.13894116e+01, -9.49139749e+00, -9.82041058e+00,
        -1.13263190e+01, -9.25797072e+00, -8.56619271e+00, -8.99232281e+00,
        -1.98586635e+00,  3.14569304e+01,  1.98520670e+01,  2.04962612e+01,
         4.98121093e+00, -1.08735318e+01, -1.12328034e+01, -8.08115311e+00,
        -9.98197694e+00, -8.39937079e+00, -1.25789510e+01, -1.05952806e+01,
         8.47229675e-01,  2.25644626e+01,  2.54401518e+01,  1.73989709e+01,
         2.40287622e+00, -2.53475414e+00, -8.00590851e+00, -1.79241485e+01,
        -6.36590415e+00, -5.76986711e+00, -2.26766747e+01, -8.95260757e+00,
        -7.19719238e+00,  2.74032221e+01,  2.21368465e+01,  6.43171918e+00,
        -3.51755110e+00, -1.31441914e+01, -6.13166000e+00,  1.51512233e+00,
        -8.05776753e+00, -8.59603097e+00, -1.08617848e+01, -6.72940024e+00,
        -6.24861877e+00,  2.85996831e+01,  2.98048000e+01,  1.90032272e+01,
         5.07597932e+00, -9.59170287e+00, -1.64521040e+01, -7.52212480e+00,
        -5.16540017e+00, -1.27924605e+01, -9.68434388e+00, -8.76758699e+00,
        -8.27471729e-01,  3.08424000e+01,  2.47947373e+01,  2.35867234e+01,
         3.75665137e+00, -4.47305376e+00, -1.48000353e+01, -1.08431533e+01,
        -1.01249948e+01, -1.12379772e+01, -1.28624668e+01, -9.47780366e+00,
        -2.17961621e-01,  2.49398623e+01,  1.66027796e+01,  2.62581226e+01,
        -1.94878910e+00, -8.10877623e+00, -6.93183588e+00, -6.80707230e+00,
        -1.17809900e+01, -1.05320691e+01, -1.59715820e+01, -9.07599954e+00,
         6.11989624e-01,  2.24925204e+01,  2.57389548e+01,  2.38907624e+01,
         4.99776573e+00, -1.07054647e+01, -7.24194335e+00, -1.17412089e+01,
        -1.10031569e+01, -9.10138933e+00, -1.62277217e+01, -1.02585273e+01,
        -2.79431182e+00,  1.96746062e+01,  2.40620697e+01,  2.00041945e+01,
         8.38672864e-01, -3.01704956e-01, -1.10576385e+01, -1.76502427e+01,
        -4.79852872e+00, -7.74057037e+00, -1.55628715e+01, -6.19663669e+00,
        -4.85268042e+00,  2.17819362e+01,  2.48075797e+01,  2.16186239e+01,
         9.21215945e+00, -1.71191246e+00, -1.38314202e+01, -9.44161648e+00,
        -6.35863859e+00, -1.10470634e+01, -1.41408696e+01, -9.60040139e+00,
        -4.80959573e+00,  3.41173932e+01,  2.02685750e+01,  1.65177476e+01,
         1.45004512e+00, -6.65007227e-01, -1.11027908e+01, -1.82545880e+01,
        -1.08637859e+01, -9.67573744e+00, -1.22946690e+01, -1.02064789e+01,
        -2.94225752e+00,  3.21840486e+01,  2.21586037e+01,  2.09073985e+01,
        -2.49861035e-01, -6.05605693e+00, -1.16741817e+01, -1.31096440e+01,
        -1.07043792e+01, -1.25489002e+01, -9.16715967e+00, -7.70278796e+00,
        -2.55656615e+00,  2.69936390e+01,  1.62042825e+01,  1.67614454e+01,
         8.62186772e+00, -3.51518872e+00, -9.27420876e+00, -1.15442800e+01,
        -9.96136035e+00, -1.17898547e+01, -1.13147631e+01, -7.10440289e+00,
        -1.10170687e+00,  2.60646470e+01,  2.32687962e+01,  1.82272075e+01,
         3.98792429e+00, -7.64233456e+00, -1.07945924e+01, -1.16024033e+01,
        -1.10645356e+01, -1.33282252e+01, -1.15534869e+01, -6.76285862e+00,
         3.93787288e+00,  2.37018466e+01,  2.07922165e+01,  2.37645525e+01,
         7.00181250e-01, -1.59605643e+00, -1.62277551e+01, -1.51068272e+01,
        -1.01377617e+01, -1.13639555e+01, -1.38275875e+01, -5.87092406e+00,
         3.43469843e+00,  2.82932152e+01,  2.39510183e+01,  1.71053567e+01,
         6.00991052e-01, -7.61227344e-01, -1.18686652e+01, -1.51989720e+01,
        -1.23352889e+01, -1.09931328e+01, -1.34086750e+01, -4.52127936e+00,
         2.09363456e+00,  3.13825833e+01,  2.43980039e+01,  1.89899596e+01,
        -7.55701831e+00, -2.76896118e-01, -6.52574213e+00, -1.67167273e+01,
        -1.17498904e+01, -7.68050375e+00, -5.60844064e+00, -2.79087748e+00,
        -2.92096472e-01,  2.31896512e+01,  1.70158839e+01,  1.84177146e+01,
        -3.39879932e-01,  1.31241678e+00, -9.65552310e+00, -1.30840504e+01,
        -1.33540007e+01, -9.72077532e+00, -1.09022915e+01, -4.49636293e+00,
        -6.88545386e-01,  1.88878505e+01,  2.15227108e+01,  2.32009713e+01,
        -5.72605410e+00,  1.87746304e+00, -6.95944417e+00, -1.41944243e+01,
        -1.25398538e+01, -8.09461371e+00, -5.46316779e+00, -4.73324801e+00,
         1.12162623e+00,  1.61183549e+01,  2.63470348e+01,  2.28827932e+01,
        -6.75326627e+00,  4.34024335e+00, -6.61711421e+00, -1.64533692e+01,
        -1.44473755e+01, -4.85575266e+00, -1.14659676e+01, -1.83411691e+00,
        -3.17491990e+00,  1.22586080e+01,  2.19162170e+01,  1.62630875e+01,
        -1.99943217e+00,  2.59143066e-03, -8.89995746e+00, -1.10976710e+01,
        -1.43864442e+01, -9.48222086e+00, -1.06785679e+01, -7.24340992e+00,
         2.15093059e+00,  1.53607646e+01,  2.06126872e+01,  1.96076193e+01,
         3.03104513e+00, -8.52381714e-02, -8.52357291e+00, -1.33461539e+01,
        -1.37600223e+01, -6.08840914e+00, -8.32367614e+00, -3.02117355e+00,
         4.08613501e-01,  1.63346128e+01,  1.76259441e+01,  1.75724074e+01,
         1.52688580e+00, -2.23616547e+00, -3.82137115e+00, -1.61943645e+01,
        -1.55739800e+01, -6.10489281e+00, -6.56542552e+00, -3.79160289e+00,
         1.79366877e+00,  1.37690217e+01,  1.71703998e+01,  2.12968995e+01,
         2.55881699e+00, -5.89333546e+00, -5.43867789e+00, -9.34441587e+00,
        -1.23296390e+01, -7.43701646e+00, -9.59827596e+00, -6.98198281e+00,
        -7.94913086e-01,  1.30601029e+01,  2.03392159e+01,  2.52824428e+01,
        -3.95418141e+00,  2.43162639e+00, -3.09610920e+00, -1.49779650e+01,
        -1.07287620e+01, -8.40149865e+00, -1.18887461e+01, -1.74756743e+00,
         2.17909199e+00,  1.20038424e+01,  2.42508105e+01,  2.34572744e+01,
        -5.17568502e+00, -1.96581848e-01, -4.18458181e+00, -1.55119014e+01,
        -1.38833806e+01, -8.29522400e+00, -1.30003229e+01, -1.67000232e-01,
         9.35163928e-01,  1.47273988e+01,  2.29308492e+01,  2.17103709e+01,
         3.68218624e+00,  2.64748987e-01, -7.34442764e+00, -1.25122409e+01,
        -1.14503466e+01, -8.19533607e+00, -1.15456959e+01, -2.81694144e+00,
        -1.50157905e+00,  1.14252476e+01,  2.08253666e+01,  1.93274968e+01,
         7.94221350e-01, -5.10391223e-01, -8.74258215e+00, -9.01560883e+00,
        -1.00192385e+01, -1.10908755e+01, -1.09129047e+01, -6.64424323e+00,
        -1.50482360e+00,  1.46897903e+01,  1.73829646e+01,  2.23508538e+01,
         8.64908630e+00,  6.22671094e-01, -6.68012804e+00, -5.70808134e+00,
        -1.80391994e+01, -7.97570029e+00, -1.19962951e+01, -5.55858845e+00,
         2.35415415e+00,  1.17526341e+01,  1.54009299e+01,  2.21564078e+01,
         3.90927294e+00,  2.21699393e+00, -3.80724429e+00, -1.09345637e+01,
        -1.37938445e+01, -1.00726067e+01, -1.19963695e+01, -5.40000947e+00,
        -1.51911075e+00,  1.69895894e+00,  1.74367915e+01,  2.04883209e+01,
         7.55305128e+00,  7.29570557e-01, -5.09536064e+00, -1.29493288e+01,
        -1.53454354e+01, -2.46711146e+00, -1.01903530e+01, -4.03697109e+00,
        -3.08084248e+00,  3.86928003e+00,  1.92764138e+01,  1.55958083e+01,
         7.35560975e+00,  1.85905807e+00, -5.61642383e-01, -1.23394878e+01,
        -9.90369395e+00, -7.50968535e+00, -1.83651427e+01, -2.77916462e+00,
        -1.07805579e+00,  8.15877069e+00,  2.33477145e+01,  1.69720399e+01,
         6.19355475e+00,  4.92033569e+00, -1.36452248e+01, -1.10382213e+01,
        -4.45625718e+00, -1.37976279e+01, -1.12070256e+01, -1.28293835e+00,
         1.02619080e-01,  1.16373460e+01,  1.73964054e+01,  1.64050950e+01,
         1.32632343e+01,  4.44789636e+00, -1.66636731e+01, -1.04932464e+01,
        -7.27536875e+00, -1.52095873e+01, -8.33331642e+00, -6.12562858e+00,
        -6.19892773e-01,  1.73375832e+01,  1.71076149e+01,  2.30092407e+01,
        -1.39793491e+00,  1.20108252e+00, -1.01506302e+01, -9.35708666e+00,
        -1.72524976e+01, -1.33257495e+01, -1.11436034e+01, -1.07822300e+00,
         2.29722831e+00,  1.15489407e+01,  1.72661569e+01,  2.11762694e+01,
         9.51783992e+00, -1.02191544e+00, -5.14895468e+00, -2.05301462e+01,
        -1.56429874e+01, -1.60412132e+01, -1.50915598e+01, -2.94815391e+00,
         4.61947153e+00,  6.94204539e+00,  1.79378224e+01,  2.19333492e+01,
         8.01926611e+00, -3.09873730e+00, -6.33384070e+00, -1.29667977e+01,
        -1.54450147e+01, -1.27736740e+01, -1.46733540e+01, -8.76926667e+00,
         8.56843032e+00,  1.28259081e+01,  1.86473179e+01,  5.73666716e+00,
         4.33460410e+00,  2.08833633e+00, -3.96959197e+00, -1.29223836e+01,
        -1.19550430e+01, -1.27279222e+01, -8.02537455e+00, -3.92330203e+00,
         7.09140653e+00,  2.42153186e+01,  1.28924490e+01,  1.79712039e+01,
         2.89523345e+00,  1.30474561e+00, -7.77941964e+00, -1.04361436e+01,
        -1.14357282e+01, -1.23868253e+01, -3.73409886e+00,  6.47317969e-01,
         5.14176714e+00,  1.16621419e+01,  8.00349658e+00,  1.83900836e+01,
         3.46846826e+00,  2.29413411e+00, -4.06962429e+00, -8.55164816e+00,
        -1.76399687e+01, -1.50423464e+01, -1.13765493e+01, -9.17973348e+00,
        -4.22253840e+00,  2.19090146e+01,  1.90170613e+01,  1.80606320e+01,
         4.08981908e+00,  2.02346575e+00, -5.45474178e+00, -1.38725735e+01,
        -1.50622767e+01, -1.15367785e+01, -7.55445662e+00, -1.77510786e+00,
         9.46336210e+00,  4.88813442e+00,  1.61490921e+01,  1.93212523e+01,
         1.03075606e+01, -6.46757556e-01, -5.79533411e-01, -1.35917688e+01,
        -1.62148895e+01, -1.29823914e+01, -1.02149059e+01, -3.24210991e+00,
         3.05411548e-01,  1.19385124e+01,  2.08979522e+01,  2.19927488e+01,
         1.32364111e+00,  1.68626682e+00, -3.52030260e+00, -1.50337393e+01,
        -1.75865889e+01, -1.23980830e+01, -1.19670278e+01, -1.59575155e+00,
         4.32015198e+00,  1.39461341e+01,  2.63901700e+01,  2.11431702e+01,
         1.19960846e+00,  1.22769642e+00, -3.12850968e+00, -1.23388318e+01,
        -1.66429415e+01, -9.08277175e+00, -7.92637109e+00,  2.43702710e+00,
        -3.53211257e+00,  1.00606809e+01,  1.39608449e+01,  1.44689445e+01,
         6.50770870e+00,  3.13941359e+00, -4.89894849e-01, -1.05833253e+01,
        -1.34863092e+01, -1.20763816e+01, -1.00738931e+01, -9.39207509e+00]),
 'm': 12,
 'states': array([[7.33548965e+01, 8.30544205e+01, 8.40569077e+01, 6.14692122e-02,
         8.35863953e+01],
        [7.31818390e+01, 7.80917587e+01, 8.40569077e+01, 6.14692122e-02,
         8.32094116e+01],
        [7.38093872e+01, 7.67280502e+01, 8.40569077e+01, 6.14692122e-02,
         7.55142975e+01],
        ...,
        [1.12984993e+02, 1.00517860e+02, 8.40569077e+01, 6.14692122e-02,
         1.14480782e+02],
        [1.14049675e+02, 1.00543762e+02, 8.40569077e+01, 6.14692122e-02,
         1.13025093e+02],
        [1.10946037e+02, 1.00561401e+02, 8.40569077e+01, 6.14692122e-02,
         1.14089775e+02]], dtype=float32),
 'par': {'initial_smoothed': 41.527209666340006,
  'alpha': 0.7664297044277077,
  'theta': 2.0},
 'n': 536,
 'modeltype': 'STM',
 'mean_y': 100.56138830499272,
 'decompose': True,
 'decomposition_type': 'additive',
 'seas_forecast': {'mean': array([  0.08977811,  18.09442   ,  20.248487  ,  19.430647  ,
           2.6400807 ,  -1.3090991 ,  -7.977731  , -12.3264065 ,
         -12.027774  , -10.136967  , -11.4229355 ,  -5.3025    ],
        dtype=float32)},
 'fitted': array([ 83.58639526,  83.20941162,  75.51429749,  74.38491058,
         76.33631897,  76.90467072,  77.60909271,  79.82932281,
         77.03206635,  75.4719696 ,  85.744133  ,  85.47103882,
         86.31848907,  88.1435318 ,  80.84380341,  78.37975311,
         81.66417694,  83.26287079,  84.62535095,  83.77008057,
         79.74427032,  80.35553741,  83.81224823,  87.82202911,
         86.29562378,  86.14455414,  85.23590851,  85.24504852,
         80.98550415,  85.35566711,  88.73347473,  80.13900757,
         77.37219238,  71.81797791,  78.98325348,  80.46128082,
         70.5292511 ,  65.84059143,  56.80056   ,  58.24617767,
         68.88546753,  71.95893097,  73.17068481,  73.63150024,
         72.56861877,  67.74141693,  75.82369995,  83.17867279,
         82.88182068,  84.77950287,  78.46220398,  71.9979248 ,
         75.71080017,  81.00106049,  78.99654388,  80.35978699,
         77.73477173,  77.0625    ,  86.86366272,  90.37877655,
         93.59484863,  94.48135376,  92.08713531,  86.88905334,
         88.05659485,  89.54567719,  88.73256683,  87.66000366,
         84.49066162,  84.28553772,  89.56282043,  86.79937744,
         92.0628891 ,  88.57657623,  83.39583588,  84.2281723 ,
         88.48908997,  88.70896912,  88.43688202,  84.98139954,
         82.12001038,  82.55097961,  85.95254517,  90.19133759,
         93.64043427,  95.47816467,  88.30724335,  88.90190887,
         89.38115692,  90.19718933,  91.0216217 ,  87.36982727,
         83.60211182,  81.4223938 ,  82.66423035,  85.61780548,
         86.08812714,  84.73820496,  85.54103851,  83.21124268,
         79.16162872,  84.73307037,  86.6004715 ,  83.45823669,
         82.80368042,  79.04636383,  81.90332031,  85.42827606,
         87.13594055,  92.20371246,  91.92572021,  87.47001648,
         89.71173859,  94.08746338,  93.42066956,  91.36830139,
         88.10499573,  84.38070679,  96.69192505,  96.73805237,
         94.53625488,  93.65490723,  94.17929077,  91.814888  ,
         87.30208588,  88.22493744,  88.60916901,  87.97177887,
         84.24395752,  81.95085144,  92.78029633,  94.27500153,
         95.43756104,  93.25335693,  89.64588165,  86.84354401,
         86.27397919,  87.31900024,  85.50115967,  87.26078796,
         85.45186615,  83.45436096,  90.30571747,  87.23685455,
         85.22183228,  89.83718872,  88.17710876,  87.21417999,
         87.84436035,  89.45885468,  88.22276306,  88.33640289,
         86.98610687,  86.10365295,  92.24300385,  94.58859253,
         93.69697571,  94.76073456,  89.93749237,  87.80930328,
         88.39493561,  89.16392517,  86.74878693,  86.67945862,
         85.59092712,  88.57095337,  92.89938354,  93.34684753,
         96.69921875,  95.24315643,  95.05395508,  88.7616272 ,
         86.66136169,  88.14065552,  87.23098755,  85.41872406,
         85.01380157,  87.60818481,  95.45558167,  98.32404327,
         96.57260895,  95.04052734,  95.49116516,  92.53977203,
         90.36888885,  90.1639328 ,  89.53847504,  88.04727936,
         88.67676544,  90.24331665, 100.45849609, 103.66954041,
        103.36251831,  95.57789612,  96.39974213,  97.54332733,
         94.20919037,  94.45290375,  96.36634064, 100.85347748,
        102.80919647, 102.54724884, 106.48311615, 104.0362854 ,
        103.29067993, 101.03748322, 103.0774231 , 101.82225037,
        101.27230072, 100.28657532, 100.6362915 , 101.06606293,
        101.71464539, 101.14884949, 101.78768921, 102.79502869,
        105.7154541 ,  99.33413696, 101.80714417, 102.61832428,
        101.21735382, 100.85561371, 102.45166779, 107.05014801,
        107.51717377, 108.33874512, 106.85496521, 111.55980682,
        114.23636627, 107.06775665, 111.42831421, 112.5018692 ,
        109.3695755 , 107.54585266, 111.62426758, 111.62201691,
        114.3110199 , 111.83959198, 107.39758301, 108.70651245,
        106.30953217, 102.78440857, 103.82045746, 103.14437103,
        104.11684418, 102.33982086, 102.87236786, 103.47360992,
        102.01676941, 103.62723541, 101.56281281, 101.87268066,
        102.03905487, 102.36943817, 103.33817291, 102.95055389,
        102.19972229, 100.90280914, 104.03647614, 106.44257355,
        108.2217865 , 108.49688721, 107.1788559 , 105.19959259,
        103.8061142 , 102.98366547, 102.30387115, 105.52016449,
        102.58638   ,  99.89919281, 103.02022552, 106.77390289,
        107.96263123, 109.29927826, 106.01490021, 103.68650055,
        105.14758301, 105.11603546, 101.63327789, 103.61001587,
        105.92623901, 105.72561646, 107.82567596, 109.25488281,
        107.99841309, 107.35109711, 103.52338409, 103.62365723,
        108.13938141, 103.11607361, 106.0138092 , 109.78596497,
        107.78446198, 108.81079865, 110.17164612, 109.84536743,
        112.60070801, 114.23275757, 109.5954895 , 112.69372559,
        115.81058502, 109.85108185, 110.73448181, 113.67240143,
        111.2616806 , 109.870224  , 111.31252289, 110.13430023,
        114.10103607, 114.77970123, 112.22985077, 114.31642914,
        116.09441376, 116.92385101, 118.16082764, 118.67694092,
        118.56524658, 119.03853607, 120.55739594, 120.49404144,
        122.42977905, 121.24085236, 116.16013336, 116.63300323,
        116.58467865, 115.20069122, 115.84358215, 115.28810883,
        117.8563385 , 119.42647552, 118.72610474, 119.14774323,
        118.1501236 , 116.95870972, 114.3800354 , 112.2145462 ,
        114.4834137 , 119.11962891, 120.63092804, 121.65618134,
        126.75939941, 122.18280029, 123.86999512, 123.46128845,
        123.29574585, 125.06196594, 120.2321701 , 116.54759216,
        118.66742706, 119.67090607, 122.40414429, 125.63126373,
        126.72874451, 125.40590668, 125.48596954, 125.07720947,
        125.03321075, 123.83084106, 111.29560852, 109.17137909,
        110.01274872, 113.80892944, 115.40216064, 117.64202881,
        117.19533539, 114.68331146, 120.592453  , 121.56787109,
        122.56854248, 120.16921997, 109.29738617, 108.58309174,
        105.67469025, 109.31954193, 111.77844238, 117.49308777,
        117.51379395, 119.17248535, 121.21684265, 115.92686462,
        117.89155579, 117.02722931, 109.44298553, 111.84906006,
        109.99544525, 112.74966431, 117.55482483, 113.24182129,
        114.25985718, 120.09362793, 117.31872559, 117.51493835,
        120.62638092, 120.66695404, 115.74879456, 113.59360504,
        111.3054657 , 119.47810364, 123.9211731 , 117.2947464 ,
        118.73046875, 122.40358734, 118.54651642, 120.94522858,
        120.34509277, 119.83191681, 119.28258514, 116.90605927,
        119.67953491, 116.61541748, 118.57003021, 116.93538666,
        119.24189758, 115.26824951, 112.85500336, 113.099823  ,
        116.36817169, 118.09075928, 113.10484314, 110.84983063,
        112.21846008, 117.52051544, 117.77135468, 119.97014618,
        113.71328735, 110.9732132 , 106.47875977, 103.69775391,
        105.53292847, 109.03535461, 100.51857758,  98.77835083,
        100.72723389, 104.8807373 , 103.5398407 , 104.83049774,
        104.37041473, 101.78207397,  99.79195404,  97.33146667,
         94.70516968, 101.23419189,  97.22698212,  96.03053284,
         85.5657959 ,  86.89526367,  89.52989197,  92.63258362,
         92.20654297,  92.29302216,  90.33797455,  92.97270203,
         94.06049347,  99.45748138, 104.17945099,  98.57229614,
         97.48446655,  97.71075439,  99.74481964,  99.92754364,
        101.4070282 , 101.89152527, 100.19789886, 106.12158203,
        110.71243286, 114.61515808, 109.71600342, 100.36181641,
         99.59503174, 100.26066589, 103.05302429, 106.07904816,
        109.00286865, 104.7322464 , 101.0033493 , 101.06963348,
         98.1287384 ,  94.85438538,  97.80873871,  96.89566803,
         95.87638092,  97.01823425,  99.60314178, 101.56757355,
        100.41327667,  98.1182785 ,  97.07615662, 100.07180786,
        102.8060379 , 110.02096558,  99.93000793,  96.81884766,
         96.76573944, 102.67305756, 103.21143341, 108.91236877,
        107.97328949, 104.79489136, 102.64480591, 103.60140991,
        105.21128845, 105.4072876 , 100.71994781, 101.24845123,
        103.24285889, 102.26463318, 104.5911026 , 108.03813934,
        105.99388885, 101.76418304, 100.0619278 ,  99.67565155,
        102.54734802, 105.82036591, 102.67173004, 107.40962982,
        108.75289154, 107.67960358, 109.65460968, 113.40193176,
        113.42314148, 109.91667175, 110.75537109, 113.4659729 ,
        119.42851257, 116.68331909, 110.55675507, 105.76845551,
        101.9963913 , 104.99138641, 108.43159485, 114.20122528,
        115.56790924, 114.48078156, 113.02509308, 114.08977509])}</code></pre>
</div>
</div>
<p>Let us now visualize the residuals of our models.</p>
<p>As we can see, the result obtained above has an output in a dictionary, to extract each element from the dictionary we are going to use the <code>.get()</code> function to extract the element and then we are going to save it in a <code>pd.DataFrame()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>residual<span class="op">=</span>pd.DataFrame(result.get(<span class="st">"residuals"</span>), columns<span class="op">=</span>[<span class="st">"residual Model"</span>])</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>residual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">residual Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2.108105</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>-11.389412</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>-9.491397</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">533</td>
<td>-12.076382</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">534</td>
<td>-10.073893</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">535</td>
<td>-9.392075</td>
</tr>
</tbody>
</table>

<p>536 rows √ó 1 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">2</span>, ncols<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>residual.plot(ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">0</span>])</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">"Residuals"</span>)<span class="op">;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>sns.distplot(residual, ax<span class="op">=</span>axs[<span class="dv">0</span>,<span class="dv">1</span>])<span class="op">;</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">"Density plot - Residual"</span>)<span class="op">;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>stats.probplot(residual[<span class="st">"residual Model"</span>], dist<span class="op">=</span><span class="st">"norm"</span>, plot<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">0</span>])</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'Plot Q-Q'</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>plot_acf(residual,  lags<span class="op">=</span><span class="dv">35</span>, ax<span class="op">=</span>axs[<span class="dv">1</span>,<span class="dv">1</span>],color<span class="op">=</span><span class="st">"fuchsia"</span>)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">"Autocorrelation"</span>)<span class="op">;</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.show()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="forecast-method" class="level3">
<h3 class="anchored" data-anchor-id="forecast-method">Forecast Method</h3>
<p>If you want to gain speed in productive settings where you have multiple series or models we recommend using the <a href="https://Nixtla.github.io/statsforecast/src/core/core.html#statsforecast.forecast"><code>StatsForecast.forecast</code></a> method instead of <code>.fit</code> and <code>.predict</code>.</p>
<p>The main difference is that the <code>.forecast</code> doest not store the fitted values and is highly scalable in distributed environments.</p>
<p>The forecast method takes two arguments: forecasts next <code>h</code> (horizon) and <code>level</code>.</p>
<ul>
<li><p><code>h (int):</code> represents the forecast h steps into the future. In this case, 12 months ahead.</p></li>
<li><p><code>level (list of floats):</code> this optional parameter is used for probabilistic forecasting. Set the level (or confidence percentile) of your prediction interval. For example, <code>level=[90]</code> means that the model expects the real value to be inside that interval 90% of the times.</p></li>
</ul>
<p>The forecast object here is a new data frame that includes a column with the name of the model and the y hat values, as well as columns for the uncertainty intervals. Depending on your computer, this step should take around 1min. (If you want to speed things up to a couple of seconds, remove the AutoModels like <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#arima"><code>ARIMA</code></a> and <a href="https://Nixtla.github.io/statsforecast/src/core/models.html#theta"><code>Theta</code></a>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>Y_hat <span class="op">=</span> sf.forecast(horizon, fitted<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-09-01</td>
<td>111.075912</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-10-01</td>
<td>129.111282</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-11-01</td>
<td>131.296082</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-06-01</td>
<td>101.125748</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-07-01</td>
<td>99.870514</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-08-01</td>
<td>106.021683</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 2 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>values<span class="op">=</span>sf.forecast_fitted_values()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>values.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-01-01</td>
<td>85.694504</td>
<td>83.586395</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-02-01</td>
<td>71.820000</td>
<td>83.209412</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-03-01</td>
<td>66.022903</td>
<td>75.514297</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-04-01</td>
<td>64.564499</td>
<td>74.384911</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>1972-05-01</td>
<td>65.010002</td>
<td>76.336319</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>StatsForecast.plot(values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Adding 95% confidence interval with the forecast method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>sf.forecast(h<span class="op">=</span>horizon, level<span class="op">=</span>[<span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
<th data-quarto-table-cell-role="th">AutoTheta-lo-95</th>
<th data-quarto-table-cell-role="th">AutoTheta-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-09-01</td>
<td>111.075912</td>
<td>90.148819</td>
<td>135.999680</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-10-01</td>
<td>129.111282</td>
<td>94.811134</td>
<td>160.372803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-11-01</td>
<td>131.296082</td>
<td>90.598457</td>
<td>168.251602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-06-01</td>
<td>101.125748</td>
<td>41.213715</td>
<td>159.133316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-07-01</td>
<td>99.870514</td>
<td>35.173969</td>
<td>152.843002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-08-01</td>
<td>106.021683</td>
<td>38.784256</td>
<td>166.021072</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 4 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>Y_hat<span class="op">=</span>Y_hat.reset_index()</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>Y_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>2016-09-01</td>
<td>111.075912</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2016-10-01</td>
<td>129.111282</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>2016-11-01</td>
<td>131.296082</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>1</td>
<td>2017-06-01</td>
<td>101.125748</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>1</td>
<td>2017-07-01</td>
<td>99.870514</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>1</td>
<td>2017-08-01</td>
<td>106.021683</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 3 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the forecasts with the true values</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>test[<span class="st">'unique_id'</span>] <span class="op">=</span> test[<span class="st">'unique_id'</span>].astype(<span class="bu">int</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>Y_hat1 <span class="op">=</span> test.merge(Y_hat, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>Y_hat1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2016-09-01</td>
<td>109.3191</td>
<td>1</td>
<td>111.075912</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-10-01</td>
<td>119.0502</td>
<td>1</td>
<td>129.111282</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2016-11-01</td>
<td>116.8431</td>
<td>1</td>
<td>131.296082</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>2017-06-01</td>
<td>104.2022</td>
<td>1</td>
<td>101.125748</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>2017-07-01</td>
<td>102.5861</td>
<td>1</td>
<td>99.870514</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>2017-08-01</td>
<td>114.0613</td>
<td>1</td>
<td>106.021683</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 4 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>plot_df <span class="op">=</span> pd.concat([train, Y_hat1]).set_index(<span class="st">'ds'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>plot_df[[<span class="st">'y'</span>, <span class="st">"AutoTheta"</span>]].plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">' Forecast'</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Year '</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'Timestamp [t]'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>ax.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="predict-method-with-confidence-interval" class="level3">
<h3 class="anchored" data-anchor-id="predict-method-with-confidence-interval">Predict method with confidence interval</h3>
<p>To generate forecasts use the predict method.</p>
<p>The predict method takes two arguments: forecasts the next <code>h</code> (for horizon) and <code>level</code>.</p>
<ul>
<li><p><code>h (int):</code> represents the forecast h steps into the future. In this case, 12 months ahead.</p></li>
<li><p><code>level (list of floats):</code> this optional parameter is used for probabilistic forecasting. Set the level (or confidence percentile) of your prediction interval. For example, <code>level=[95]</code> means that the model expects the real value to be inside that interval 95% of the times.</p></li>
</ul>
<p>The forecast object here is a new data frame that includes a column with the name of the model and the y hat values, as well as columns for the uncertainty intervals.</p>
<p>This step should take less than 1 second.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>sf.predict(h<span class="op">=</span>horizon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-09-01</td>
<td>111.075912</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-10-01</td>
<td>129.111282</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-11-01</td>
<td>131.296082</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-06-01</td>
<td>101.125748</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-07-01</td>
<td>99.870514</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-08-01</td>
<td>106.021683</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 2 columns</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>forecast_df <span class="op">=</span> sf.predict(h<span class="op">=</span>horizon, level<span class="op">=</span>[<span class="dv">95</span>]) </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>forecast_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
<th data-quarto-table-cell-role="th">AutoTheta-lo-95</th>
<th data-quarto-table-cell-role="th">AutoTheta-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-09-01</td>
<td>111.075912</td>
<td>90.148819</td>
<td>135.999680</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-10-01</td>
<td>129.111282</td>
<td>94.811134</td>
<td>160.372803</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-11-01</td>
<td>131.296082</td>
<td>90.598457</td>
<td>168.251602</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-06-01</td>
<td>101.125748</td>
<td>41.213715</td>
<td>159.133316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-07-01</td>
<td>99.870514</td>
<td>35.173969</td>
<td>152.843002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2017-08-01</td>
<td>106.021683</td>
<td>38.784256</td>
<td>166.021072</td>
</tr>
</tbody>
</table>

<p>12 rows √ó 4 columns</p>
</div>
</div>
</div>
<p>We can join the forecast result with the historical data using the pandas function <code>pd.concat()</code>, and then be able to use this result for graphing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>pd.concat([df, forecast_df]).set_index(<span class="st">'ds'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
<th data-quarto-table-cell-role="th">AutoTheta-lo-95</th>
<th data-quarto-table-cell-role="th">AutoTheta-hi-95</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1972-01-01</td>
<td>85.6945</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1972-02-01</td>
<td>71.8200</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1972-03-01</td>
<td>66.0229</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-06-01</td>
<td>NaN</td>
<td>NaN</td>
<td>101.125748</td>
<td>41.213715</td>
<td>159.133316</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2017-07-01</td>
<td>NaN</td>
<td>NaN</td>
<td>99.870514</td>
<td>35.173969</td>
<td>152.843002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2017-08-01</td>
<td>NaN</td>
<td>NaN</td>
<td>106.021683</td>
<td>38.784256</td>
<td>166.021072</td>
</tr>
</tbody>
</table>

<p>560 rows √ó 5 columns</p>
</div>
</div>
</div>
<p>Now let‚Äôs visualize the result of our forecast and the historical data of our time series, also let‚Äôs draw the confidence interval that we have obtained when making the prediction with 95% confidence.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_forecasts(y_hist, y_true, y_pred, models):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    _, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">20</span>, <span class="dv">7</span>))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_true.merge(y_pred, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> pd.concat([y_hist, y_true]).set_index(<span class="st">'ds'</span>).tail(<span class="dv">12</span><span class="op">*</span><span class="dv">10</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    df_plot[[<span class="st">'y'</span>] <span class="op">+</span> models].plot(ax<span class="op">=</span>ax, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> [<span class="st">'orange'</span>, <span class="st">'black'</span>, <span class="st">'green'</span>]</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> model, color <span class="kw">in</span> <span class="bu">zip</span>(models, colors):</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>        ax.fill_between(df_plot.index, </span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>                        df_plot[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-lo-95'</span>], </span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>                        df_plot[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-hi-95'</span>],</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                        alpha<span class="op">=</span><span class="fl">.35</span>,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>                        color<span class="op">=</span>color,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-level-95'</span>)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="st">''</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(<span class="st">''</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">'Timestamp [t]'</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    ax.legend(prop<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">15</span>})</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    ax.grid(<span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>plot_forecasts(train, test, forecast_df, models<span class="op">=</span>[<span class="st">'AutoTheta'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-31-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>Let‚Äôs plot the same graph using the plot function that comes in <code>Statsforecast</code>, as shown below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>sf.plot(df, forecast_df, level<span class="op">=</span>[<span class="dv">95</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="AutoTheta_files/figure-html/cell-32-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-validation <a class="anchor" id="cross_validate"></a></h2>
<p>In previous steps, we‚Äôve taken our historical data to predict the future. However, to asses its accuracy we would also like to know how the model would have performed in the past. To assess the accuracy and robustness of your models on your data perform Cross-Validation.</p>
<p>With time series data, Cross Validation is done by defining a sliding window across the historical data and predicting the period following it. This form of cross-validation allows us to arrive at a better estimation of our model‚Äôs predictive abilities across a wider range of temporal instances while also keeping the data in the training set contiguous as is required by our models.</p>
<p>The following graph depicts such a Cross Validation Strategy:</p>
<p><img src="https://raw.githubusercontent.com/Nixtla/statsforecast/main/nbs/imgs/ChainedWindows.gif" class="img-fluid"></p>
<section id="perform-time-series-cross-validation" class="level3">
<h3 class="anchored" data-anchor-id="perform-time-series-cross-validation">Perform time series cross-validation</h3>
<p>Cross-validation of time series models is considered a best practice but most implementations are very slow. The statsforecast library implements cross-validation as a distributed operation, making the process less time-consuming to perform. If you have big datasets you can also perform Cross Validation in a distributed cluster using Ray, Dask or Spark.</p>
<p>In this case, we want to evaluate the performance of each model for the last 5 months <code>(n_windows=5)</code>, forecasting every second months <code>(step_size=12)</code>. Depending on your computer, this step should take around 1 min.</p>
<p>The cross_validation method from the StatsForecast class takes the following arguments.</p>
<ul>
<li><p><code>df:</code> training data frame</p></li>
<li><p><code>h (int):</code> represents h steps into the future that are being forecasted. In this case, 12 months ahead.</p></li>
<li><p><code>step_size (int):</code> step size between each window. In other words: how often do you want to run the forecasting processes.</p></li>
<li><p><code>n_windows(int):</code> number of windows used for cross validation. In other words: what number of forecasting processes in the past do you want to evaluate.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df <span class="op">=</span> sf.cross_validation(df<span class="op">=</span>train,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                                         h<span class="op">=</span>horizon,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                                         step_size<span class="op">=</span><span class="dv">12</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                                         n_windows<span class="op">=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The crossvaldation_df object is a new data frame that includes the following columns:</p>
<ul>
<li><code>unique_id:</code> index. If you dont like working with index just run crossvalidation_df.resetindex()</li>
<li><code>ds:</code> datestamp or temporal index</li>
<li><code>cutoff:</code> the last datestamp or temporal index for the n_windows.</li>
<li><code>y:</code> true value</li>
<li><code>"model":</code> columns with the model‚Äôs name and fitted value.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>crossvalidation_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">cutoff</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">AutoTheta</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2011-09-01</td>
<td>2011-08-01</td>
<td>93.906197</td>
<td>98.167465</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2011-10-01</td>
<td>2011-08-01</td>
<td>116.763397</td>
<td>116.969933</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2011-11-01</td>
<td>2011-08-01</td>
<td>116.825798</td>
<td>119.135147</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-06-01</td>
<td>2015-08-01</td>
<td>102.404404</td>
<td>109.600456</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-07-01</td>
<td>2015-08-01</td>
<td>102.951202</td>
<td>108.260147</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>2016-08-01</td>
<td>2015-08-01</td>
<td>104.697701</td>
<td>114.248260</td>
</tr>
</tbody>
</table>

<p>60 rows √ó 4 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model Evaluation <a class="anchor" id="evaluate"></a></h2>
<p>We can now compute the accuracy of the forecast using an appropiate accuracy metric. Here we‚Äôll use the Root Mean Squared Error (RMSE). To do this, we first need to <code>install datasetsforecast</code>, a Python library developed <strong>by Nixtla</strong> that includes a function to compute the RMSE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install datasetsforecast</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.losses <span class="im">import</span> rmse</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function to compute the RMSE takes two arguments:</p>
<ol type="1">
<li>The actual values.</li>
<li>The forecasts, in this case, AutoTheta.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="op">=</span> rmse(crossvalidation_df[<span class="st">'y'</span>], crossvalidation_df[<span class="st">"AutoTheta"</span>])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"RMSE using cross-validation: "</span>, rmse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>RMSE using cross-validation:  6.9269824</code></pre>
</div>
</div>
<p>As you have noticed, we have used the cross validation results to perform the evaluation of our model.</p>
<p>Now we are going to evaluate our model with the results of the predictions, we will use different types of metrics <code>MAE, MAPE, MASE, RMSE, SMAPE</code> to evaluate the <code>accuracy</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datasetsforecast.losses <span class="im">import</span> (mae, mape, mase, rmse, smape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_performace(y_hist, y_true, y_pred, model):</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_true.merge(y_pred, how<span class="op">=</span><span class="st">'left'</span>, on<span class="op">=</span>[<span class="st">'unique_id'</span>, <span class="st">'ds'</span>])</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    evaluation <span class="op">=</span> {}</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    evaluation[model] <span class="op">=</span> {}</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> metric <span class="kw">in</span> [mase, mae, mape, rmse, smape]:</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        metric_name <span class="op">=</span> metric.<span class="va">__name__</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> metric_name <span class="op">==</span> <span class="st">'mase'</span>:</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>            evaluation[model][metric_name] <span class="op">=</span> metric(y_true[<span class="st">'y'</span>].values, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                                                y_true[model].values, </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                                                y_hist[<span class="st">'y'</span>].values, seasonality<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>            evaluation[model][metric_name] <span class="op">=</span> metric(y_true[<span class="st">'y'</span>].values, y_true[model].values)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(evaluation).T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>evaluate_performace(train, test, Y_hat, model<span class="op">=</span><span class="st">"AutoTheta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">mae</th>
<th data-quarto-table-cell-role="th">mape</th>
<th data-quarto-table-cell-role="th">mase</th>
<th data-quarto-table-cell-role="th">rmse</th>
<th data-quarto-table-cell-role="th">smape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AutoTheta</td>
<td>6.281525</td>
<td>5.568355</td>
<td>1.212475</td>
<td>7.683672</td>
<td>5.479727</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>We would like to thank <a href="https://www.linkedin.com/in/naren-castellon-1541b8101/?originalSubdomain=pa">Naren Castellon</a> for writing this tutorial.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References <a class="anchor" id="references"></a></h2>
<ol type="1">
<li><a href="https://www.sciencedirect.com/science/article/pii/S0169207016300243">Jose A. Fiorucci, Tiago R. Pellegrini, Francisco Louzada, Fotios Petropoulos, Anne B. Koehler (2016). ‚ÄúModels for optimising the theta method and their relationship to state space models‚Äù. International Journal of Forecasting</a>.</li>
<li><a href="https://nixtla.github.io/statsforecast/src/core/models.html#autotheta">Nixtla Parameters</a>.</li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">Pandas available frequencies</a>.</li>
<li><a href="https://otexts.com/fpp3/tscv.html">Rob J. Hyndman and George Athanasopoulos (2018). ‚ÄúForecasting principles and practice, Time series cross-validation‚Äù.</a>.</li>
<li><a href="https://robjhyndman.com/hyndsight/seasonal-periods/">Seasonal periods- Rob J Hyndman</a>.</li>
</ol>


</section>

<p>Give us a ‚≠ê&nbsp;on <a href="https://github.com/nixtla/statsforecast">Github</a></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>