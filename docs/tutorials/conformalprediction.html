<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="In this example, we‚Äôll implement conformal prediction">

<title>statsforecast - Conformal Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon_png.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-NXJNCVR18L"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-NXJNCVR18L', { 'anonymize_ip': true});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="statsforecast - Conformal Prediction">
<meta property="og:description" content="In this example, we‚Äôll implement conformal prediction">
<meta property="og:image" content="https://github.com/Nixtla/styles/blob/2abf51612584169874c90cd7c4d347e3917eaf73/images/Banner%20Github.png">
<meta property="og:site-name" content="statsforecast">
<meta name="twitter:title" content="statsforecast - Conformal Prediction">
<meta name="twitter:description" content="In this example, we‚Äôll implement conformal prediction">
<meta name="twitter:image" content="https://farm6.staticflickr.com/5510/14338202952_93595258ff_z.jpg">
<meta name="twitter:site" content="@Nixtlainc">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">statsforecast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../docs/getting-started/getting_started_short.html" rel="" target="" aria-current="page">
 <span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-nixtlaverse" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">NixtlaVerse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-nixtlaverse">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast" rel="" target="">
 <span class="dropdown-text">StatsForecast ‚ö°Ô∏è</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/mlforecast" rel="" target="">
 <span class="dropdown-text">MLForecast ü§ñ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/neuralforecast" rel="" target="">
 <span class="dropdown-text">NeuralForecast üß†</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/hierarchicalforecast" rel="" target="">
 <span class="dropdown-text">HierarchicalForecast üëë</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-help" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Help</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-help">    
        <li>
    <a class="dropdown-item" href="https://github.com/nixtla/statsforecast/issues/new/choose" rel="" target=""><i class="bi bi-bug" role="img">
</i> 
 <span class="dropdown-text">Report an Issue</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://join.slack.com/t/nixtlaworkspace/shared_invite/zt-135dssye9-fWTzMpv2WBthq8NK0Yvu6A" rel="" target=""><i class="bi bi-chat-right-text" role="img">
</i> 
 <span class="dropdown-text">Join our Slack</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/nixtla/statsforecast" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/nixtlainc" rel="" target=""><i class="bi bi-twitter" role="img" aria-label="Nixtla Twitter">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../docs/tutorials/anomalydetection.html">Tutorials</a></li><li class="breadcrumb-item"><a href="../../docs/tutorials/conformalprediction.html">Conformal Prediction</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ‚ö°Ô∏è</span></a>
  </div>
</li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Getting Started</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/installation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Install</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_short.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quick Start</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/getting-started/getting_started_complete.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/anomalydetection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anomaly Detection</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/conformalprediction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Conformal Prediction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/crossvalidation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross validation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricityloadforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Electricity Load Forecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/electricitypeakforecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Detect Demand Peaks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/garch_tutorial.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Volatility forecasting (GARCH &amp; ARCH)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/intermittentdata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intermittent or Sparse Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/multipleseasonalities.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple seasonalities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/statisticalneuralmethods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical, Machine Learning and Neural Forecasting methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/tutorials/uncertaintyintervals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic Forecasting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">How-To Guides</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/automatic_forecasting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Time Series Forecasting</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/amazonstatsforecast.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Amazon Forecast vs StatsForecast</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/autoarima_vs_prophet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Comparison (Prophet and pmdarima)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/dask.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dask</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ets_ray_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Forecasting at Scale using ETS and ray (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/exogenous.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Exogenous Regressors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/getting_started_complete_polars.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">End to End Walkthrough with Polars</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/migrating_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Migrating from R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/mlflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">MLFlow</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/numba_cache.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Numba caching</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/prophet_spark_m5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast ETS and Facebook Prophet on Spark (M5)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/ray.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Ray</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/how-to-guides/spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spark</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Model References</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/adida.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ADIDA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoarima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoARIMA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoCES Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoETS Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autoregressive.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoRegressive Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/autotheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">AutoTheta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonclassic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonClassic Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonOptimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/crostonsba.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CrostonSBA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicoptimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/dynamicstandardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dynamic Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/garch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">GARCH Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/holtwinters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Holt Winters Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/imapa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">IMAPA Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/multipleseasonaltrend.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multiple Seasonal Trend (MSTL)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/optimizedtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Optimized Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/seasonalexponentialsmoothingoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seasonal Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialoptimized.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Optimized Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/simpleexponentialsmoothing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Simple Exponential Smoothing Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/standardtheta.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Theta Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/models/tsb.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">TSB Model</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">API Reference</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/core.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/distributed.fugue.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">FugueBackend</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../src/core/models_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">StatsForecast‚Äôs Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/contribute.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contribute to Nixtla</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/docs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Nixtla Documentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issue-labels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Understanding Issue Labels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/issues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Submit an Issue üì¢</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/step-by-step.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Step-by-step Contribution Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../docs/contribute/techstack.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing Code to Nixtla Development</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul class="collapse">
  <li><a href="#conformal-prediction" id="toc-conformal-prediction" class="nav-link" data-scroll-target="#conformal-prediction">Conformal Prediction</a></li>
  </ul></li>
  <li><a href="#install-libraries" id="toc-install-libraries" class="nav-link" data-scroll-target="#install-libraries">Install libraries</a></li>
  <li><a href="#load-and-explore-the-data" id="toc-load-and-explore-the-data" class="nav-link" data-scroll-target="#load-and-explore-the-data">Load and explore the data</a></li>
  <li><a href="#train-models" id="toc-train-models" class="nav-link" data-scroll-target="#train-models">Train models</a></li>
  <li><a href="#plot-prediction-intervals" id="toc-plot-prediction-intervals" class="nav-link" data-scroll-target="#plot-prediction-intervals">Plot prediction intervals</a></li>
  <li><a href="#statsforecast-object" id="toc-statsforecast-object" class="nav-link" data-scroll-target="#statsforecast-object">StatsForecast Object</a></li>
  <li><a href="#future-work" id="toc-future-work" class="nav-link" data-scroll-target="#future-work">Future work</a></li>
  <li><a href="#acknowledgements" id="toc-acknowledgements" class="nav-link" data-scroll-target="#acknowledgements">Acknowledgements</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/Nixtla/statsforecast/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Conformal Prediction</h1>
</div>

<div>
  <div class="description">
    In this example, we‚Äôll implement conformal prediction
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prerequisites
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This tutorial assumes basic familiarity with StatsForecast. For a minimal example visit the <a href="../../docs/getting-started/getting_started_short.html">Quick Start</a></p>
</div>
</div>
</div>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>When we generate a forecast, we usually produce a single value known as the point forecast. This value, however, doesn‚Äôt tell us anything about the uncertainty associated with the forecast. To have a measure of this uncertainty, we need <strong>prediction intervals</strong>.</p>
<p>A prediction interval is a range of values that the forecast can take with a given probability. Hence, a 95% prediction interval should contain a range of values that include the actual future value with probability 95%. Probabilistic forecasting aims to generate the full forecast distribution. Point forecasting, on the other hand, usually returns the mean or the median or said distribution. However, in real-world scenarios, it is better to forecast not only the most probable future outcome, but many alternative outcomes as well.</p>
<p>The problem is that some timeseries models provide forecast distributions, but some other ones only provide point forecasts. How can we then estimate the uncertainty of predictions?</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Prediction Intervals
</div>
</div>
<div class="callout-body-container callout-body">
<p>For models that already provide the forecast distribution, check <a href="../../docs/tutorials/uncertaintyintervals.html">Prediction Intervals</a>.</p>
</div>
</div>
<section id="conformal-prediction" class="level3">
<h3 class="anchored" data-anchor-id="conformal-prediction">Conformal Prediction</h3>
<p>For a video introduction, see the <a href="https://www.youtube.com/watch?v=Bj1U-Rrxk48">PyData Seattle presentation</a>.</p>
<p>Multi-quantile losses and statistical models can provide provide prediction intervals, but the problem is that these are uncalibrated, meaning that the actual frequency of observations falling within the interval does not align with the confidence level associated with it. For example, a calibrated 95% prediction interval should contain the true value 95% of the time in repeated sampling. An uncalibrated 95% prediction interval, on the other hand, might contain the true value only 80% of the time, or perhaps 99% of the time. In the first case, the interval is too narrow and underestimates the uncertainty, while in the second case, it is too wide and overestimates the uncertainty.</p>
<p>Statistical methods also assume normality. Here, we talk about another method called conformal prediction that doesn‚Äôt require any distributional assumptions. More information on the approach can be found in <a href="https://github.com/valeman/awesome-conformal-prediction">this repo owned by Valery Manokhin</a>.</p>
<p>Conformal prediction intervals use cross-validation on a point forecaster model to generate the intervals. This means that no prior probabilities are needed, and the output is well-calibrated. No additional training is needed, and the model is treated as a black box. The approach is compatible with any model.</p>
<p><a href="https://github.com/nixtla/statsforecast">Statsforecast</a> now supports Conformal Prediction on all available models.</p>
</section>
</section>
<section id="install-libraries" class="level2">
<h2 class="anchored" data-anchor-id="install-libraries">Install libraries</h2>
<p>We assume that you have StatsForecast already installed. If not, check this guide for instructions on <a href="../../docs/getting-started/installation.html">how to install StatsForecast</a></p>
<p>Install the necessary packages using <code>pip install statsforecast</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pip install statsforecast <span class="op">-</span>U</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-and-explore-the-data" class="level2">
<h2 class="anchored" data-anchor-id="load-and-explore-the-data">Load and explore the data</h2>
<p>For this example, we‚Äôll use the hourly dataset from the <a href="https://www.sciencedirect.com/science/article/pii/S0169207019301128">M4 Competition</a>. We first need to download the data from a URL and then load it as a <code>pandas</code> dataframe. Notice that we‚Äôll load the train and the test data separately. We‚Äôll also rename the <code>y</code> column of the test data as <code>y_test</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.read_csv(<span class="st">'https://auto-arima-results.s3.amazonaws.com/M4-Hourly.csv'</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.read_csv(<span class="st">'https://auto-arima-results.s3.amazonaws.com/M4-Hourly-test.csv'</span>).rename(columns<span class="op">=</span>{<span class="st">'y'</span>: <span class="st">'y_test'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>train.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H1</td>
<td>1</td>
<td>605.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H1</td>
<td>2</td>
<td>586.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H1</td>
<td>3</td>
<td>586.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H1</td>
<td>4</td>
<td>559.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H1</td>
<td>5</td>
<td>511.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since the goal of this notebook is to generate prediction intervals, we‚Äôll only use the first 8 series of the dataset to reduce the total computational time.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>n_series <span class="op">=</span> <span class="dv">8</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>uids <span class="op">=</span> train[<span class="st">'unique_id'</span>].unique()[:n_series] <span class="co"># select first n_series of the dataset</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> train.query(<span class="st">'unique_id in @uids'</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> test.query(<span class="st">'unique_id in @uids'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot these series using the <code>statsforecast.plot</code> method from the <a href="https://nixtla.github.io/statsforecast/core.html#statsforecast">StatsForecast</a> class. This method has multiple parameters, and the required ones to generate the plots in this notebook are explained below.</p>
<ul>
<li><code>df</code>: A <code>pandas</code> dataframe with columns [<code>unique_id</code>, <code>ds</code>, <code>y</code>].</li>
<li><code>forecasts_df</code>: A <code>pandas</code> dataframe with columns [<code>unique_id</code>, <code>ds</code>] and models.</li>
<li><code>plot_random</code>: bool = <code>True</code>. Plots the time series randomly.</li>
<li><code>models</code>: List[str]. A list with the models we want to plot.</li>
<li><code>level</code>: List[float]. A list with the prediction intervals we want to plot.</li>
<li><code>engine</code>: str = <code>matplotlib</code>. It can also be <code>matplotlib</code>. <code>plotly</code> generates interactive plots, while <code>matplotlib</code> generates static plots.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>StatsForecast.plot(train, test, plot_random <span class="op">=</span> <span class="va">False</span>, engine <span class="op">=</span> <span class="st">'plotly'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
</section>
<section id="train-models" class="level2">
<h2 class="anchored" data-anchor-id="train-models">Train models</h2>
<p>StatsForecast can train multiple <a href="https://nixtla.github.io/statsforecast/#models">models</a> on different time series efficiently. Most of these models can generate a probabilistic forecast, which means that they can produce both point forecasts and prediction intervals.</p>
<p>For this example, we‚Äôll use <a href="https://nixtla.github.io/statsforecast/src/core/models.html#simpleexponentialsmoothing">SimpleExponentialSmoothing</a> and <a href="https://nixtla.github.io/statsforecast/src/core/models.html#adida">ADIDA</a> which do not provide a prediction interval natively. Thus, it makes sense to use Conformal Prediction to generate the prediction interval.</p>
<p>We‚Äôll also show using it with <a href="https://nixtla.github.io/statsforecast/src/core/models.html#arima">ARIMA</a> to provide prediction intervals that don‚Äôt assume normality.</p>
<p>To use these models, we first need to import them from <code>statsforecast.models</code> and then we need to instantiate them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> SeasonalExponentialSmoothing, ADIDA, ARIMA</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.utils <span class="im">import</span> ConformalIntervals</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a list of models and instantiation parameters </span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>intervals <span class="op">=</span> ConformalIntervals(h<span class="op">=</span><span class="dv">24</span>, n_windows<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    SeasonalExponentialSmoothing(season_length<span class="op">=</span><span class="dv">24</span>,alpha<span class="op">=</span><span class="fl">0.1</span>, prediction_intervals<span class="op">=</span>intervals),</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    ADIDA(prediction_intervals<span class="op">=</span>intervals),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    ARIMA(order<span class="op">=</span>(<span class="dv">24</span>,<span class="dv">0</span>,<span class="dv">12</span>), season_length<span class="op">=</span><span class="dv">24</span>, prediction_intervals<span class="op">=</span>intervals),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To instantiate a new StatsForecast object, we need the following parameters:</p>
<ul>
<li><code>df</code>: The dataframe with the training data.</li>
<li><code>models</code>: The list of models defined in the previous step.<br>
</li>
<li><code>freq</code>: A string indicating the frequency of the data. See <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases">pandas‚Äô available frequencies</a>.</li>
<li><code>n_jobs</code>: An integer that indicates the number of jobs used in parallel processing. Use -1 to select all cores.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sf <span class="op">=</span> StatsForecast(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>train, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    models<span class="op">=</span>models, </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">'H'</span>, </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we‚Äôre ready to generate the forecasts and the prediction intervals. To do this, we‚Äôll use the <a href="https://Nixtla.github.io/statsforecast/src/ets.html#forecast"><code>forecast</code></a> method, which takes two arguments:</p>
<ul>
<li><code>h</code>: An integer that represent the forecasting horizon. In this case, we‚Äôll forecast the next 24 hours.</li>
<li><code>level</code>: A list of floats with the confidence levels of the prediction intervals. For example, <code>level=[95]</code> means that the range of values should include the actual future value with probability 95%.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>levels <span class="op">=</span> [<span class="dv">80</span>, <span class="dv">90</span>] <span class="co"># confidence levels of the prediction intervals </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>forecasts <span class="op">=</span> sf.forecast(h<span class="op">=</span><span class="dv">24</span>, level<span class="op">=</span>levels)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>forecasts <span class="op">=</span> forecasts.reset_index()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>forecasts.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">SeasonalES</th>
<th data-quarto-table-cell-role="th">SeasonalES-lo-90</th>
<th data-quarto-table-cell-role="th">SeasonalES-lo-80</th>
<th data-quarto-table-cell-role="th">SeasonalES-hi-80</th>
<th data-quarto-table-cell-role="th">SeasonalES-hi-90</th>
<th data-quarto-table-cell-role="th">ADIDA</th>
<th data-quarto-table-cell-role="th">ADIDA-lo-90</th>
<th data-quarto-table-cell-role="th">ADIDA-lo-80</th>
<th data-quarto-table-cell-role="th">ADIDA-hi-80</th>
<th data-quarto-table-cell-role="th">ADIDA-hi-90</th>
<th data-quarto-table-cell-role="th">ARIMA</th>
<th data-quarto-table-cell-role="th">ARIMA-lo-90</th>
<th data-quarto-table-cell-role="th">ARIMA-lo-80</th>
<th data-quarto-table-cell-role="th">ARIMA-hi-80</th>
<th data-quarto-table-cell-role="th">ARIMA-hi-90</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H1</td>
<td>701</td>
<td>624.132690</td>
<td>561.315369</td>
<td>565.365356</td>
<td>682.900024</td>
<td>686.950012</td>
<td>747.292542</td>
<td>668.049988</td>
<td>672.099976</td>
<td>822.485107</td>
<td>826.535095</td>
<td>634.355164</td>
<td>581.760376</td>
<td>585.810364</td>
<td>682.900024</td>
<td>686.950012</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H1</td>
<td>702</td>
<td>555.698181</td>
<td>501.886902</td>
<td>510.377441</td>
<td>601.018921</td>
<td>609.509460</td>
<td>747.292542</td>
<td>560.200012</td>
<td>570.400024</td>
<td>924.185059</td>
<td>934.385071</td>
<td>578.701355</td>
<td>540.992310</td>
<td>542.581909</td>
<td>614.820801</td>
<td>616.410400</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H1</td>
<td>703</td>
<td>514.403015</td>
<td>468.656036</td>
<td>471.506042</td>
<td>557.299988</td>
<td>560.150024</td>
<td>747.292542</td>
<td>546.849976</td>
<td>549.700012</td>
<td>944.885071</td>
<td>947.735107</td>
<td>544.308960</td>
<td>528.375244</td>
<td>531.132568</td>
<td>557.485352</td>
<td>560.242676</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H1</td>
<td>704</td>
<td>482.057892</td>
<td>438.715790</td>
<td>442.315796</td>
<td>521.799988</td>
<td>525.400024</td>
<td>747.292542</td>
<td>508.600006</td>
<td>512.200012</td>
<td>982.385071</td>
<td>985.985107</td>
<td>516.846619</td>
<td>504.739288</td>
<td>504.785309</td>
<td>528.907959</td>
<td>528.953979</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H1</td>
<td>705</td>
<td>460.222534</td>
<td>419.595062</td>
<td>422.745056</td>
<td>497.700012</td>
<td>500.850006</td>
<td>747.292542</td>
<td>486.149994</td>
<td>489.299988</td>
<td>1005.285095</td>
<td>1008.435059</td>
<td>502.623077</td>
<td>485.736938</td>
<td>488.473846</td>
<td>516.772339</td>
<td>519.509277</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="plot-prediction-intervals" class="level2">
<h2 class="anchored" data-anchor-id="plot-prediction-intervals">Plot prediction intervals</h2>
<p>Here we‚Äôll plot the different intervals using matplotlib for one timeseries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _plot_fcst(fcst, train, model): </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">1</span>, figsize <span class="op">=</span> (<span class="dv">20</span>,<span class="dv">7</span>))</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.arange(<span class="dv">0</span>, <span class="bu">len</span>(train[<span class="st">'y'</span>])), train[<span class="st">'y'</span>])</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.arange(<span class="bu">len</span>(train[<span class="st">'y'</span>]), <span class="bu">len</span>(train[<span class="st">'y'</span>]) <span class="op">+</span> <span class="dv">24</span>), fcst[model], label<span class="op">=</span>model)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.arange(<span class="bu">len</span>(train[<span class="st">'y'</span>]), <span class="bu">len</span>(train[<span class="st">'y'</span>]) <span class="op">+</span> <span class="dv">24</span>), fcst[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-lo-90'</span>], color <span class="op">=</span> <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'lo-90'</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.arange(<span class="bu">len</span>(train[<span class="st">'y'</span>]), <span class="bu">len</span>(train[<span class="st">'y'</span>]) <span class="op">+</span> <span class="dv">24</span>), fcst[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-hi-90'</span>], color <span class="op">=</span> <span class="st">'r'</span>, label<span class="op">=</span><span class="st">'hi-90'</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.arange(<span class="bu">len</span>(train[<span class="st">'y'</span>]), <span class="bu">len</span>(train[<span class="st">'y'</span>]) <span class="op">+</span> <span class="dv">24</span>), fcst[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-lo-80'</span>], color <span class="op">=</span> <span class="st">'g'</span>, label<span class="op">=</span><span class="st">'lo-80'</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(np.arange(<span class="bu">len</span>(train[<span class="st">'y'</span>]), <span class="bu">len</span>(train[<span class="st">'y'</span>]) <span class="op">+</span> <span class="dv">24</span>), fcst[<span class="ss">f'</span><span class="sc">{</span>model<span class="sc">}</span><span class="ss">-hi-80'</span>], color <span class="op">=</span> <span class="st">'g'</span>, label<span class="op">=</span><span class="st">'hi-80'</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="bu">id</span> <span class="op">=</span> <span class="st">"H105"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>temp_train <span class="op">=</span> train.loc[train[<span class="st">'unique_id'</span>] <span class="op">==</span> <span class="bu">id</span>]</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>temp_forecast <span class="op">=</span> forecasts.loc[forecasts[<span class="st">'unique_id'</span>] <span class="op">==</span> <span class="bu">id</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The prediction interval with the SeasonalExponentialSmoothing seen below. Even if the model generates a point forecast, we are able to get a prediction interval. The 80% prediction interval does not cross the 90% prediction interval, which is a sign that the intervals are calibrated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>_plot_fcst(temp_forecast, temp_train, <span class="st">"SeasonalES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ConformalPrediction_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>For weaker fitting models, the conformal prediction interval can be larger. A better model corresponds to a narrower interval.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>_plot_fcst(temp_forecast, temp_train,<span class="st">"ADIDA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ConformalPrediction_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>ARIMA is an example of a model that provides a forecast distribution, but we can still use conformal prediction to generate the prediction interval. As mentioned earlier, this method has the benefit of not assuming normality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>_plot_fcst(temp_forecast, temp_train,<span class="st">"ARIMA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="ConformalPrediction_files/figure-html/cell-14-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="statsforecast-object" class="level2">
<h2 class="anchored" data-anchor-id="statsforecast-object">StatsForecast Object</h2>
<p>Alternatively, the prediction interval can be defined on the StatsForecast object. This will apply to all models that don‚Äôt have the <code>prediction_intervals</code> defined.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.models <span class="im">import</span> SimpleExponentialSmoothing, ADIDA</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast.utils <span class="im">import</span> ConformalIntervals</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsforecast <span class="im">import</span> StatsForecast</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>models <span class="op">=</span> [</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    SimpleExponentialSmoothing(alpha<span class="op">=</span><span class="fl">0.1</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    ADIDA()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> StatsForecast(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    df<span class="op">=</span>train, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    models<span class="op">=</span>models, </span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    freq<span class="op">=</span><span class="st">'H'</span>).forecast(h<span class="op">=</span><span class="dv">24</span>, prediction_intervals<span class="op">=</span>ConformalIntervals(h<span class="op">=</span><span class="dv">24</span>, n_windows<span class="op">=</span><span class="dv">2</span>), level<span class="op">=</span>[<span class="dv">80</span>]) </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>res.head().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">unique_id</th>
<th data-quarto-table-cell-role="th">ds</th>
<th data-quarto-table-cell-role="th">SES</th>
<th data-quarto-table-cell-role="th">SES-lo-80</th>
<th data-quarto-table-cell-role="th">SES-hi-80</th>
<th data-quarto-table-cell-role="th">ADIDA</th>
<th data-quarto-table-cell-role="th">ADIDA-lo-80</th>
<th data-quarto-table-cell-role="th">ADIDA-hi-80</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>H1</td>
<td>701</td>
<td>742.669067</td>
<td>672.099976</td>
<td>813.238159</td>
<td>747.292542</td>
<td>672.099976</td>
<td>822.485107</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>H1</td>
<td>702</td>
<td>742.669067</td>
<td>570.400024</td>
<td>914.938110</td>
<td>747.292542</td>
<td>570.400024</td>
<td>924.185059</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>H1</td>
<td>703</td>
<td>742.669067</td>
<td>549.700012</td>
<td>935.638123</td>
<td>747.292542</td>
<td>549.700012</td>
<td>944.885071</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>H1</td>
<td>704</td>
<td>742.669067</td>
<td>512.200012</td>
<td>973.138123</td>
<td>747.292542</td>
<td>512.200012</td>
<td>982.385071</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>H1</td>
<td>705</td>
<td>742.669067</td>
<td>489.299988</td>
<td>996.038147</td>
<td>747.292542</td>
<td>489.299988</td>
<td>1005.285095</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="future-work" class="level2">
<h2 class="anchored" data-anchor-id="future-work">Future work</h2>
<p>Conformal prediction has become a powerful framework for uncertainty quantification, providing well-calibrated prediction intervals without making any distributional assumptions. Its use has surged in both academia and industry over the past few years. We‚Äôll continue working on it, and future tutorials may include:</p>
<ul>
<li>Exploring larger datasets</li>
<li>Incorporating industry-specific examples</li>
<li>Investigating specialized methods like the jackknife+ that are closely related to conformal prediction (for details on the jackknife+ see <a href="https://valeman.medium.com/jackknife-a-swiss-knife-of-conformal-prediction-for-regression-ce3b56432f4f">here</a>).</li>
</ul>
<p>If you‚Äôre interested in any of these, or in any other related topic, please let us know by opening an issue on <a href="https://github.com/Nixtla/statsforecast/issues">GitHub</a></p>
</section>
<section id="acknowledgements" class="level2">
<h2 class="anchored" data-anchor-id="acknowledgements">Acknowledgements</h2>
<p>We would like to thank <a href="https://github.com/kvnkho">Kevin Kho</a> for writing this tutorial, and Valeriy <a href="https://github.com/valeman">Manokhin</a> for his expertise on conformal prediction, as well as for promoting this work.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p><a href="https://zenodo.org/record/6727505">Manokhin, Valery. (2022). Machine Learning for Probabilistic Prediction. 10.5281/zenodo.6727505.</a></p>


</section>

<p>Give us a ‚≠ê&nbsp;on <a href="https://github.com/nixtla/statsforecast">Github</a></p></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>